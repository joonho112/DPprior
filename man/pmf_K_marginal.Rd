% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/06_pmf_marginal.R
\name{pmf_K_marginal}
\alias{pmf_K_marginal}
\title{Marginal PMF of K_J under Gamma Hyperprior}
\usage{
pmf_K_marginal(J, a, b, logS, M = .QUAD_NODES_DEFAULT)
}
\arguments{
\item{J}{Integer; sample size (positive integer >= 1).}

\item{a}{Numeric; shape parameter of Gamma prior (> 0).}

\item{b}{Numeric; rate parameter of Gamma prior (> 0).}

\item{logS}{Matrix; pre-computed log-Stirling matrix from
\code{\link{compute_log_stirling}}.}

\item{M}{Integer; number of quadrature nodes (default: 80).}
}
\value{
Numeric vector of length \eqn{J+1} containing
\eqn{P(K_J = k \mid a, b)} for \eqn{k = 0, 1, \ldots, J}.
Entry \code{[1]} corresponds to \eqn{k=0} and always equals 0.
The vector sums to 1.
}
\description{
Computes \eqn{P(K_J = k \mid a, b)} for \eqn{k = 0, 1, \ldots, J} when
\eqn{\alpha \sim \mathrm{Gamma}(a, b)} (shape-rate parameterization).
}
\details{
Uses Gauss-Laguerre quadrature to numerically evaluate:
\deqn{P(K_J = k \mid a, b) = \int_0^\infty P(K_J = k \mid \alpha) \cdot g_{a,b}(\alpha) d\alpha}
\deqn{\approx \sum_{m=1}^M \tilde{w}_m \cdot P(K_J = k \mid \alpha_m)}

where \eqn{P(K_J = k \mid \alpha)} is the Antoniak distribution from Module 04
and \eqn{(\alpha_m, \tilde{w}_m)} are the transformed quadrature nodes and
normalized weights from Module 02.

\strong{Implementation:} All mixing is performed in log-space for numerical
stability. This is critical for large J or extreme parameter values.

\strong{Key properties:}
\itemize{
\item \eqn{P(K_J = 0) = 0} always (at least one cluster exists)
\item The PMF sums to 1
\item Moments from the PMF match \code{exact_K_moments()} within numerical tolerance
\item Mode is typically near \eqn{E[K_J]} but may differ
}
}
\examples{
# Pre-compute Stirling numbers
logS <- compute_log_stirling(50)

# Compute marginal PMF for J=50, Gamma(1.5, 0.5) prior
pmf <- pmf_K_marginal(50, 1.5, 0.5, logS)

# Verify normalization
sum(pmf)

# Most likely number of clusters
which.max(pmf) - 1

# Compare mean with exact_K_moments
k_vals <- 0:50
mean_pmf <- sum(k_vals * pmf)
exact <- exact_K_moments(50, 1.5, 0.5)
abs(mean_pmf - exact$mean)

}
\references{
Antoniak, C. E. (1974). Mixtures of Dirichlet Processes with Applications
to Bayesian Nonparametric Problems. \emph{The Annals of Statistics},
2(6), 1152-1174.
}
\seealso{
\code{\link{log_pmf_K_marginal}} for log-scale computation,
\code{\link{pmf_K_given_alpha}} for conditional PMF,
\code{\link{exact_K_moments}} for marginal moments,
\code{\link{cdf_K_marginal}}, \code{\link{quantile_K_marginal}},
\code{\link{mode_K_marginal}}, \code{\link{summary_K_marginal}}
}
