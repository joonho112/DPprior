% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/12_a2_kl.R
\name{DPprior_a2_kl}
\alias{DPprior_a2_kl}
\title{A2-KL: KL Divergence Minimization for Prior Calibration}
\usage{
DPprior_a2_kl(
  J,
  target,
  method = c("pmf", "chisq"),
  max_iter = 100L,
  tol = 1e-06,
  M = .QUAD_NODES_DEFAULT,
  verbose = FALSE,
  ...
)
}
\arguments{
\item{J}{Integer; sample size (number of observations). Must be >= 2.}

\item{target}{Either:
\itemize{
\item Numeric vector of length J: target PMF for k = 1, ..., J
(used when \code{method = "pmf"}).
\item Named list with \code{mu_K} and \code{var_K}: construct from moments
using a discretized scaled chi-square (used when \code{method = "chisq"}).
}}

\item{method}{Character; \code{"pmf"} or \code{"chisq"}. Default: \code{"pmf"}.}

\item{max_iter}{Integer; maximum optimization iterations. Default: 100.}

\item{tol}{Numeric; convergence tolerance for optimization. Default: 1e-6.}

\item{M}{Integer; number of quadrature nodes. Default: 80.}

\item{verbose}{Logical; if TRUE, print optimization progress. Default: FALSE.}

\item{...}{Optional tuning parameters:
\itemize{
\item \code{log_bounds}: numeric length-2 vector giving lower/upper bounds
on \code{log(a)} and \code{log(b)} (default \code{c(-15, 15)}).
\item \code{eps}: numeric; small constant to avoid \code{log(0)}
(default \code{1e-15}).
}}
}
\value{
A \code{DPprior_fit} object (S3 class) with components:
\describe{
\item{\code{a}}{Numeric; optimal shape parameter}
\item{\code{b}}{Numeric; optimal rate parameter}
\item{\code{J}}{Integer; sample size}
\item{\code{target}}{List with target specification (pmf, mu_K, var_K, type,
and for chisq: df, scale, mu_K_discrete, var_K_discrete)}
\item{\code{method}}{Character; "A2-KL"}
\item{\code{converged}}{Logical; whether optimization converged}
\item{\code{iterations}}{Integer; number of function evaluations}
\item{\code{termination}}{Character; termination reason}
\item{\code{fit}}{List with achieved \code{mu_K}, \code{var_K},
\code{kl}, and \code{residual}}
\item{\code{diagnostics}}{List with initialization info, optim details,
fallback status, and KL at init/final}
\item{\code{trace}}{Data frame of evaluation-level trace (eval, a, b, kl)}
\item{\code{status}}{Character; convergence status}
}
}
\description{
Calibrates Gamma hyperprior parameters \eqn{(a, b)} by minimizing the
Kullback-Leibler divergence between a target distribution and the induced
marginal PMF of the number of clusters \eqn{K_J}.
}
\details{
The A2-KL algorithm finds \eqn{(a^*, b^*)} by solving:
\deqn{(a^*, b^*) = \arg\min_{a,b} D_{KL}(p^*(K_J) \| p_{a,b}(K_J))}

\strong{Algorithm:}
\enumerate{
\item Construct target PMF from user specification
\item Initialize \eqn{(a_0, b_0)} from A2-MN (exact moment matching)
\item Optimize KL divergence using L-BFGS-B in log-space with bounds
\item Apply fallback to initialization if optimization worsens KL
\item Return optimal parameters and comprehensive diagnostics
}

\strong{Stability features:}
\itemize{
\item Log-parameterization ensures positivity of (a, b)
\item Explicit bounds prevent numerical overflow/underflow
\item Fallback mechanism if optimization diverges or worsens objective
\item A2-MN initialization provides good starting point
}

\strong{When to use A2-KL vs A2-MN:}
\itemize{
\item \strong{A2-MN}: Target moments only (exact moment matching)
\item \strong{A2-KL}: Full target distribution shape (multi-modal,
skewed, expert-elicited)
}
}
\examples{
# Example 1: Target from moments (method = "chisq")
fit <- DPprior_a2_kl(J = 50, target = list(mu_K = 5, var_K = 8),
                     method = "chisq")
print(fit)

# Example 2: Custom target PMF (method = "pmf")
target_pmf <- dbinom(1:50, size = 50, prob = 0.1)
fit2 <- DPprior_a2_kl(J = 50, target = target_pmf, method = "pmf")

# Example 3: Compare A2-KL vs A2-MN
a2_mn <- DPprior_a2_newton(J = 50, mu_K = 5, var_K = 8)
a2_kl <- DPprior_a2_kl(J = 50, target = list(mu_K = 5, var_K = 8),
                       method = "chisq")
cat(sprintf("A2-MN: a=\%.4f, b=\%.4f\n", a2_mn$a, a2_mn$b))
cat(sprintf("A2-KL: a=\%.4f, b=\%.4f, KL=\%.4e\n", a2_kl$a, a2_kl$b, a2_kl$fit$kl))

}
\references{
Lee, J. (2026). Design-Conditional Prior Elicitation for Dirichlet Process Mixtures.
\emph{arXiv preprint} arXiv:2602.06301.
}
\seealso{
\code{\link{DPprior_a2_newton}} for exact moment matching,
\code{\link{DPprior_a1}} for closed-form initialization,
\code{\link{kl_divergence_K}} for KL divergence computation,
\code{\link{discretize_chisq}} for chi-square discretization

Other elicitation: 
\code{\link{DPprior_a1}()},
\code{\link{DPprior_a2_newton}()},
\code{\link{DPprior_dual}()},
\code{\link{DPprior_fit}()}
}
\concept{elicitation}
