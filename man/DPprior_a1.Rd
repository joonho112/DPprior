% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/10_a1_mapping.R
\name{DPprior_a1}
\alias{DPprior_a1}
\title{A1 Closed-Form Prior Elicitation}
\usage{
DPprior_a1(
  J,
  mu_K,
  var_K,
  scaling = c("log", "harmonic", "digamma"),
  epsilon = .TOL_PROJECTION_BUFFER
)
}
\arguments{
\item{J}{Integer; number of items/sites (must be >= 2).}

\item{mu_K}{Numeric; target prior mean of \eqn{K_J} (must be > 1 and <= J).}

\item{var_K}{Numeric; target prior variance of \eqn{K_J} (must be > 0).}

\item{scaling}{Character; scaling constant method: "log" (default),
"harmonic", or "digamma".}

\item{epsilon}{Numeric; buffer for feasibility projection. Default is
\code{.TOL_PROJECTION_BUFFER} (1e-6).}
}
\value{
An S3 object of class \code{DPprior_fit} with components:
\describe{
\item{a}{Shape parameter of the Gamma prior}
\item{b}{Rate parameter of the Gamma prior}
\item{J}{Sample size used}
\item{target}{List with target moments and type}
\item{method}{"A1" indicating closed-form method}
\item{status}{"success" or "projected" if boundary adjustment needed}
\item{scaling}{Scaling method used}
\item{cJ}{Scaling constant value}
\item{var_K_used}{Actual variance used (may differ if projected)}
\item{converged}{Always TRUE for A1 (for A2 compatibility)}
\item{iterations}{Always 0L for A1 (for A2 compatibility)}
\item{fit}{NULL (placeholder for A2 refinement)}
\item{diagnostics}{NULL (placeholder for diagnostics)}
\item{trace}{NULL (placeholder for optimization trace)}
}
}
\description{
Maps target beliefs about the number of clusters \eqn{(\mu_K, \sigma^2_K)}
to Gamma hyperprior parameters \eqn{(a, b)} using the A1 closed-form
approximation based on Negative Binomial moment matching.
}
\details{
\subsection{Theory (RN-03)}{

The A1 method uses a shifted Negative Binomial approximation:
\deqn{K_J - 1 \mid \alpha \approx \text{Poisson}(\alpha \cdot c_J)}

With \eqn{\alpha \sim \text{Gamma}(a, b)}, the marginal becomes:
\deqn{K_J - 1 \approx \text{NegBin}(a, b/(b + c_J))}
}

\subsection{Inverse Formulas (Theorem 1)}{

Let \eqn{m = \mu_K - 1} (shifted mean) and \eqn{D = \sigma^2_K - m}.
If \eqn{D > 0} (overdispersion):
\deqn{a = m^2 / D, \quad b = m \cdot c_J / D}

If \eqn{D \leq 0} (infeasible), the variance is projected to the boundary.
}

\subsection{Feasibility}{

The NegBin model requires overdispersion: \eqn{\sigma^2_K > \mu_K - 1}.
High-confidence specifications (low variance) may violate this constraint
under the A1 proxy, even though they may be feasible under the exact DP.
}
}
\examples{
# Basic usage with moment targets
fit <- DPprior_a1(J = 50, mu_K = 5, var_K = 8)
print(fit)

# Using VIF specification
fit <- DPprior_a1(J = 50, mu_K = 5, var_K = vif_to_variance(5, 2))

# Using confidence-based specification
vif <- confidence_to_vif("medium")
fit <- DPprior_a1(J = 50, mu_K = 5, var_K = vif_to_variance(5, vif))

# Infeasible variance (triggers projection)
fit <- DPprior_a1(J = 50, mu_K = 5, var_K = 3)  # var < mu-1 = 4

# Compare scaling methods
fit_log <- DPprior_a1(50, 5, 8, scaling = "log")
fit_harm <- DPprior_a1(50, 5, 8, scaling = "harmonic")

}
\seealso{
\code{\link{vif_to_variance}} for VIF conversion,
\code{\link{confidence_to_vif}} for confidence mapping,
\code{\link{print.DPprior_fit}} for print method
}
