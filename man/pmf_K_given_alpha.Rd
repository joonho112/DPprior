% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/04_pmf_conditional.R
\name{pmf_K_given_alpha}
\alias{pmf_K_given_alpha}
\title{PMF of K Given Alpha (Antoniak Distribution)}
\usage{
pmf_K_given_alpha(J, alpha, logS, normalize = TRUE)
}
\arguments{
\item{J}{Integer; sample size (number of observations, must be >= 1).}

\item{alpha}{Numeric; DP concentration parameter (must be positive scalar).}

\item{logS}{Matrix; pre-computed log-Stirling matrix from
\code{\link{compute_log_stirling}}.}

\item{normalize}{Logical; if \code{TRUE} (default), use softmax normalization
for numerical stability. If \code{FALSE}, return raw exponentiated values.}
}
\value{
Numeric vector of length \eqn{J+1} containing
\eqn{P(K_J = k \mid \alpha)} for \eqn{k = 0, 1, \ldots, J}.
Entry \code{[1]} corresponds to \eqn{k=0} and always equals 0.
The vector sums to 1 (when \code{normalize = TRUE}).
}
\description{
Computes \eqn{P(K_J = k \mid \alpha)} for \eqn{k = 0, 1, \ldots, J} using
the Antoniak distribution derived from the Dirichlet process.
}
\details{
The Antoniak distribution gives the exact PMF of the number of occupied
clusters \eqn{K_J} in a Dirichlet process with concentration parameter
\eqn{\alpha}:
\deqn{P(K_J = k \mid \alpha) = |s(J,k)| \frac{\alpha^k}{(\alpha)_J}}

where \eqn{|s(J,k)|} is the unsigned Stirling number of the first kind
and \eqn{(\alpha)_J} is the rising factorial.

Key properties:
\itemize{
\item \eqn{P(K_J = 0) = 0} always (at least one cluster exists)
\item \eqn{P(K_J = J) > 0} for all \eqn{\alpha > 0}
\item As \eqn{\alpha \to 0^+}, mass concentrates on \eqn{K_J = 1}
\item As \eqn{\alpha \to \infty}, mass concentrates on \eqn{K_J = J}
}

Even though the Antoniak formula is theoretically normalized, converting
log-probabilities to the probability scale via \code{exp()} can underflow
for large \code{J} or extreme \code{alpha}. Setting \code{normalize=TRUE}
mitigates this by applying \code{softmax()} to the log-PMF.
}
\examples{
# Compute PMF for J=50, alpha=2
logS <- compute_log_stirling(50)
pmf <- pmf_K_given_alpha(50, 2.0, logS)

# Verify normalization
sum(pmf)  # Should be 1

# Verify P(K=0) = 0
pmf[1]    # Should be 0

# Most likely number of clusters (mode)
which.max(pmf) - 1  # Subtract 1 for 0-indexing

# Compare with moments
k_vals <- 0:50
mean_K <- sum(k_vals * pmf)
var_K <- sum(k_vals^2 * pmf) - mean_K^2

# These should match digamma formulas
mean_K_given_alpha(50, 2.0)
var_K_given_alpha(50, 2.0)

}
\references{
Antoniak, C. E. (1974). Mixtures of Dirichlet Processes with Applications
to Bayesian Nonparametric Problems. \emph{The Annals of Statistics},
2(6), 1152-1174.
}
\seealso{
\code{\link{log_pmf_K_given_alpha}} for log-scale computation,
\code{\link{mode_K_given_alpha}}, \code{\link{cdf_K_given_alpha}},
\code{\link{quantile_K_given_alpha}}
}
