<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>From Poisson Proxy to NegBin: The A1 Approximation Theory ‚Ä¢ DPprior</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="‚Äùimage/svg+xml‚Äù" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="From Poisson Proxy to NegBin: The A1 Approximation Theory">
<meta name="description" content="A rigorous treatment of the Poisson approximation for large J, scaling constant  selection, the Negative Binomial gamma mixture, and the closed-form A1 inverse  mapping for Gamma hyperprior elicitation.
">
<meta property="og:description" content="A rigorous treatment of the Poisson approximation for large J, scaling constant  selection, the Negative Binomial gamma mixture, and the closed-form A1 inverse  mapping for Gamma hyperprior elicitation.
">
<meta property="og:image" content="https://joonho112.github.io/DPprior/logo.svg">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DPprior</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><h6 class="dropdown-header" data-toc-skip>--- Applied Track ---</h6></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/quick-start.html">Quick Start</a></li>
    <li><a class="dropdown-item" href="../articles/applied-guide.html">Applied Guide</a></li>
    <li><a class="dropdown-item" href="../articles/dual-anchor.html">Dual-Anchor Framework</a></li>
    <li><a class="dropdown-item" href="../articles/diagnostics.html">Diagnostics</a></li>
    <li><a class="dropdown-item" href="../articles/case-studies.html">Case Studies</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>--- Methodological Track ---</h6></li>
    <li><a class="dropdown-item" href="../articles/theory-overview.html">Theory Overview</a></li>
    <li><a class="dropdown-item" href="../articles/theory-stirling.html">Stirling Numbers</a></li>
    <li><a class="dropdown-item" href="../articles/theory-approximations.html">Approximations (A1)</a></li>
    <li><a class="dropdown-item" href="../articles/theory-newton.html">Newton Algorithm (A2)</a></li>
    <li><a class="dropdown-item" href="../articles/theory-weights.html">Weight Distributions</a></li>
    <li><a class="dropdown-item" href="../articles/api-reference.html">API Reference</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/joonho112/DPprior/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>From Poisson Proxy to NegBin: The A1 Approximation Theory</h1>
                        <h4 data-toc-skip class="author">JoonHo Lee</h4>
            
            <h4 data-toc-skip class="date">2026-02-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/joonho112/DPprior/blob/main/vignettes/theory-approximations.Rmd" class="external-link"><code>vignettes/theory-approximations.Rmd</code></a></small>
      <div class="d-none name"><code>theory-approximations.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette provides a rigorous mathematical treatment of the
<strong>A1 closed-form approximation</strong> used in the DPprior
package for Gamma hyperprior elicitation. The A1 method transforms
practitioner beliefs about the number of clusters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mi>K</mi></msub><mo>,</mo><msubsup><mi>œÉ</mi><mi>K</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\mu_K, \sigma^2_K)</annotation></semantics></math>
into Gamma hyperparameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(a, b)</annotation></semantics></math>
via a Negative Binomial moment-matching procedure.</p>
<p>We cover:</p>
<ol style="list-style-type: decimal">
<li>The Poisson approximation for large
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>J</mi><annotation encoding="application/x-tex">J</annotation></semantics></math>
and its theoretical foundations</li>
<li>Scaling constant selection:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mi>J</mi></mrow><annotation encoding="application/x-tex">\log J</annotation></semantics></math>
vs harmonic vs digamma</li>
<li>The Negative Binomial gamma mixture identity</li>
<li>The A1 inverse mapping (Theorem 1)</li>
<li>Error analysis and limitations of the approximation</li>
</ol>
<p>Throughout, we carefully distinguish between <strong>established
results</strong> from the literature and <strong>novel
contributions</strong> of this work.</p>
</div>
<div class="section level2">
<h2 id="the-poisson-approximation-for-large-j">1. The Poisson Approximation for Large J<a class="anchor" aria-label="anchor" href="#the-poisson-approximation-for-large-j"></a>
</h2>
<div class="section level3">
<h3 id="established-result-poisson-convergence">1.1 Established Result: Poisson Convergence<a class="anchor" aria-label="anchor" href="#established-result-poisson-convergence"></a>
</h3>
<p>The starting point for the A1 approximation is a classical result on
the asymptotic distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>J</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>Œ±</mi></mrow><annotation encoding="application/x-tex">K_J | \alpha</annotation></semantics></math>.
Recall from the Poisson-Binomial representation (see
<code><a href="../articles/theory-overview.html">vignette("theory-overview")</a></code>) that:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>J</mi></msub><mo>=</mo><munderover><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>J</mi></munderover><msub><mi>B</mi><mi>i</mi></msub><mo>,</mo><mspace width="1.0em"></mspace><msub><mi>B</mi><mi>i</mi></msub><mo>‚àº</mo><mtext mathvariant="normal">Bernoulli</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mi>Œ±</mi><mrow><mi>Œ±</mi><mo>+</mo><mi>i</mi><mo>‚àí</mo><mn>1</mn></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
K_J = \sum_{i=1}^{J} B_i, \quad B_i \sim \text{Bernoulli}\left(\frac{\alpha}{\alpha + i - 1}\right).
</annotation></semantics></math></p>
<p><strong>Attribution.</strong> The following Poisson convergence
result is established in Arratia, Barbour, and Tavar√© (2000), with the
rate explicitly stated in Vicentini and Jermyn (2025, Equation 10):</p>
<p><strong>Theorem (Poisson Approximation).</strong> <em>For fixed
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ±</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\alpha &gt; 0</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo>‚Üí</mo><mi>‚àû</mi></mrow><annotation encoding="application/x-tex">J \to \infty</annotation></semantics></math>:</em>
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mrow><mi>T</mi><mi>V</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>K</mi><mi>J</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="0.222em"></mspace><mtext mathvariant="normal">Poisson</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>K</mi><mi>J</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>O</mi><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mn>1</mn><mrow><mo>log</mo><mi>J</mi></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
d_{TV}\left(p(K_J | \alpha),\ \text{Poisson}(\mathbb{E}[K_J | \alpha])\right) = O\left(\frac{1}{\log J}\right),
</annotation></semantics></math><em>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>d</mi><mrow><mi>T</mi><mi>V</mi></mrow></msub><annotation encoding="application/x-tex">d_{TV}</annotation></semantics></math>
denotes the total variation distance.</em></p>
<p>This convergence, while sublinear, provides the conceptual foundation
for using a Poisson proxy in elicitation.</p>
</div>
<div class="section level3">
<h3 id="the-shifted-poisson-proxy">1.2 The Shifted Poisson Proxy<a class="anchor" aria-label="anchor" href="#the-shifted-poisson-proxy"></a>
</h3>
<p><strong>Novel Contribution.</strong> A key insight motivating the
DPprior approach is that we should apply the Poisson approximation to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>J</mi></msub><mo>‚àí</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">K_J - 1</annotation></semantics></math>
rather than
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>K</mi><mi>J</mi></msub><annotation encoding="application/x-tex">K_J</annotation></semantics></math>
directly.</p>
<p><strong>Rationale.</strong> Any unshifted Poisson approximation has
an unavoidable support mismatch because
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>J</mi></msub><mo>‚â•</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">K_J \geq 1</annotation></semantics></math>
almost surely under the CRP (at least one cluster always exists). If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><mo>=</mo><mtext mathvariant="normal">Poisson</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œª</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Q = \text{Poisson}(\lambda)</annotation></semantics></math>,
then:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mrow><mi>T</mi><mi>V</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>‚Ñí</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>K</mi><mi>J</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="0.222em"></mspace><mi>Q</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚â•</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>Q</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><msup><mi>e</mi><mrow><mo>‚àí</mo><mi>Œª</mi></mrow></msup><mi>.</mi></mrow><annotation encoding="application/x-tex">
d_{TV}(\mathcal{L}(K_J),\ Q) \geq \frac{1}{2}Q(0) = \frac{1}{2}e^{-\lambda}.
</annotation></semantics></math></p>
<p>For small
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
(which occurs when the elicited
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>K</mi><mi>J</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{E}[K_J]</annotation></semantics></math>
is close to 1), this creates a substantial lower bound on the
approximation error.</p>
<p><strong>The A1 proxy (shifted):</strong>
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>J</mi></msub><mo>‚àí</mo><mn>1</mn><mo>‚à£</mo><mi>Œ±</mi><mo>‚âà</mo><mtext mathvariant="normal">Poisson</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œ±</mi><mo>‚ãÖ</mo><msub><mi>c</mi><mi>J</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
K_J - 1 \mid \alpha \approx \text{Poisson}(\alpha \cdot c_J),
</annotation></semantics></math> or equivalently
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>J</mi></msub><mo>‚âà</mo><mn>1</mn><mo>+</mo><mtext mathvariant="normal">Poisson</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œ±</mi><mo>‚ãÖ</mo><msub><mi>c</mi><mi>J</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">K_J \approx 1 + \text{Poisson}(\alpha \cdot c_J)</annotation></semantics></math>.</p>
<p>This shift aligns naturally with Proposition 1 from the theory
vignette, since
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>J</mi></msub><mo>‚àí</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">K_J - 1</annotation></semantics></math>
is a sum of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo>‚àí</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">J-1</annotation></semantics></math>
independent Bernoulli variables
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mn>1</mn></msub><mo>‚â°</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">B_1 \equiv 1</annotation></semantics></math>).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualize the CRP probabilities</span></span>
<span><span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">alpha_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">crp_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">alpha_values</span>, <span class="kw">function</span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="va">J</span></span>
<span>  <span class="va">p_new</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">/</span> <span class="op">(</span><span class="va">a</span> <span class="op">+</span> <span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    customer <span class="op">=</span> <span class="va">i</span>,</span>
<span>    prob_new_table <span class="op">=</span> <span class="va">p_new</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Œ± = "</span>, <span class="va">a</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">crp_data</span><span class="op">$</span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">crp_data</span><span class="op">$</span><span class="va">alpha</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Œ± = "</span>, <span class="va">alpha_values</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">crp_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">customer</span>, y <span class="op">=</span> <span class="va">prob_new_table</span>, color <span class="op">=</span> <span class="va">alpha</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">palette_main</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Customer i"</span>,</span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"P(new table) = "</span> <span class="op">*</span> <span class="va">alpha</span> <span class="op">/</span> <span class="op">(</span><span class="va">alpha</span> <span class="op">+</span> <span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"CRP: Probability of Starting a New Table"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"The expected number of tables ‚âà Œ± ¬∑ log(J)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="theory-approximations_files/figure-html/poisson-intuition-1.png" class="r-plt" alt="Intuition: The probability of opening a new table decreases as customers arrive." width="85%"><p class="caption">
Intuition: The probability of opening a new table decreases as customers
arrive.
</p>
</div>
</div>
<div class="section level3">
<h3 id="mean-approximation">1.3 Mean Approximation<a class="anchor" aria-label="anchor" href="#mean-approximation"></a>
</h3>
<p>The exact conditional mean is (see
<code><a href="../articles/theory-overview.html">vignette("theory-overview")</a></code>):
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œº</mi><mi>J</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>:=</mo><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>K</mi><mi>J</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mi>Œ±</mi><mo>‚ãÖ</mo><mrow><mo stretchy="true" form="prefix">[</mo><mi>œà</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œ±</mi><mo>+</mo><mi>J</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mi>œà</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
\mu_J(\alpha) := \mathbb{E}[K_J | \alpha] = \alpha \cdot [\psi(\alpha + J) - \psi(\alpha)].
</annotation></semantics></math></p>
<p>For the shifted mean:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>K</mi><mi>J</mi></msub><mo>‚àí</mo><mn>1</mn><mo stretchy="false" form="prefix">|</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><msub><mi>Œº</mi><mi>J</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mn>1</mn><mo>‚âà</mo><mi>Œ±</mi><mo>‚ãÖ</mo><msub><mi>c</mi><mi>J</mi></msub><mo>,</mo></mrow><annotation encoding="application/x-tex">
\mathbb{E}[K_J - 1 | \alpha] = \mu_J(\alpha) - 1 \approx \alpha \cdot c_J,
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>c</mi><mi>J</mi></msub><annotation encoding="application/x-tex">c_J</annotation></semantics></math>
is a scaling constant that we now analyze.</p>
</div>
</div>
<div class="section level2">
<h2 id="the-scaling-constant-family">2. The Scaling Constant Family<a class="anchor" aria-label="anchor" href="#the-scaling-constant-family"></a>
</h2>
<div class="section level3">
<h3 id="three-candidates">2.1 Three Candidates<a class="anchor" aria-label="anchor" href="#three-candidates"></a>
</h3>
<p>The A1 approximation requires a deterministic scaling constant
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>J</mi></msub><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">c_J &gt; 0</annotation></semantics></math>
satisfying
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œº</mi><mi>J</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mn>1</mn><mo>‚âà</mo><mi>Œ±</mi><mo>‚ãÖ</mo><msub><mi>c</mi><mi>J</mi></msub></mrow><annotation encoding="application/x-tex">\mu_J(\alpha) - 1 \approx \alpha \cdot c_J</annotation></semantics></math>.
Three natural candidates emerge from asymptotic considerations:</p>
<table class="table">
<colgroup>
<col width="29%">
<col width="29%">
<col width="41%">
</colgroup>
<thead><tr class="header">
<th>Variant</th>
<th>Formula</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>
<strong>log</strong> (default)</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>J</mi></msub><mo>=</mo><mo>log</mo><mi>J</mi></mrow><annotation encoding="application/x-tex">c_J = \log J</annotation></semantics></math></td>
<td>Asymptotic leading term</td>
</tr>
<tr class="even">
<td><strong>harmonic</strong></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>J</mi></msub><mo>=</mo><msub><mi>H</mi><mrow><mi>J</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>œà</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>J</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>Œ≥</mi></mrow><annotation encoding="application/x-tex">c_J = H_{J-1} = \psi(J) + \gamma</annotation></semantics></math></td>
<td>Better for moderate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>J</mi><annotation encoding="application/x-tex">J</annotation></semantics></math>
</td>
</tr>
<tr class="odd">
<td><strong>digamma</strong></td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>J</mi></msub><mo>=</mo><mi>œà</mi><mrow><mo stretchy="true" form="prefix">(</mo><mover><mi>Œ±</mi><mo accent="true">ÃÉ</mo></mover><mo>+</mo><mi>J</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mi>œà</mi><mrow><mo stretchy="true" form="prefix">(</mo><mover><mi>Œ±</mi><mo accent="true">ÃÉ</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">c_J = \psi(\tilde{\alpha} + J) - \psi(\tilde{\alpha})</annotation></semantics></math></td>
<td>Local correction</td>
</tr>
</tbody>
</table>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ≥</mi><mo>‚âà</mo><mn>0.5772</mn></mrow><annotation encoding="application/x-tex">\gamma \approx 0.5772</annotation></semantics></math>
is the Euler-Mascheroni constant and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>Œ±</mi><mo accent="true">ÃÉ</mo></mover><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mi>K</mi></msub><mo>‚àí</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mo>log</mo><mi>J</mi></mrow><annotation encoding="application/x-tex">\tilde{\alpha} = (\mu_K - 1)/\log J</annotation></semantics></math>
is a plug-in estimate.</p>
<p><strong>Lemma (Harmonic-Digamma Equivalence).</strong> For integer
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo>‚â•</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">J \geq 1</annotation></semantics></math>:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mrow><mi>J</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>œà</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>J</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>Œ≥</mi><mi>.</mi></mrow><annotation encoding="application/x-tex">
H_{J-1} = \psi(J) + \gamma.
</annotation></semantics></math></p>
<p>Thus, there are only <strong>two distinct mean-level
competitors</strong> for integer
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>J</mi><annotation encoding="application/x-tex">J</annotation></semantics></math>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mi>J</mi></mrow><annotation encoding="application/x-tex">\log J</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mrow><mi>J</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">H_{J-1}</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare scaling constants across J values</span></span>
<span><span class="va">J_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">200</span>, <span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span><span class="va">scaling_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  J <span class="op">=</span> <span class="va">J_values</span>,</span>
<span>  log_J <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">J_values</span>, <span class="kw">function</span><span class="op">(</span><span class="va">J</span><span class="op">)</span> <span class="fu"><a href="../reference/compute_scaling_constant.html">compute_scaling_constant</a></span><span class="op">(</span><span class="va">J</span>, <span class="st">"log"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  harmonic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">J_values</span>, <span class="kw">function</span><span class="op">(</span><span class="va">J</span><span class="op">)</span> <span class="fu"><a href="../reference/compute_scaling_constant.html">compute_scaling_constant</a></span><span class="op">(</span><span class="va">J</span>, <span class="st">"harmonic"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">scaling_df</span><span class="op">$</span><span class="va">difference</span> <span class="op">&lt;-</span> <span class="va">scaling_df</span><span class="op">$</span><span class="va">harmonic</span> <span class="op">-</span> <span class="va">scaling_df</span><span class="op">$</span><span class="va">log_J</span></span>
<span><span class="va">scaling_df</span><span class="op">$</span><span class="va">ratio</span> <span class="op">&lt;-</span> <span class="va">scaling_df</span><span class="op">$</span><span class="va">harmonic</span> <span class="op">/</span> <span class="va">scaling_df</span><span class="op">$</span><span class="va">log_J</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>  <span class="va">scaling_df</span>,</span>
<span>  digits <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"J"</span>, <span class="st">"log(J)"</span>, <span class="st">"H_{J-1}"</span>, <span class="st">"Difference"</span>, <span class="st">"Ratio"</span><span class="op">)</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Comparison of scaling constants"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Comparison of scaling constants</caption>
<thead><tr class="header">
<th align="right">J</th>
<th align="right">log(J)</th>
<th align="right">H_{J-1}</th>
<th align="right">Difference</th>
<th align="right">Ratio</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">10</td>
<td align="right">2.3026</td>
<td align="right">2.8290</td>
<td align="right">0.5264</td>
<td align="right">1.2286</td>
</tr>
<tr class="even">
<td align="right">25</td>
<td align="right">3.2189</td>
<td align="right">3.7760</td>
<td align="right">0.5571</td>
<td align="right">1.1731</td>
</tr>
<tr class="odd">
<td align="right">50</td>
<td align="right">3.9120</td>
<td align="right">4.4792</td>
<td align="right">0.5672</td>
<td align="right">1.1450</td>
</tr>
<tr class="even">
<td align="right">100</td>
<td align="right">4.6052</td>
<td align="right">5.1774</td>
<td align="right">0.5722</td>
<td align="right">1.1243</td>
</tr>
<tr class="odd">
<td align="right">200</td>
<td align="right">5.2983</td>
<td align="right">5.8730</td>
<td align="right">0.5747</td>
<td align="right">1.1085</td>
</tr>
<tr class="even">
<td align="right">500</td>
<td align="right">6.2146</td>
<td align="right">6.7908</td>
<td align="right">0.5762</td>
<td align="right">1.0927</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="asymptotic-analysis">2.2 Asymptotic Analysis<a class="anchor" aria-label="anchor" href="#asymptotic-analysis"></a>
</h3>
<p><strong>Attribution.</strong> The following asymptotic expansion is
standard (see Abramowitz &amp; Stegun, 1964):</p>
<p><strong>Proposition (Large-J Expansion).</strong> For fixed
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ±</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\alpha &gt; 0</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo>‚Üí</mo><mi>‚àû</mi></mrow><annotation encoding="application/x-tex">J \to \infty</annotation></semantics></math>:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œº</mi><mi>J</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>Œ±</mi><mo>log</mo><mi>J</mi><mo>‚àí</mo><mi>Œ±</mi><mi>œà</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>O</mi><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mi>Œ±</mi><mi>J</mi></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
\mu_J(\alpha) = \alpha \log J - \alpha \psi(\alpha) + O\left(\frac{\alpha}{J}\right).
</annotation></semantics></math></p>
<p>Moreover:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mrow><mi>J</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mo>=</mo><mo>log</mo><mi>J</mi><mo>+</mo><mi>Œ≥</mi><mo>+</mo><mi>O</mi><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mn>1</mn><mi>J</mi></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
H_{J-1} = \log J + \gamma + O\left(\frac{1}{J}\right).
</annotation></semantics></math></p>
<p><strong>Key insight:</strong> The ‚Äúbest‚Äù
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ±</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>-free
linear approximation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ±</mi><msub><mi>c</mi><mi>J</mi></msub></mrow><annotation encoding="application/x-tex">\alpha c_J</annotation></semantics></math>
cannot be uniform in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ±</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
because the second-order term
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>‚àí</mo><mi>Œ±</mi><mi>œà</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">-\alpha\psi(\alpha)</annotation></semantics></math>
depends on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ±</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Show asymptotic behavior</span></span>
<span><span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">alpha_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">5</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="va">asymp_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  alpha <span class="op">=</span> <span class="va">alpha_grid</span>,</span>
<span>  exact <span class="op">=</span> <span class="fu"><a href="../reference/mean_K_given_alpha.html">mean_K_given_alpha</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">alpha_grid</span><span class="op">)</span>,</span>
<span>  log_approx <span class="op">=</span> <span class="va">alpha_grid</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">J</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>  harmonic_approx <span class="op">=</span> <span class="va">alpha_grid</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">digamma</a></span><span class="op">(</span><span class="va">J</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5772156649</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reshape for plotting</span></span>
<span><span class="va">asymp_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">alpha_grid</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  mean_K <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">asymp_data</span><span class="op">$</span><span class="va">exact</span>, <span class="va">asymp_data</span><span class="op">$</span><span class="va">log_approx</span>, <span class="va">asymp_data</span><span class="op">$</span><span class="va">harmonic_approx</span><span class="op">)</span>,</span>
<span>  Method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Exact"</span>, <span class="st">"log(J) + 1"</span>, <span class="st">"H_{J-1} + 1"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">alpha_grid</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">asymp_long</span><span class="op">$</span><span class="va">Method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">asymp_long</span><span class="op">$</span><span class="va">Method</span>, </span>
<span>                            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Exact"</span>, <span class="st">"log(J) + 1"</span>, <span class="st">"H_{J-1} + 1"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">asymp_long</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">alpha</span>, y <span class="op">=</span> <span class="va">mean_K</span>, color <span class="op">=</span> <span class="va">Method</span>, linetype <span class="op">=</span> <span class="va">Method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#000000"</span>, <span class="st">"#E41A1C"</span>, <span class="st">"#377EB8"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_linetype_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"solid"</span>, <span class="st">"dashed"</span>, <span class="st">"dotted"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">E</span><span class="op">[</span><span class="va">K</span><span class="op">[</span><span class="va">J</span><span class="op">]</span> <span class="op">*</span> <span class="st">" | "</span> <span class="op">*</span> <span class="va">alpha</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Exact Mean vs. Linear Approximations (J = 100)"</span><span class="op">)</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"The approximations diverge for small and large Œ±"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="theory-approximations_files/figure-html/asymptotic-expansion-1.png" class="r-plt" alt="The exact mean Œº_J(Œ±) and its linear approximations." width="85%"><p class="caption">
The exact mean Œº_J(Œ±) and its linear approximations.
</p>
</div>
</div>
<div class="section level3">
<h3 id="crossover-analysis">2.3 Crossover Analysis<a class="anchor" aria-label="anchor" href="#crossover-analysis"></a>
</h3>
<p><strong>Novel Contribution.</strong> Define the crossover point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>Œ±</mi><mrow><mi>K</mi><mo>‚àí</mo><mn>1</mn></mrow><mo>*</mo></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>J</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\alpha^*_{K-1}(J)</annotation></semantics></math>
as the value where the shifted mean errors are equal:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>Œº</mi><mi>J</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mn>1</mn><mo>‚àí</mo><mi>Œ±</mi><mo>log</mo><mi>J</mi><mo stretchy="true" form="postfix">|</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>Œº</mi><mi>J</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mn>1</mn><mo>‚àí</mo><mi>Œ±</mi><msub><mi>H</mi><mrow><mi>J</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">|</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
|\mu_J(\alpha) - 1 - \alpha \log J| = |\mu_J(\alpha) - 1 - \alpha H_{J-1}|.
</annotation></semantics></math></p>
<p><strong>Proposition (Limiting Crossover).</strong> As
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo>‚Üí</mo><mi>‚àû</mi></mrow><annotation encoding="application/x-tex">J \to \infty</annotation></semantics></math>:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>Œ±</mi><mrow><mi>K</mi><mo>‚àí</mo><mn>1</mn></mrow><mo>*</mo></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>J</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚Üí</mo><msub><mi>x</mi><mo>*</mo></msub><mo>‚àí</mo><mn>1</mn><mo>‚âà</mo><mn>0.200</mn><mo>,</mo></mrow><annotation encoding="application/x-tex">
\alpha^*_{K-1}(J) \to x_* - 1 \approx 0.200,
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mo>*</mo></msub><mo>=</mo><msup><mi>œà</mi><mrow><mo>‚àí</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚àí</mo><mi>Œ≥</mi><mi>/</mi><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚âà</mo><mn>1.200</mn></mrow><annotation encoding="application/x-tex">x_* = \psi^{-1}(-\gamma/2) \approx 1.200</annotation></semantics></math>
solves
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>œà</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mo>*</mo></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>‚àí</mo><mi>Œ≥</mi><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">\psi(x_*) = -\gamma/2</annotation></semantics></math>.</p>
<p><strong>Practical implication:</strong> For the shifted mean with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ±</mi><mo>‚â≥</mo><mn>0.2</mn></mrow><annotation encoding="application/x-tex">\alpha \gtrsim 0.2</annotation></semantics></math>
(which covers essentially all practical applications), the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mi>J</mi></mrow><annotation encoding="application/x-tex">\log J</annotation></semantics></math>
scaling dominates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mrow><mi>J</mi><mo>‚àí</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">H_{J-1}</annotation></semantics></math>
in terms of mean approximation error.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute mean errors for different scaling choices</span></span>
<span><span class="va">J_test</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">alpha_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">3</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">error_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  alpha <span class="op">=</span> <span class="va">alpha_grid</span>,</span>
<span>  error_log <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="../reference/mean_K_given_alpha.html">mean_K_given_alpha</a></span><span class="op">(</span><span class="va">J_test</span>, <span class="va">alpha_grid</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">-</span> </span>
<span>                  <span class="va">alpha_grid</span> <span class="op">*</span> <span class="fu"><a href="../reference/compute_scaling_constant.html">compute_scaling_constant</a></span><span class="op">(</span><span class="va">J_test</span>, <span class="st">"log"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  error_harmonic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="../reference/mean_K_given_alpha.html">mean_K_given_alpha</a></span><span class="op">(</span><span class="va">J_test</span>, <span class="va">alpha_grid</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">-</span> </span>
<span>                       <span class="va">alpha_grid</span> <span class="op">*</span> <span class="fu"><a href="../reference/compute_scaling_constant.html">compute_scaling_constant</a></span><span class="op">(</span><span class="va">J_test</span>, <span class="st">"harmonic"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">error_df</span><span class="op">$</span><span class="va">better</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">error_df</span><span class="op">$</span><span class="va">error_log</span> <span class="op">&lt;</span> <span class="va">error_df</span><span class="op">$</span><span class="va">error_harmonic</span>, </span>
<span>                          <span class="st">"log(J)"</span>, <span class="st">"H_{J-1}"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Mean error comparison for J ="</span>, <span class="va">J_test</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Mean error comparison for J = 50</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Œ± range where log(J) is better:"</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">error_df</span><span class="op">$</span><span class="va">better</span> <span class="op">==</span> <span class="st">"log(J)"</span><span class="op">)</span>, <span class="st">"out of"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">error_df</span><span class="op">)</span>, <span class="st">"values\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Œ± range where log(J) is better: 29 out of 30 values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Crossover occurs near Œ± ‚âà"</span>, </span>
<span>    <span class="va">error_df</span><span class="op">$</span><span class="va">alpha</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">error_df</span><span class="op">$</span><span class="va">error_log</span> <span class="op">-</span> <span class="va">error_df</span><span class="op">$</span><span class="va">error_harmonic</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Crossover occurs near Œ± ‚âà 0.2</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="default-recommendation">2.4 Default Recommendation<a class="anchor" aria-label="anchor" href="#default-recommendation"></a>
</h3>
<p><strong>Novel Contribution.</strong> Based on the crossover
analysis:</p>
<blockquote>
<p><strong>Default:</strong> Use <strong>shifted Poisson</strong> with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>J</mi></msub><mo>=</mo><mo>log</mo><mi>J</mi></mrow><annotation encoding="application/x-tex">c_J = \log J</annotation></semantics></math>
for the A1 approximation.</p>
</blockquote>
<p>This choice:</p>
<ol style="list-style-type: decimal">
<li>Is simpler to compute</li>
<li>Provides better mean accuracy for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ±</mi><mo>‚â≥</mo><mn>0.2</mn></mrow><annotation encoding="application/x-tex">\alpha \gtrsim 0.2</annotation></semantics></math>
</li>
<li>Aligns with the asymptotic leading term</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="the-negbin-gamma-mixture">3. The NegBin Gamma Mixture<a class="anchor" aria-label="anchor" href="#the-negbin-gamma-mixture"></a>
</h2>
<div class="section level3">
<h3 id="the-key-identity">3.1 The Key Identity<a class="anchor" aria-label="anchor" href="#the-key-identity"></a>
</h3>
<p><strong>Attribution.</strong> The following is a standard result in
Bayesian statistics (see, e.g., the Gamma-Poisson conjugacy):</p>
<p><strong>Proposition (Gamma-Poisson Mixture).</strong> If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo stretchy="false" form="prefix">|</mo><mi>Œª</mi><mo>‚àº</mo><mtext mathvariant="normal">Poisson</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œª</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">X | \lambda \sim \text{Poisson}(\lambda)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œª</mi><mo>‚àº</mo><mtext mathvariant="normal">Gamma</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>b</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\lambda \sim \text{Gamma}(a, b/(b+1))</annotation></semantics></math>,
then:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>‚àº</mo><mtext mathvariant="normal">NegBin</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>b</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
X \sim \text{NegBin}(a, b/(b+1)).
</annotation></semantics></math></p>
<p>More generally, if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo stretchy="false" form="prefix">|</mo><mi>Œª</mi><mo>‚àº</mo><mtext mathvariant="normal">Poisson</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>c</mi><mo>‚ãÖ</mo><mi>Œª</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">X | \lambda \sim \text{Poisson}(c \cdot \lambda)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œª</mi><mo>‚àº</mo><mtext mathvariant="normal">Gamma</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\lambda \sim \text{Gamma}(a, b)</annotation></semantics></math>,
then:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>‚àº</mo><mtext mathvariant="normal">NegBin</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mfrac><mi>b</mi><mrow><mi>b</mi><mo>+</mo><mi>c</mi></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
X \sim \text{NegBin}\left(a, \frac{b}{b + c}\right).
</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="application-to-k_j">3.2 Application to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>K</mi><mi>J</mi></msub><annotation encoding="application/x-tex">K_J</annotation></semantics></math><a class="anchor" aria-label="anchor" href="#application-to-k_j"></a>
</h3>
<p><strong>Novel Application.</strong> Applying this to the A1 proxy
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ±</mi><mo>‚àº</mo><mtext mathvariant="normal">Gamma</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\alpha \sim \text{Gamma}(a, b)</annotation></semantics></math>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>J</mi></msub><mo>‚àí</mo><mn>1</mn><mo>‚à£</mo><mi>Œ±</mi><mo>‚âà</mo><mtext mathvariant="normal">Poisson</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œ±</mi><mo>‚ãÖ</mo><msub><mi>c</mi><mi>J</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="1.0em"></mspace><mo>‚áí</mo><mspace width="1.0em"></mspace><msub><mi>K</mi><mi>J</mi></msub><mo>‚àí</mo><mn>1</mn><mo>‚âà</mo><mtext mathvariant="normal">NegBin</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mfrac><mi>b</mi><mrow><mi>b</mi><mo>+</mo><msub><mi>c</mi><mi>J</mi></msub></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
K_J - 1 \mid \alpha \approx \text{Poisson}(\alpha \cdot c_J)
\quad \Longrightarrow \quad
K_J - 1 \approx \text{NegBin}\left(a, \frac{b}{b + c_J}\right).
</annotation></semantics></math></p>
<p>Under the
NegBin<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>r</mi><mo>,</mo><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(r, p)</annotation></semantics></math>
parameterization where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
is the success probability:</p>
<table class="table">
<colgroup>
<col width="52%">
<col width="47%">
</colgroup>
<thead><tr class="header">
<th>Quantity</th>
<th>Formula</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Mean of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>J</mi></msub><mo>‚àí</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">K_J - 1</annotation></semantics></math>
</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mrow><mi>a</mi><mo>‚ãÖ</mo><msub><mi>c</mi><mi>J</mi></msub></mrow><mi>b</mi></mfrac><annotation encoding="application/x-tex">\displaystyle\frac{a \cdot c_J}{b}</annotation></semantics></math></td>
</tr>
<tr class="even">
<td>Variance of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>J</mi></msub><mo>‚àí</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">K_J - 1</annotation></semantics></math>
</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mrow><mi>a</mi><mo>‚ãÖ</mo><msub><mi>c</mi><mi>J</mi></msub><mo>‚ãÖ</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>b</mi><mo>+</mo><msub><mi>c</mi><mi>J</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><msup><mi>b</mi><mn>2</mn></msup></mfrac><annotation encoding="application/x-tex">\displaystyle\frac{a \cdot c_J \cdot (b + c_J)}{b^2}</annotation></semantics></math></td>
</tr>
<tr class="odd">
<td>Mean of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>K</mi><mi>J</mi></msub><annotation encoding="application/x-tex">K_J</annotation></semantics></math>
</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>+</mo><mfrac><mrow><mi>a</mi><mo>‚ãÖ</mo><msub><mi>c</mi><mi>J</mi></msub></mrow><mi>b</mi></mfrac></mrow><annotation encoding="application/x-tex">\displaystyle 1 + \frac{a \cdot c_J}{b}</annotation></semantics></math></td>
</tr>
<tr class="even">
<td>Variance of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>K</mi><mi>J</mi></msub><annotation encoding="application/x-tex">K_J</annotation></semantics></math>
</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mrow><mi>a</mi><mo>‚ãÖ</mo><msub><mi>c</mi><mi>J</mi></msub><mo>‚ãÖ</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>b</mi><mo>+</mo><msub><mi>c</mi><mi>J</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><msup><mi>b</mi><mn>2</mn></msup></mfrac><annotation encoding="application/x-tex">\displaystyle\frac{a \cdot c_J \cdot (b + c_J)}{b^2}</annotation></semantics></math></td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare NegBin approximation to exact marginal</span></span>
<span><span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">1.5</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">logS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_log_stirling.html">compute_log_stirling</a></span><span class="op">(</span><span class="va">J</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Exact marginal PMF</span></span>
<span><span class="va">pmf_exact</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pmf_K_marginal.html">pmf_K_marginal</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">a</span>, <span class="va">b</span>, <span class="va">logS</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># NegBin approximation</span></span>
<span><span class="va">c_J</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">J</span><span class="op">)</span></span>
<span><span class="va">p_nb</span> <span class="op">&lt;-</span> <span class="va">b</span> <span class="op">/</span> <span class="op">(</span><span class="va">b</span> <span class="op">+</span> <span class="va">c_J</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># NegBin PMF for K-1, then shift</span></span>
<span><span class="va">k_vals</span> <span class="op">&lt;-</span> <span class="fl">0</span><span class="op">:</span><span class="va">J</span></span>
<span><span class="va">pmf_negbin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html" class="external-link">dnbinom</a></span><span class="op">(</span><span class="va">k_vals</span> <span class="op">-</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="va">a</span>, prob <span class="op">=</span> <span class="va">p_nb</span><span class="op">)</span></span>
<span><span class="va">pmf_negbin</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>  <span class="co"># K &gt;= 1</span></span>
<span></span>
<span><span class="co"># Normalize for comparison</span></span>
<span><span class="va">pmf_negbin</span> <span class="op">&lt;-</span> <span class="va">pmf_negbin</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pmf_negbin</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create comparison data</span></span>
<span><span class="va">k_show</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">25</span></span>
<span><span class="va">comparison_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  K <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">k_show</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  Probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pmf_exact</span><span class="op">[</span><span class="va">k_show</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>, <span class="va">pmf_negbin</span><span class="op">[</span><span class="va">k_show</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  Method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Exact Marginal"</span>, <span class="st">"NegBin Approximation"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">k_show</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">comparison_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">K</span>, y <span class="op">=</span> <span class="va">Probability</span>, fill <span class="op">=</span> <span class="va">Method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#377EB8"</span>, <span class="st">"#E41A1C"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">K</span><span class="op">[</span><span class="va">J</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Probability"</span>,</span>
<span>    title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"NegBin Approximation vs Exact Marginal (J = 50)"</span><span class="op">)</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Gamma("</span>, <span class="va">a</span>, <span class="st">", "</span>, <span class="va">b</span>, <span class="st">") prior on Œ±"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="theory-approximations_files/figure-html/negbin-demo-1.png" class="r-plt" alt="The NegBin approximation vs exact marginal distribution." width="85%"><p class="caption">
The NegBin approximation vs exact marginal distribution.
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="the-a1-inverse-mapping-theorem-1">4. The A1 Inverse Mapping (Theorem 1)<a class="anchor" aria-label="anchor" href="#the-a1-inverse-mapping-theorem-1"></a>
</h2>
<div class="section level3">
<h3 id="the-inverse-problem">4.1 The Inverse Problem<a class="anchor" aria-label="anchor" href="#the-inverse-problem"></a>
</h3>
<p>Given practitioner-specified beliefs
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mi>K</mi></msub><mo>,</mo><msubsup><mi>œÉ</mi><mi>K</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\mu_K, \sigma^2_K)</annotation></semantics></math>
about the number of clusters, we seek the Gamma hyperparameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(a, b)</annotation></semantics></math>
such that the marginal distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>K</mi><mi>J</mi></msub><annotation encoding="application/x-tex">K_J</annotation></semantics></math>
has the desired moments.</p>
<p>Under the NegBin proxy, this becomes a moment-matching problem with
an analytical solution.</p>
</div>
<div class="section level3">
<h3 id="main-result">4.2 Main Result<a class="anchor" aria-label="anchor" href="#main-result"></a>
</h3>
<p><strong>Novel Contribution.</strong> The following theorem provides
the closed-form inverse mapping that is central to the A1 method:</p>
<p><strong>Theorem 1 (A1 Inverse Mapping).</strong> Fix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo>‚â•</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">J \geq 2</annotation></semantics></math>
and scaling constant
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>J</mi></msub><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">c_J &gt; 0</annotation></semantics></math>.
Define the shifted mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>:=</mo><msub><mi>Œº</mi><mi>K</mi></msub><mo>‚àí</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">m := \mu_K - 1</annotation></semantics></math>.</p>
<p>If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">m &gt; 0</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>œÉ</mi><mi>K</mi><mn>2</mn></msubsup><mo>&gt;</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">\sigma^2_K &gt; m</annotation></semantics></math>
(overdispersion), then there exists a unique
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àà</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mi>‚àû</mi><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">(a, b) \in (0, \infty)^2</annotation></semantics></math>
that matches
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mi>K</mi></msub><mo>,</mo><msubsup><mi>œÉ</mi><mi>K</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\mu_K, \sigma^2_K)</annotation></semantics></math>
under the NegBin proxy, given by:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><menclose notation="box"><mrow><mi>a</mi><mo>=</mo><mfrac><msup><mi>m</mi><mn>2</mn></msup><mrow><msubsup><mi>œÉ</mi><mi>K</mi><mn>2</mn></msubsup><mo>‚àí</mo><mi>m</mi></mrow></mfrac><mo>,</mo><mspace width="2.0em"></mspace><mi>b</mi><mo>=</mo><mfrac><mrow><mi>m</mi><mo>‚ãÖ</mo><msub><mi>c</mi><mi>J</mi></msub></mrow><mrow><msubsup><mi>œÉ</mi><mi>K</mi><mn>2</mn></msubsup><mo>‚àí</mo><mi>m</mi></mrow></mfrac></mrow></menclose><annotation encoding="application/x-tex">
\boxed{
a = \frac{m^2}{\sigma^2_K - m}, \qquad
b = \frac{m \cdot c_J}{\sigma^2_K - m}
}
</annotation></semantics></math></p>
<p><strong>Proof.</strong> From the NegBin moments:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œº</mi><mi>K</mi></msub><mo>=</mo><mn>1</mn><mo>+</mo><mfrac><mrow><mi>a</mi><mo>‚ãÖ</mo><msub><mi>c</mi><mi>J</mi></msub></mrow><mi>b</mi></mfrac><mspace width="1.0em"></mspace><mo>‚áí</mo><mspace width="1.0em"></mspace><mi>b</mi><mo>=</mo><mfrac><mrow><mi>a</mi><mo>‚ãÖ</mo><msub><mi>c</mi><mi>J</mi></msub></mrow><mi>m</mi></mfrac><mi>.</mi></mrow><annotation encoding="application/x-tex">
\mu_K = 1 + \frac{a \cdot c_J}{b} \quad \Rightarrow \quad b = \frac{a \cdot c_J}{m}.
</annotation></semantics></math></p>
<p>Substituting into the variance equation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>œÉ</mi><mi>K</mi><mn>2</mn></msubsup><mo>=</mo><mfrac><mrow><mi>a</mi><mo>‚ãÖ</mo><msub><mi>c</mi><mi>J</mi></msub><mo>‚ãÖ</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>b</mi><mo>+</mo><msub><mi>c</mi><mi>J</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><msup><mi>b</mi><mn>2</mn></msup></mfrac></mrow><annotation encoding="application/x-tex">\sigma^2_K = \frac{a \cdot c_J \cdot (b + c_J)}{b^2}</annotation></semantics></math>:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>œÉ</mi><mi>K</mi><mn>2</mn></msubsup><mo>=</mo><mfrac><mrow><mi>a</mi><mo>‚ãÖ</mo><msub><mi>c</mi><mi>J</mi></msub><mo>‚ãÖ</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>b</mi><mo>+</mo><msub><mi>c</mi><mi>J</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><msup><mi>b</mi><mn>2</mn></msup></mfrac><mo>=</mo><mi>m</mi><mo>+</mo><mfrac><msup><mi>m</mi><mn>2</mn></msup><mi>a</mi></mfrac><mi>.</mi></mrow><annotation encoding="application/x-tex">
\sigma^2_K = \frac{a \cdot c_J \cdot (b + c_J)}{b^2} = m + \frac{m^2}{a}.
</annotation></semantics></math></p>
<p>Solving for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>a</mi><annotation encoding="application/x-tex">a</annotation></semantics></math>:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mfrac><msup><mi>m</mi><mn>2</mn></msup><mrow><msubsup><mi>œÉ</mi><mi>K</mi><mn>2</mn></msubsup><mo>‚àí</mo><mi>m</mi></mrow></mfrac><mi>.</mi></mrow><annotation encoding="application/x-tex">
a = \frac{m^2}{\sigma^2_K - m}.
</annotation></semantics></math></p>
<p>Positivity requires
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>œÉ</mi><mi>K</mi><mn>2</mn></msubsup><mo>&gt;</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">\sigma^2_K &gt; m</annotation></semantics></math>,
which is the overdispersion condition.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>‚ñ´</mi><annotation encoding="application/x-tex">\square</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="corollary-interpretation-for-alpha">4.3 Corollary: Interpretation for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ±</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math><a class="anchor" aria-label="anchor" href="#corollary-interpretation-for-alpha"></a>
</h3>
<p><strong>Corollary 1.</strong> Under Theorem 1:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mfrac><mi>a</mi><mi>b</mi></mfrac><mo>=</mo><mfrac><mi>m</mi><msub><mi>c</mi><mi>J</mi></msub></mfrac><mo>,</mo><mspace width="2.0em"></mspace><mtext mathvariant="normal">Var</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mi>a</mi><msup><mi>b</mi><mn>2</mn></msup></mfrac><mo>=</mo><mfrac><mrow><msubsup><mi>œÉ</mi><mi>K</mi><mn>2</mn></msubsup><mo>‚àí</mo><mi>m</mi></mrow><msubsup><mi>c</mi><mi>J</mi><mn>2</mn></msubsup></mfrac><mo>,</mo><mspace width="2.0em"></mspace><mtext mathvariant="normal">CV</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mn>1</mn><msqrt><mi>a</mi></msqrt></mfrac><mo>=</mo><mfrac><msqrt><mrow><msubsup><mi>œÉ</mi><mi>K</mi><mn>2</mn></msubsup><mo>‚àí</mo><mi>m</mi></mrow></msqrt><mi>m</mi></mfrac><mi>.</mi></mrow><annotation encoding="application/x-tex">
\mathbb{E}[\alpha] = \frac{a}{b} = \frac{m}{c_J}, \qquad
\text{Var}(\alpha) = \frac{a}{b^2} = \frac{\sigma^2_K - m}{c_J^2}, \qquad
\text{CV}(\alpha) = \frac{1}{\sqrt{a}} = \frac{\sqrt{\sigma^2_K - m}}{m}.
</annotation></semantics></math></p>
<p><strong>Interpretation:</strong> Under A1,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mi>K</mi></msub><annotation encoding="application/x-tex">\mu_K</annotation></semantics></math>
determines the prior mean of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ±</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>,
while the ‚Äúconfidence‚Äù (through
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>œÉ</mi><mi>K</mi><mn>2</mn></msubsup><mo>‚àí</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">\sigma^2_K - m</annotation></semantics></math>)
determines the prior variance of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ±</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Demonstrate the A1 mapping</span></span>
<span><span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">mu_K</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">var_K</span> <span class="op">&lt;-</span> <span class="fl">8</span></span>
<span></span>
<span><span class="co"># Step-by-step calculation</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="va">mu_K</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="va">D</span> <span class="op">&lt;-</span> <span class="va">var_K</span> <span class="op">-</span> <span class="va">m</span></span>
<span><span class="va">c_J</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">J</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"A1 Inverse Mapping Demonstration\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; A1 Inverse Mapping Demonstration</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"="</span>, <span class="fl">50</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, <span class="st">"\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ==================================================</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Inputs:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Inputs:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  J = %d\n"</span>, <span class="va">J</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   J = 50</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  Œº_K = %.1f\n"</span>, <span class="va">mu_K</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Œº_K = 5.0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  œÉ¬≤_K = %.1f\n\n"</span>, <span class="va">var_K</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   œÉ¬≤_K = 8.0</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Intermediate calculations:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Intermediate calculations:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  m = Œº_K - 1 = %.1f\n"</span>, <span class="va">m</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   m = Œº_K - 1 = 4.0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  D = œÉ¬≤_K - m = %.1f\n"</span>, <span class="va">D</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   D = œÉ¬≤_K - m = 4.0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  c_J = log(J) = %.4f\n\n"</span>, <span class="va">c_J</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   c_J = log(J) = 3.9120</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"A1 formulas:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; A1 formulas:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  a = m¬≤ / D = %.1f¬≤ / %.1f = %.4f\n"</span>, <span class="va">m</span>, <span class="va">D</span>, <span class="va">m</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="va">D</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   a = m¬≤ / D = 4.0¬≤ / 4.0 = 4.0000</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  b = m ¬∑ c_J / D = %.1f √ó %.4f / %.1f = %.4f\n\n"</span>, <span class="va">m</span>, <span class="va">c_J</span>, <span class="va">D</span>, <span class="va">m</span><span class="op">*</span><span class="va">c_J</span><span class="op">/</span><span class="va">D</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   b = m ¬∑ c_J / D = 4.0 √ó 3.9120 / 4.0 = 3.9120</span></span>
<span></span>
<span><span class="co"># Use DPprior_a1 to verify</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_a1.html">DPprior_a1</a></span><span class="op">(</span>J <span class="op">=</span> <span class="va">J</span>, mu_K <span class="op">=</span> <span class="va">mu_K</span>, var_K <span class="op">=</span> <span class="va">var_K</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"DPprior_a1() result:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; DPprior_a1() result:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  a = %.4f\n"</span>, <span class="va">fit</span><span class="op">$</span><span class="va">a</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   a = 4.0000</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  b = %.4f\n"</span>, <span class="va">fit</span><span class="op">$</span><span class="va">b</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   b = 3.9120</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  E[Œ±] = a/b = %.4f\n"</span>, <span class="va">fit</span><span class="op">$</span><span class="va">a</span> <span class="op">/</span> <span class="va">fit</span><span class="op">$</span><span class="va">b</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   E[Œ±] = a/b = 1.0225</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  CV(Œ±) = 1/‚àöa = %.4f\n"</span>, <span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">a</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   CV(Œ±) = 1/‚àöa = 0.5000</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="feasibility-region">4.4 Feasibility Region<a class="anchor" aria-label="anchor" href="#feasibility-region"></a>
</h3>
<p><strong>Novel Contribution.</strong> The feasibility constraints for
A1 are:</p>
<p><strong>Shifted A1 (default, for DP partitions):</strong>
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œº</mi><mi>K</mi></msub><mo>&gt;</mo><mn>1</mn><mspace width="1.0em"></mspace><mtext mathvariant="normal">and</mtext><mspace width="1.0em"></mspace><msubsup><mi>œÉ</mi><mi>K</mi><mn>2</mn></msubsup><mo>&gt;</mo><msub><mi>Œº</mi><mi>K</mi></msub><mo>‚àí</mo><mn>1</mn><mi>.</mi></mrow><annotation encoding="application/x-tex">
\mu_K &gt; 1 \quad \text{and} \quad \sigma^2_K &gt; \mu_K - 1.
</annotation></semantics></math></p>
<p>These are <strong>proxy-model</strong> constraints arising from the
NegBin moment identity, not fundamental constraints of the DP
itself.</p>
<p><strong>Important:</strong> Some user specifications with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>œÉ</mi><mi>K</mi><mn>2</mn></msubsup><mo>‚â§</mo><msub><mi>Œº</mi><mi>K</mi></msub><mo>‚àí</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sigma^2_K \leq \mu_K - 1</annotation></semantics></math>
may be <strong>feasible under the exact DP</strong> but
<strong>infeasible under A1</strong>. In such cases, the package
projects to the feasibility boundary.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Demonstrate feasibility projection</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Feasibility Demonstration\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Feasibility Demonstration</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"="</span>, <span class="fl">50</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, <span class="st">"\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ==================================================</span></span>
<span></span>
<span><span class="co"># Case 1: Feasible</span></span>
<span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_a1.html">DPprior_a1</a></span><span class="op">(</span>J <span class="op">=</span> <span class="fl">50</span>, mu_K <span class="op">=</span> <span class="fl">5</span>, var_K <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Case 1: Feasible (var_K = 8 &gt; Œº_K - 1 = 4)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Case 1: Feasible (var_K = 8 &gt; Œº_K - 1 = 4)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  Status: %s\n\n"</span>, <span class="va">fit1</span><span class="op">$</span><span class="va">status</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Status: success</span></span>
<span></span>
<span><span class="co"># Case 2: Infeasible - requires projection</span></span>
<span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_a1.html">DPprior_a1</a></span><span class="op">(</span>J <span class="op">=</span> <span class="fl">50</span>, mu_K <span class="op">=</span> <span class="fl">5</span>, var_K <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: var_K &lt;= mu_K - 1: projected to feasible boundary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Case 2: Infeasible (var_K = 3 &lt; Œº_K - 1 = 4)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Case 2: Infeasible (var_K = 3 &lt; Œº_K - 1 = 4)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  Status: %s\n"</span>, <span class="va">fit2</span><span class="op">$</span><span class="va">status</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Status: projected</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  Original var_K: %.1f\n"</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Original var_K: 3.0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  Projected var_K: %.6f\n"</span>, <span class="va">fit2</span><span class="op">$</span><span class="va">target</span><span class="op">$</span><span class="va">var_K_used</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="near-boundary-sensitivity">4.5 Near-Boundary Sensitivity<a class="anchor" aria-label="anchor" href="#near-boundary-sensitivity"></a>
</h3>
<p><strong>Novel Contribution.</strong> Define
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo>:=</mo><msubsup><mi>œÉ</mi><mi>K</mi><mn>2</mn></msubsup><mo>‚àí</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">D := \sigma^2_K - m</annotation></semantics></math>.
As
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo>‚Üì</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">D \downarrow 0</annotation></semantics></math>:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>‚àº</mo><mfrac><msup><mi>m</mi><mn>2</mn></msup><mi>D</mi></mfrac><mo>‚Üí</mo><mi>‚àû</mi><mo>,</mo><mspace width="2.0em"></mspace><mi>b</mi><mo>‚àº</mo><mfrac><mrow><mi>m</mi><mo>‚ãÖ</mo><msub><mi>c</mi><mi>J</mi></msub></mrow><mi>D</mi></mfrac><mo>‚Üí</mo><mi>‚àû</mi><mo>,</mo></mrow><annotation encoding="application/x-tex">
a \sim \frac{m^2}{D} \to \infty, \qquad b \sim \frac{m \cdot c_J}{D} \to \infty,
</annotation></semantics></math> while
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mi>m</mi><mi>/</mi><msub><mi>c</mi><mi>J</mi></msub></mrow><annotation encoding="application/x-tex">\mathbb{E}[\alpha] = m/c_J</annotation></semantics></math>
remains finite.</p>
<p>The sensitivities scale as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>D</mi><mrow><mo>‚àí</mo><mn>2</mn></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">O(D^{-2})</annotation></semantics></math>,
meaning that high-confidence specifications (small
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math>)
lead to numerically ill-conditioned mappings. This motivates the
projection buffer in the implementation.</p>
</div>
</div>
<div class="section level2">
<h2 id="error-analysis">5. Error Analysis<a class="anchor" aria-label="anchor" href="#error-analysis"></a>
</h2>
<div class="section level3">
<h3 id="sources-of-approximation-error">5.1 Sources of Approximation Error<a class="anchor" aria-label="anchor" href="#sources-of-approximation-error"></a>
</h3>
<p>The A1 method introduces several sources of error:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Poisson proxy error:</strong> The
finite-<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>J</mi><annotation encoding="application/x-tex">J</annotation></semantics></math>
deviation from the Poisson limit</li>
<li>
<strong>Scaling constant choice:</strong> Different
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>c</mi><mi>J</mi></msub><annotation encoding="application/x-tex">c_J</annotation></semantics></math>
options introduce different biases</li>
<li>
<strong>Moment matching vs.¬†distribution matching:</strong> Even if
moments match, the full distributions may differ</li>
</ol>
</div>
<div class="section level3">
<h3 id="quantifying-moment-error">5.2 Quantifying Moment Error<a class="anchor" aria-label="anchor" href="#quantifying-moment-error"></a>
</h3>
<p><strong>Novel Contribution.</strong> We can directly compare the
A1-achieved moments against the exact marginal moments:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare A1 moments to exact moments</span></span>
<span><span class="va">test_cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>  J <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">200</span><span class="op">)</span>,</span>
<span>  mu_K <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  vif <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter valid cases first</span></span>
<span><span class="va">test_cases</span> <span class="op">&lt;-</span> <span class="va">test_cases</span><span class="op">[</span><span class="va">test_cases</span><span class="op">$</span><span class="va">mu_K</span> <span class="op">&lt;</span> <span class="va">test_cases</span><span class="op">$</span><span class="va">J</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">test_cases</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">J</span> <span class="op">&lt;-</span> <span class="va">test_cases</span><span class="op">$</span><span class="va">J</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">mu_K</span> <span class="op">&lt;-</span> <span class="va">test_cases</span><span class="op">$</span><span class="va">mu_K</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">vif</span> <span class="op">&lt;-</span> <span class="va">test_cases</span><span class="op">$</span><span class="va">vif</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">var_K</span> <span class="op">&lt;-</span> <span class="va">vif</span> <span class="op">*</span> <span class="op">(</span><span class="va">mu_K</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># A1 mapping</span></span>
<span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_a1.html">DPprior_a1</a></span><span class="op">(</span>J <span class="op">=</span> <span class="va">J</span>, mu_K <span class="op">=</span> <span class="va">mu_K</span>, var_K <span class="op">=</span> <span class="va">var_K</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Exact moments with A1 parameters</span></span>
<span>  <span class="va">exact</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/exact_K_moments.html">exact_K_moments</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">fit</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit</span><span class="op">$</span><span class="va">b</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    J <span class="op">=</span> <span class="va">J</span>,</span>
<span>    mu_K_target <span class="op">=</span> <span class="va">mu_K</span>,</span>
<span>    var_K_target <span class="op">=</span> <span class="va">var_K</span>,</span>
<span>    mu_K_achieved <span class="op">=</span> <span class="va">exact</span><span class="op">$</span><span class="va">mean</span>,</span>
<span>    var_K_achieved <span class="op">=</span> <span class="va">exact</span><span class="op">$</span><span class="va">var</span>,</span>
<span>    mu_error_pct <span class="op">=</span> <span class="fl">100</span> <span class="op">*</span> <span class="op">(</span><span class="va">exact</span><span class="op">$</span><span class="va">mean</span> <span class="op">-</span> <span class="va">mu_K</span><span class="op">)</span> <span class="op">/</span> <span class="va">mu_K</span>,</span>
<span>    var_error_pct <span class="op">=</span> <span class="fl">100</span> <span class="op">*</span> <span class="op">(</span><span class="va">exact</span><span class="op">$</span><span class="va">var</span> <span class="op">-</span> <span class="va">var_K</span><span class="op">)</span> <span class="op">/</span> <span class="va">var_K</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>  <span class="va">results</span>,</span>
<span>  digits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"J"</span>, <span class="st">"Œº_K (target)"</span>, <span class="st">"œÉ¬≤_K (target)"</span>, </span>
<span>                <span class="st">"Œº_K (achieved)"</span>, <span class="st">"œÉ¬≤_K (achieved)"</span>,</span>
<span>                <span class="st">"Mean Error %"</span>, <span class="st">"Var Error %"</span><span class="op">)</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"A1 approximation error: target vs. achieved moments"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>A1 approximation error: target vs.¬†achieved moments</caption>
<colgroup>
<col width="4%">
<col width="14%">
<col width="16%">
<col width="17%">
<col width="18%">
<col width="14%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="right">J</th>
<th align="right">Œº_K (target)</th>
<th align="right">œÉ¬≤_K (target)</th>
<th align="right">Œº_K (achieved)</th>
<th align="right">œÉ¬≤_K (achieved)</th>
<th align="right">Mean Error %</th>
<th align="right">Var Error %</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">25</td>
<td align="right">5</td>
<td align="right">6.0</td>
<td align="right">4.27</td>
<td align="right">3.22</td>
<td align="right">-14.6</td>
<td align="right">-46.3</td>
</tr>
<tr class="even">
<td align="right">50</td>
<td align="right">5</td>
<td align="right">6.0</td>
<td align="right">4.51</td>
<td align="right">3.89</td>
<td align="right">-9.8</td>
<td align="right">-35.2</td>
</tr>
<tr class="odd">
<td align="right">100</td>
<td align="right">5</td>
<td align="right">6.0</td>
<td align="right">4.67</td>
<td align="right">4.37</td>
<td align="right">-6.6</td>
<td align="right">-27.2</td>
</tr>
<tr class="even">
<td align="right">200</td>
<td align="right">5</td>
<td align="right">6.0</td>
<td align="right">4.77</td>
<td align="right">4.72</td>
<td align="right">-4.5</td>
<td align="right">-21.3</td>
</tr>
<tr class="odd">
<td align="right">25</td>
<td align="right">10</td>
<td align="right">13.5</td>
<td align="right">6.84</td>
<td align="right">4.58</td>
<td align="right">-31.6</td>
<td align="right">-66.0</td>
</tr>
<tr class="even">
<td align="right">50</td>
<td align="right">10</td>
<td align="right">13.5</td>
<td align="right">7.64</td>
<td align="right">6.21</td>
<td align="right">-23.6</td>
<td align="right">-54.0</td>
</tr>
<tr class="odd">
<td align="right">100</td>
<td align="right">10</td>
<td align="right">13.5</td>
<td align="right">8.21</td>
<td align="right">7.53</td>
<td align="right">-17.9</td>
<td align="right">-44.2</td>
</tr>
<tr class="even">
<td align="right">200</td>
<td align="right">10</td>
<td align="right">13.5</td>
<td align="right">8.61</td>
<td align="right">8.57</td>
<td align="right">-13.9</td>
<td align="right">-36.5</td>
</tr>
<tr class="odd">
<td align="right">25</td>
<td align="right">5</td>
<td align="right">8.0</td>
<td align="right">4.21</td>
<td align="right">3.86</td>
<td align="right">-15.8</td>
<td align="right">-51.7</td>
</tr>
<tr class="even">
<td align="right">50</td>
<td align="right">5</td>
<td align="right">8.0</td>
<td align="right">4.46</td>
<td align="right">4.78</td>
<td align="right">-10.8</td>
<td align="right">-40.2</td>
</tr>
<tr class="odd">
<td align="right">100</td>
<td align="right">5</td>
<td align="right">8.0</td>
<td align="right">4.63</td>
<td align="right">5.48</td>
<td align="right">-7.5</td>
<td align="right">-31.5</td>
</tr>
<tr class="even">
<td align="right">200</td>
<td align="right">5</td>
<td align="right">8.0</td>
<td align="right">4.74</td>
<td align="right">6.00</td>
<td align="right">-5.2</td>
<td align="right">-25.0</td>
</tr>
<tr class="odd">
<td align="right">25</td>
<td align="right">10</td>
<td align="right">18.0</td>
<td align="right">6.78</td>
<td align="right">5.31</td>
<td align="right">-32.2</td>
<td align="right">-70.5</td>
</tr>
<tr class="even">
<td align="right">50</td>
<td align="right">10</td>
<td align="right">18.0</td>
<td align="right">7.59</td>
<td align="right">7.43</td>
<td align="right">-24.1</td>
<td align="right">-58.7</td>
</tr>
<tr class="odd">
<td align="right">100</td>
<td align="right">10</td>
<td align="right">18.0</td>
<td align="right">8.16</td>
<td align="right">9.24</td>
<td align="right">-18.4</td>
<td align="right">-48.7</td>
</tr>
<tr class="even">
<td align="right">200</td>
<td align="right">10</td>
<td align="right">18.0</td>
<td align="right">8.57</td>
<td align="right">10.70</td>
<td align="right">-14.3</td>
<td align="right">-40.6</td>
</tr>
<tr class="odd">
<td align="right">25</td>
<td align="right">5</td>
<td align="right">12.0</td>
<td align="right">4.10</td>
<td align="right">4.98</td>
<td align="right">-17.9</td>
<td align="right">-58.5</td>
</tr>
<tr class="even">
<td align="right">50</td>
<td align="right">5</td>
<td align="right">12.0</td>
<td align="right">4.37</td>
<td align="right">6.40</td>
<td align="right">-12.6</td>
<td align="right">-46.7</td>
</tr>
<tr class="odd">
<td align="right">100</td>
<td align="right">5</td>
<td align="right">12.0</td>
<td align="right">4.55</td>
<td align="right">7.52</td>
<td align="right">-9.0</td>
<td align="right">-37.4</td>
</tr>
<tr class="even">
<td align="right">200</td>
<td align="right">5</td>
<td align="right">12.0</td>
<td align="right">4.67</td>
<td align="right">8.38</td>
<td align="right">-6.6</td>
<td align="right">-30.2</td>
</tr>
<tr class="odd">
<td align="right">25</td>
<td align="right">10</td>
<td align="right">27.0</td>
<td align="right">6.67</td>
<td align="right">6.67</td>
<td align="right">-33.3</td>
<td align="right">-75.3</td>
</tr>
<tr class="even">
<td align="right">50</td>
<td align="right">10</td>
<td align="right">27.0</td>
<td align="right">7.48</td>
<td align="right">9.76</td>
<td align="right">-25.2</td>
<td align="right">-63.8</td>
</tr>
<tr class="odd">
<td align="right">100</td>
<td align="right">10</td>
<td align="right">27.0</td>
<td align="right">8.07</td>
<td align="right">12.51</td>
<td align="right">-19.3</td>
<td align="right">-53.7</td>
</tr>
<tr class="even">
<td align="right">200</td>
<td align="right">10</td>
<td align="right">27.0</td>
<td align="right">8.49</td>
<td align="right">14.79</td>
<td align="right">-15.1</td>
<td align="right">-45.2</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="systematic-patterns">5.3 Systematic Patterns<a class="anchor" aria-label="anchor" href="#systematic-patterns"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create heatmap of A1 mean errors</span></span>
<span><span class="va">J_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">75</span>, <span class="fl">100</span>, <span class="fl">150</span>, <span class="fl">200</span><span class="op">)</span></span>
<span><span class="va">mu_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">15</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">error_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">J_grid</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mu_grid</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">error_matrix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"J="</span>, <span class="va">J_grid</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">error_matrix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Œº="</span>, <span class="va">mu_grid</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">J_grid</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">mu_grid</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">J</span> <span class="op">&lt;-</span> <span class="va">J_grid</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="va">mu_K</span> <span class="op">&lt;-</span> <span class="va">mu_grid</span><span class="op">[</span><span class="va">j</span><span class="op">]</span></span>
<span>    </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">mu_K</span> <span class="op">&lt;</span> <span class="va">J</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">var_K</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">mu_K</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>  <span class="co"># VIF = 2</span></span>
<span>      <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_a1.html">DPprior_a1</a></span><span class="op">(</span>J <span class="op">=</span> <span class="va">J</span>, mu_K <span class="op">=</span> <span class="va">mu_K</span>, var_K <span class="op">=</span> <span class="va">var_K</span><span class="op">)</span></span>
<span>      <span class="va">exact</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/exact_K_moments.html">exact_K_moments</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">fit</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit</span><span class="op">$</span><span class="va">b</span><span class="op">)</span></span>
<span>      <span class="va">error_matrix</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="op">(</span><span class="va">exact</span><span class="op">$</span><span class="va">mean</span> <span class="op">-</span> <span class="va">mu_K</span><span class="op">)</span> <span class="op">/</span> <span class="va">mu_K</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Convert to data frame for ggplot</span></span>
<span><span class="va">error_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>J <span class="op">=</span> <span class="va">J_grid</span>, mu_K <span class="op">=</span> <span class="va">mu_grid</span><span class="op">)</span></span>
<span><span class="va">error_df</span><span class="op">$</span><span class="va">error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">error_matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">error_df</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">error_df</span><span class="op">$</span><span class="va">error</span><span class="op">)</span>, <span class="op">]</span>, </span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">mu_K</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">J</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">error</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_tile</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.1f%%"</span>, <span class="va">error</span><span class="op">)</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_gradient2</span><span class="op">(</span>low <span class="op">=</span> <span class="st">"#377EB8"</span>, mid <span class="op">=</span> <span class="st">"white"</span>, high <span class="op">=</span> <span class="st">"#E41A1C"</span>,</span>
<span>                       midpoint <span class="op">=</span> <span class="fl">0</span>, name <span class="op">=</span> <span class="st">"Mean\nError %"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Target "</span> <span class="op">*</span> <span class="va">mu</span><span class="op">[</span><span class="va">K</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Sample Size J"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"A1 Mean Error Pattern"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"VIF = 2 for all cases"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="theory-approximations_files/figure-html/error-heatmap-1.png" class="r-plt" alt="A1 mean error as a function of J and Œº_K." width="85%"><p class="caption">
A1 mean error as a function of J and Œº_K.
</p>
</div>
</div>
<div class="section level3">
<h3 id="critical-warning-negbin-marginal-limitations">5.4 Critical Warning: NegBin Marginal Limitations<a class="anchor" aria-label="anchor" href="#critical-warning-negbin-marginal-limitations"></a>
</h3>
<p><strong>Novel Finding.</strong> Tables from the research notes
demonstrate that the NegBin marginal approximation can produce:</p>
<ul>
<li>Mean errors of 40-75%</li>
<li>Variance errors of 230-730%</li>
</ul>
<p>This confirms that <strong>A1 should be viewed primarily as an
initializer</strong>, not as a final solution. The A2 Newton refinement
(see <code><a href="../articles/theory-newton.html">vignette("theory-newton")</a></code>) should be applied for any
application requiring accurate moment matching.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare A1 to A2 refinement</span></span>
<span><span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">mu_K</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">var_K</span> <span class="op">&lt;-</span> <span class="fl">8</span></span>
<span></span>
<span><span class="co"># A1 only</span></span>
<span><span class="va">fit_a1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_a1.html">DPprior_a1</a></span><span class="op">(</span>J <span class="op">=</span> <span class="va">J</span>, mu_K <span class="op">=</span> <span class="va">mu_K</span>, var_K <span class="op">=</span> <span class="va">var_K</span><span class="op">)</span></span>
<span><span class="va">exact_a1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/exact_K_moments.html">exact_K_moments</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">fit_a1</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_a1</span><span class="op">$</span><span class="va">b</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># A2 refinement (full DPprior_fit)</span></span>
<span><span class="va">fit_a2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_fit.html">DPprior_fit</a></span><span class="op">(</span>J <span class="op">=</span> <span class="va">J</span>, mu_K <span class="op">=</span> <span class="va">mu_K</span>, var_K <span class="op">=</span> <span class="va">var_K</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: HIGH DOMINANCE RISK: P(w1 &gt; 0.5) = 48.1% exceeds 40%.</span></span>
<span><span class="co">#&gt;   This may indicate unintended prior behavior (Lee, 2026).</span></span>
<span><span class="co">#&gt;   Consider using DPprior_dual() for weight-constrained elicitation.</span></span>
<span><span class="co">#&gt;   See ?DPprior_diagnostics for interpretation.</span></span>
<span><span class="va">exact_a2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/exact_K_moments.html">exact_K_moments</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">fit_a2</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_a2</span><span class="op">$</span><span class="va">b</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Comparison: A1 vs A2 Refinement\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Comparison: A1 vs A2 Refinement</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"="</span>, <span class="fl">50</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, <span class="st">"\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ==================================================</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Target: Œº_K = %.1f, œÉ¬≤_K = %.1f\n\n"</span>, <span class="va">mu_K</span>, <span class="va">var_K</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Target: Œº_K = 5.0, œÉ¬≤_K = 8.0</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"A1 (closed-form):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; A1 (closed-form):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  Parameters: a = %.4f, b = %.4f\n"</span>, <span class="va">fit_a1</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_a1</span><span class="op">$</span><span class="va">b</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Parameters: a = 4.0000, b = 3.9120</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  Achieved:   Œº_K = %.4f, œÉ¬≤_K = %.4f\n"</span>, <span class="va">exact_a1</span><span class="op">$</span><span class="va">mean</span>, <span class="va">exact_a1</span><span class="op">$</span><span class="va">var</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Achieved:   Œº_K = 4.4614, œÉ¬≤_K = 4.7831</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  Errors:     %.2f%% (mean), %.2f%% (var)\n\n"</span>,</span>
<span>            <span class="fl">100</span> <span class="op">*</span> <span class="op">(</span><span class="va">exact_a1</span><span class="op">$</span><span class="va">mean</span> <span class="op">-</span> <span class="va">mu_K</span><span class="op">)</span> <span class="op">/</span> <span class="va">mu_K</span>,</span>
<span>            <span class="fl">100</span> <span class="op">*</span> <span class="op">(</span><span class="va">exact_a1</span><span class="op">$</span><span class="va">var</span> <span class="op">-</span> <span class="va">var_K</span><span class="op">)</span> <span class="op">/</span> <span class="va">var_K</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Errors:     -10.77% (mean), -40.21% (var)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"A2 (Newton refinement):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; A2 (Newton refinement):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  Parameters: a = %.4f, b = %.4f\n"</span>, <span class="va">fit_a2</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_a2</span><span class="op">$</span><span class="va">b</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Parameters: a = 2.0361, b = 1.6051</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  Achieved:   Œº_K = %.6f, œÉ¬≤_K = %.6f\n"</span>, <span class="va">exact_a2</span><span class="op">$</span><span class="va">mean</span>, <span class="va">exact_a2</span><span class="op">$</span><span class="va">var</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Achieved:   Œº_K = 5.000000, œÉ¬≤_K = 8.000000</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  Errors:     %.2e%% (mean), %.2e%% (var)\n"</span>,</span>
<span>            <span class="fl">100</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">exact_a2</span><span class="op">$</span><span class="va">mean</span> <span class="op">-</span> <span class="va">mu_K</span><span class="op">)</span> <span class="op">/</span> <span class="va">mu_K</span>,</span>
<span>            <span class="fl">100</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">exact_a2</span><span class="op">$</span><span class="va">var</span> <span class="op">-</span> <span class="va">var_K</span><span class="op">)</span> <span class="op">/</span> <span class="va">var_K</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Errors:     1.66e-08% (mean), 9.44e-08% (var)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="summary">6. Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>This vignette has provided a rigorous treatment of the A1
approximation theory:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Poisson approximation:</strong> The classical result that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>J</mi></msub><mo>‚àí</mo><mn>1</mn><mo stretchy="false" form="prefix">|</mo><mi>Œ±</mi></mrow><annotation encoding="application/x-tex">K_J - 1 | \alpha</annotation></semantics></math>
converges to
Poisson<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>Œ±</mi><mo>‚ãÖ</mo><msub><mi>c</mi><mi>J</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\alpha \cdot c_J)</annotation></semantics></math>
provides the theoretical foundation.</p></li>
<li><p><strong>Scaling constant:</strong> The default
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>J</mi></msub><mo>=</mo><mo>log</mo><mi>J</mi></mrow><annotation encoding="application/x-tex">c_J = \log J</annotation></semantics></math>
provides the best mean-level accuracy for typical
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ±</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
values.</p></li>
<li><p><strong>NegBin mixture:</strong> When
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ±</mi><mo>‚àº</mo><mtext mathvariant="normal">Gamma</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\alpha \sim \text{Gamma}(a, b)</annotation></semantics></math>,
the marginal
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>J</mi></msub><mo>‚àí</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">K_J - 1</annotation></semantics></math>
approximately follows a Negative Binomial distribution.</p></li>
<li><p><strong>Inverse mapping:</strong> Theorem 1 provides closed-form
expressions for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(a, b)</annotation></semantics></math>
given target moments
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mi>K</mi></msub><mo>,</mo><msubsup><mi>œÉ</mi><mi>K</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\mu_K, \sigma^2_K)</annotation></semantics></math>.</p></li>
<li><p><strong>Limitations:</strong> The A1 approximation can have
substantial errors and should be viewed as an initializer for the A2
Newton refinement.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Abramowitz, M., &amp; Stegun, I. A. (1964). <em>Handbook of
Mathematical Functions</em>. National Bureau of Standards.</p>
<p>Antoniak, C. E. (1974). Mixtures of Dirichlet processes with
applications to Bayesian nonparametric problems. <em>The Annals of
Statistics</em>, 2(6), 1152-1174.</p>
<p>Arratia, R., Barbour, A. D., &amp; Tavar√©, S. (2000). The number of
components in a logarithmic combinatorial structure. <em>The Annals of
Applied Probability</em>, 10(2), 331-361.</p>
<p>Dorazio, R. M. (2009). On selecting a prior for the precision
parameter of Dirichlet process mixture models. <em>Journal of
Statistical Planning and Inference</em>, 139(10), 3384-3390.</p>
<p>Murugiah, S., &amp; Sweeting, T. J. (2012). Selecting the precision
parameter prior in Dirichlet process mixture models. <em>Journal of
Statistical Computation and Simulation</em>, 82(9), 1307-1322.</p>
<p>Vicentini, C., &amp; Jermyn, I. H. (2025). Prior selection for the
precision parameter of Dirichlet process mixtures.
<em>arXiv:2502.00864</em>.</p>
<hr>
<p><em>For questions about this vignette or the DPprior package, please
visit the <a href="https://github.com/joonho112/DPprior" class="external-link">GitHub
repository</a>.</em></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/joonho112" class="external-link">JoonHo Lee</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
