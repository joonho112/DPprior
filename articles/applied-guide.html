<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>The Applied Researcher's Guide to Cluster-Count Elicitation • DPprior</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The Applied Researcher's Guide to Cluster-Count Elicitation">
<meta name="description" content="A comprehensive guide for applied researchers on eliciting Gamma hyperpriors  for the Dirichlet Process concentration parameter α based on prior beliefs  about the number of clusters.
">
<meta property="og:description" content="A comprehensive guide for applied researchers on eliciting Gamma hyperpriors  for the Dirichlet Process concentration parameter α based on prior beliefs  about the number of clusters.
">
<meta property="og:image" content="https://joonho112.github.io/DPprior/logo.svg">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DPprior</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><h6 class="dropdown-header" data-toc-skip>--- Applied Track ---</h6></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/quick-start.html">Quick Start</a></li>
    <li><a class="dropdown-item" href="../articles/applied-guide.html">Applied Guide</a></li>
    <li><a class="dropdown-item" href="../articles/dual-anchor.html">Dual-Anchor Framework</a></li>
    <li><a class="dropdown-item" href="../articles/diagnostics.html">Diagnostics</a></li>
    <li><a class="dropdown-item" href="../articles/case-studies.html">Case Studies</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>--- Methodological Track ---</h6></li>
    <li><a class="dropdown-item" href="../articles/theory-overview.html">Theory Overview</a></li>
    <li><a class="dropdown-item" href="../articles/theory-stirling.html">Stirling Numbers</a></li>
    <li><a class="dropdown-item" href="../articles/theory-approximations.html">Approximations (A1)</a></li>
    <li><a class="dropdown-item" href="../articles/theory-newton.html">Newton Algorithm (A2)</a></li>
    <li><a class="dropdown-item" href="../articles/theory-weights.html">Weight Distributions</a></li>
    <li><a class="dropdown-item" href="../articles/api-reference.html">API Reference</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/joonho112/DPprior/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>The Applied Researcher's Guide to Cluster-Count Elicitation</h1>
                        <h4 data-toc-skip class="author">JoonHo Lee</h4>
            
            <h4 data-toc-skip class="date">2026-01-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/joonho112/DPprior/blob/main/vignettes/applied-guide.Rmd" class="external-link"><code>vignettes/applied-guide.Rmd</code></a></small>
      <div class="d-none name"><code>applied-guide.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette provides a comprehensive, step-by-step guide to
eliciting Gamma hyperpriors for the concentration parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
in Dirichlet Process mixture models. By the end of this guide, you will
understand:</p>
<ol style="list-style-type: decimal">
<li>The two-question protocol for systematic prior elicitation</li>
<li>How to translate domain knowledge into the expected number of
clusters</li>
<li>How to express your uncertainty about that expectation</li>
<li>When to use different calibration methods (A1, A2-MN, A2-KL)</li>
<li>How to handle feasibility constraints</li>
<li>How to conduct sensitivity analysis</li>
</ol>
<p>This guide assumes you have read the <a href="quick-start.html">Quick
Start</a> vignette and are familiar with the basic usage of
<code><a href="../reference/DPprior_fit.html">DPprior_fit()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="the-elicitation-framework">1. The Elicitation Framework<a class="anchor" aria-label="anchor" href="#the-elicitation-framework"></a>
</h2>
<div class="section level3">
<h3 id="the-two-question-protocol">The Two-Question Protocol<a class="anchor" aria-label="anchor" href="#the-two-question-protocol"></a>
</h3>
<p>Eliciting a
Gamma<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(a, b)</annotation></semantics></math>
hyperprior for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
requires specifying <em>two</em> pieces of information: a location
(where you expect the number of clusters to be) and a scale (how certain
you are about that expectation). The DPprior package operationalizes
this through two quantities:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Expected number of clusters</strong>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>K</mi></msub><annotation encoding="application/x-tex">\mu_K</annotation></semantics></math>):
Your best guess for the number of distinct groups</li>
<li>
<strong>Uncertainty about that expectation</strong>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>σ</mi><mi>K</mi><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma^2_K</annotation></semantics></math>
or a confidence level): How sure you are about your guess</li>
</ol>
<p>Why do we need both? The Gamma distribution has two parameters, so a
single piece of information is insufficient to uniquely determine the
prior. Think of it this way: saying “I expect 15 clusters” could
correspond to many different priors—from a tightly concentrated prior
that strongly believes in exactly 15 clusters, to a diffuse prior that
merely centers around 15 but allows for substantial deviation.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare priors with same mean but different variances</span></span>
<span><span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">mu_K</span> <span class="op">&lt;-</span> <span class="fl">15</span></span>
<span></span>
<span><span class="va">fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"High Uncertainty (var_K = 70)"</span>   <span class="op">=</span> <span class="fu"><a href="../reference/DPprior_fit.html">DPprior_fit</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">mu_K</span>, var_K <span class="op">=</span> <span class="fl">70</span><span class="op">)</span>,</span>
<span>  <span class="st">"Medium Uncertainty (var_K = 35)"</span> <span class="op">=</span> <span class="fu"><a href="../reference/DPprior_fit.html">DPprior_fit</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">mu_K</span>, var_K <span class="op">=</span> <span class="fl">35</span><span class="op">)</span>,</span>
<span>  <span class="st">"Low Uncertainty (var_K = 21)"</span>    <span class="op">=</span> <span class="fu"><a href="../reference/DPprior_fit.html">DPprior_fit</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">mu_K</span>, var_K <span class="op">=</span> <span class="fl">21</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Pre-compute log Stirling numbers for PMF calculation</span></span>
<span><span class="va">logS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_log_stirling.html">compute_log_stirling</a></span><span class="op">(</span><span class="va">J</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create data for alpha prior plot</span></span>
<span><span class="va">alpha_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">20</span>, length.out <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span><span class="va">alpha_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fits</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="va">fits</span><span class="op">[[</span><span class="va">nm</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    alpha <span class="op">=</span> <span class="va">alpha_grid</span>,</span>
<span>    density <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">dgamma</a></span><span class="op">(</span><span class="va">alpha_grid</span>, shape <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">a</span>, rate <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">b</span><span class="op">)</span>,</span>
<span>    Uncertainty <span class="op">=</span> <span class="va">nm</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">alpha_df</span><span class="op">$</span><span class="va">Uncertainty</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">alpha_df</span><span class="op">$</span><span class="va">Uncertainty</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fits</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create data for K PMF plot</span></span>
<span><span class="va">k_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fits</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="va">fits</span><span class="op">[[</span><span class="va">nm</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">pmf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pmf_K_marginal.html">pmf_K_marginal</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">fit</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit</span><span class="op">$</span><span class="va">b</span>, logS <span class="op">=</span> <span class="va">logS</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    K <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pmf</span><span class="op">)</span>,</span>
<span>    probability <span class="op">=</span> <span class="va">pmf</span>,</span>
<span>    Uncertainty <span class="op">=</span> <span class="va">nm</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">k_df</span><span class="op">$</span><span class="va">Uncertainty</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">k_df</span><span class="op">$</span><span class="va">Uncertainty</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fits</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot alpha priors</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">alpha_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">alpha</span>, y <span class="op">=</span> <span class="va">density</span>, color <span class="op">=</span> <span class="va">Uncertainty</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">palette_3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>, y <span class="op">=</span> <span class="st">"Density"</span>,</span>
<span>       title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Prior Density for "</span> <span class="op">*</span> <span class="va">alpha</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.direction <span class="op">=</span> <span class="st">"vertical"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot K PMF</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">k_df</span><span class="op">[</span><span class="va">k_df</span><span class="op">$</span><span class="va">K</span> <span class="op">&lt;=</span> <span class="fl">35</span>, <span class="op">]</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">K</span>, y <span class="op">=</span> <span class="va">probability</span>, color <span class="op">=</span> <span class="va">Uncertainty</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">palette_3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Number of Clusters (K)"</span>, y <span class="op">=</span> <span class="st">"Probability"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Implied PMF of K"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.direction <span class="op">=</span> <span class="st">"vertical"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Arrange plots side by side</span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="applied-guide_files/figure-html/two-question-visual-1.png" class="r-plt" alt="The same mean (μ_K = 15) with different levels of uncertainty leads to very different priors on α." width="85%"><p class="caption">
The same mean (μ_K = 15) with different levels of uncertainty leads to
very different priors on α.
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="eliciting-the-mean-how-many-clusters">2. Eliciting the Mean: How Many Clusters?<a class="anchor" aria-label="anchor" href="#eliciting-the-mean-how-many-clusters"></a>
</h2>
<p>The first step is determining
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>K</mi></msub><annotation encoding="application/x-tex">\mu_K</annotation></semantics></math>,
your expected number of clusters. This requires careful thought about
your research context. Here are several strategies for arriving at a
defensible value.</p>
<div class="section level3">
<h3 id="understanding-what-k_j-represents">Understanding What
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>K</mi><mi>J</mi></msub><annotation encoding="application/x-tex">K_J</annotation></semantics></math>
Represents<a class="anchor" aria-label="anchor" href="#understanding-what-k_j-represents"></a>
</h3>
<p>Before eliciting
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>K</mi></msub><annotation encoding="application/x-tex">\mu_K</annotation></semantics></math>,
it is important to understand what
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>K</mi><mi>J</mi></msub><annotation encoding="application/x-tex">K_J</annotation></semantics></math>
represents. In the Dirichlet Process mixture model,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>K</mi><mi>J</mi></msub><annotation encoding="application/x-tex">K_J</annotation></semantics></math>
denotes the number of <em>occupied</em> clusters among
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>J</mi><annotation encoding="application/x-tex">J</annotation></semantics></math>
observations—not the total number of mixture components in the
underlying model (which is infinite). As <a href="https://doi.org/10.3102/10769986241254286" class="external-link">Lee et al. (2025)</a>
emphasize,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>K</mi><mi>J</mi></msub><annotation encoding="application/x-tex">K_J</annotation></semantics></math>
functions more as an <strong>upper bound</strong> on the number of
practically distinguishable subgroups rather than a precise count of
“true” clusters.</p>
<p>This distinction has practical implications for elicitation:</p>
<ul>
<li><p>Since
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>K</mi><mi>J</mi></msub><annotation encoding="application/x-tex">K_J</annotation></semantics></math>
tends to slightly overcount relative to the number of substantively
meaningful groups, it is often reasonable to set
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>K</mi></msub><annotation encoding="application/x-tex">\mu_K</annotation></semantics></math>
somewhat <strong>generously</strong>—that is, slightly higher than your
strict expectation for the number of “true” clusters.</p></li>
<li><p>A prior that allows for a few more clusters than you strictly
expect provides flexibility for the data to reveal unexpected
heterogeneity while still regularizing toward your domain
knowledge.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="strategy-1-the-oracle-question">Strategy 1: The Oracle Question<a class="anchor" aria-label="anchor" href="#strategy-1-the-oracle-question"></a>
</h3>
<p>Imagine a trusted oracle who could reveal the true underlying
pattern:</p>
<blockquote>
<p>“If a reliable oracle showed you the true effect pattern across your
100 sites, approximately how many distinct groups would you see?”</p>
</blockquote>
<p>This question bypasses abstract statistical thinking and focuses on
substantive domain knowledge.</p>
</div>
<div class="section level3">
<h3 id="strategy-2-prior-research">Strategy 2: Prior Research<a class="anchor" aria-label="anchor" href="#strategy-2-prior-research"></a>
</h3>
<p>Draw on previous studies in your field:</p>
<blockquote>
<p>“In similar prior research, how many subtypes or subgroups have been
identified?”</p>
</blockquote>
<p>For example, in educational intervention research, previous
meta-analyses might suggest that treatment effects typically cluster
into 5-15 distinct patterns depending on the intervention type and
population.</p>
</div>
<div class="section level3">
<h3 id="strategy-3-theoretical-mechanisms">Strategy 3: Theoretical Mechanisms<a class="anchor" aria-label="anchor" href="#strategy-3-theoretical-mechanisms"></a>
</h3>
<p>Consider the underlying causal processes:</p>
<blockquote>
<p>“How many distinct mechanisms or pathways do you theoretically expect
to drive heterogeneity in your outcome?”</p>
</blockquote>
<p>If your theory suggests multiple mechanisms (e.g., implementation
fidelity, population characteristics, regional factors, and intervention
dosage), you might set
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>K</mi></msub><annotation encoding="application/x-tex">\mu_K</annotation></semantics></math>
to accommodate their combinations.</p>
</div>
<div class="section level3">
<h3 id="boundary-checks">Boundary Checks<a class="anchor" aria-label="anchor" href="#boundary-checks"></a>
</h3>
<p>Before proceeding, verify your
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>K</mi></msub><annotation encoding="application/x-tex">\mu_K</annotation></semantics></math>
satisfies basic constraints:</p>
<ul>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>μ</mi><mi>K</mi></msub><mo>&gt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\mu_K &gt; 1</annotation></semantics></math>:
A single cluster is trivial and provides no insight into
heterogeneity</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>μ</mi><mi>K</mi></msub><mo>&lt;</mo><mi>J</mi></mrow><annotation encoding="application/x-tex">\mu_K &lt; J</annotation></semantics></math>:
You cannot have more clusters than observations</p></li>
<li><p>Extreme values warrant careful consideration:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>K</mi></msub><annotation encoding="application/x-tex">\mu_K</annotation></semantics></math>
close to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>J</mi><annotation encoding="application/x-tex">J</annotation></semantics></math>
implies you believe nearly every observation is unique</p></li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare priors across different mu_K values</span></span>
<span><span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">mu_K_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">25</span><span class="op">)</span></span>
<span></span>
<span><span class="va">comparison_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  mu_K <span class="op">=</span> <span class="va">mu_K_values</span>,</span>
<span>  a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>,</span>
<span>  b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>,</span>
<span>  E_alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>,</span>
<span>  SD_alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">mu_K_values</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_fit.html">DPprior_fit</a></span><span class="op">(</span><span class="va">J</span>, mu_K <span class="op">=</span> <span class="va">mu_K_values</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, confidence <span class="op">=</span> <span class="st">"low"</span><span class="op">)</span></span>
<span>  <span class="va">comparison_df</span><span class="op">$</span><span class="va">a</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">a</span></span>
<span>  <span class="va">comparison_df</span><span class="op">$</span><span class="va">b</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">b</span></span>
<span>  <span class="va">comparison_df</span><span class="op">$</span><span class="va">E_alpha</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">a</span> <span class="op">/</span> <span class="va">fit</span><span class="op">$</span><span class="va">b</span></span>
<span>  <span class="va">comparison_df</span><span class="op">$</span><span class="va">SD_alpha</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">a</span><span class="op">)</span> <span class="op">/</span> <span class="va">fit</span><span class="op">$</span><span class="va">b</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Warning: HIGH DOMINANCE RISK: P(w1 &gt; 0.5) = 60.6% exceeds 40%.</span></span>
<span><span class="co">#&gt;   This may indicate unintended prior behavior (RN-07).</span></span>
<span><span class="co">#&gt;   Consider using DPprior_dual() for weight-constrained elicitation.</span></span>
<span><span class="co">#&gt;   See ?DPprior_diagnostics for interpretation.</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>  <span class="va">comparison_df</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Target μ_K"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"E[α]"</span>, <span class="st">"SD(α)"</span><span class="op">)</span>,</span>
<span>  digits <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Gamma hyperparameters for different expected cluster counts </span></span>
<span><span class="st">  (J = 100, low confidence)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Gamma hyperparameters for different expected cluster counts (J
= 100, low confidence)</caption>
<thead><tr class="header">
<th align="right">Target μ_K</th>
<th align="right">a</th>
<th align="right">b</th>
<th align="right">E[α]</th>
<th align="right">SD(α)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">5</td>
<td align="right">0.623</td>
<td align="right">0.561</td>
<td align="right">1.110</td>
<td align="right">1.406</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">1.179</td>
<td align="right">0.400</td>
<td align="right">2.943</td>
<td align="right">2.711</td>
</tr>
<tr class="odd">
<td align="right">15</td>
<td align="right">1.584</td>
<td align="right">0.299</td>
<td align="right">5.296</td>
<td align="right">4.207</td>
</tr>
<tr class="even">
<td align="right">25</td>
<td align="right">2.079</td>
<td align="right">0.175</td>
<td align="right">11.862</td>
<td align="right">8.228</td>
</tr>
</tbody>
</table>
<p>As the table shows, expecting more clusters leads to larger values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>α</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">E[\alpha]</annotation></semantics></math>,
reflecting the relationship between the concentration parameter and
cluster formation in the Dirichlet Process.</p>
</div>
</div>
<div class="section level2">
<h2 id="eliciting-the-variance-how-certain-are-you">3. Eliciting the Variance: How Certain Are You?<a class="anchor" aria-label="anchor" href="#eliciting-the-variance-how-certain-are-you"></a>
</h2>
<p>Once you have determined
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>K</mi></msub><annotation encoding="application/x-tex">\mu_K</annotation></semantics></math>,
you must express how certain you are about this value. The DPprior
package offers three approaches, each suited to different contexts.</p>
<div class="section level3">
<h3 id="method-1-confidence-levels-recommended-for-most-users">Method 1: Confidence Levels (Recommended for Most Users)<a class="anchor" aria-label="anchor" href="#method-1-confidence-levels-recommended-for-most-users"></a>
</h3>
<p>The simplest approach uses qualitative confidence levels that the
package translates into appropriate variance specifications:</p>
<table class="table">
<colgroup>
<col width="12%">
<col width="9%">
<col width="29%">
<col width="48%">
</colgroup>
<thead><tr class="header">
<th>Level</th>
<th>VIF</th>
<th>Interpretation</th>
<th>Example var_K (μ_K = 15)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>"low"</code></td>
<td>5.0</td>
<td>“I’m quite uncertain—this is a rough guess”</td>
<td>70</td>
</tr>
<tr class="even">
<td><code>"medium"</code></td>
<td>2.5</td>
<td>“I have a reasonable sense but acknowledge uncertainty”</td>
<td>35</td>
</tr>
<tr class="odd">
<td><code>"high"</code></td>
<td>1.5</td>
<td>“I’m fairly confident based on strong prior evidence”</td>
<td>21</td>
</tr>
</tbody>
</table>
<p>The VIF (Variance Inflation Factor) indicates how much larger the
prior variance is relative to the baseline Poisson variance of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>μ</mi><mi>K</mi></msub><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\mu_K - 1)</annotation></semantics></math>.</p>
<p><strong>Recommendation</strong>: For most applied researchers seeking
weakly informative priors, we recommend starting with
<code>confidence = "low"</code>. This provides regularization toward
your expected cluster count while remaining flexible enough to let the
data speak.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Using confidence levels</span></span>
<span><span class="va">fit_low</span>    <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_fit.html">DPprior_fit</a></span><span class="op">(</span>J <span class="op">=</span> <span class="fl">100</span>, mu_K <span class="op">=</span> <span class="fl">15</span>, confidence <span class="op">=</span> <span class="st">"low"</span><span class="op">)</span></span>
<span><span class="va">fit_medium</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_fit.html">DPprior_fit</a></span><span class="op">(</span>J <span class="op">=</span> <span class="fl">100</span>, mu_K <span class="op">=</span> <span class="fl">15</span>, confidence <span class="op">=</span> <span class="st">"medium"</span><span class="op">)</span></span>
<span><span class="va">fit_high</span>   <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_fit.html">DPprior_fit</a></span><span class="op">(</span>J <span class="op">=</span> <span class="fl">100</span>, mu_K <span class="op">=</span> <span class="fl">15</span>, confidence <span class="op">=</span> <span class="st">"high"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># What VIF values correspond to these levels?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Low confidence VIF:   "</span>, <span class="fu"><a href="../reference/confidence_to_vif.html">confidence_to_vif</a></span><span class="op">(</span><span class="st">"low"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Low confidence VIF:    5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Medium confidence VIF:"</span>, <span class="fu"><a href="../reference/confidence_to_vif.html">confidence_to_vif</a></span><span class="op">(</span><span class="st">"medium"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Medium confidence VIF: 2.5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"High confidence VIF:  "</span>, <span class="fu"><a href="../reference/confidence_to_vif.html">confidence_to_vif</a></span><span class="op">(</span><span class="st">"high"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; High confidence VIF:   1.5</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Comparison table</span></span>
<span><span class="va">confidence_comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Confidence <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span><span class="op">)</span>,</span>
<span>  VIF <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.0</span>, <span class="fl">2.5</span>, <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>  var_K <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit_low</span><span class="op">$</span><span class="va">target</span><span class="op">$</span><span class="va">var_K</span>, <span class="va">fit_medium</span><span class="op">$</span><span class="va">target</span><span class="op">$</span><span class="va">var_K</span>, </span>
<span>                  <span class="va">fit_high</span><span class="op">$</span><span class="va">target</span><span class="op">$</span><span class="va">var_K</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit_low</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_medium</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_high</span><span class="op">$</span><span class="va">a</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit_low</span><span class="op">$</span><span class="va">b</span>, <span class="va">fit_medium</span><span class="op">$</span><span class="va">b</span>, <span class="va">fit_high</span><span class="op">$</span><span class="va">b</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  CV_alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit_low</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_medium</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_high</span><span class="op">$</span><span class="va">a</span><span class="op">)</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>  <span class="va">confidence_comparison</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Confidence"</span>, <span class="st">"VIF"</span>, <span class="st">"var_K"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"CV(α)"</span><span class="op">)</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"How confidence levels affect the elicited prior (J = 100, μ_K = 15)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>How confidence levels affect the elicited prior (J = 100, μ_K =
15)</caption>
<thead><tr class="header">
<th align="left">Confidence</th>
<th align="right">VIF</th>
<th align="right">var_K</th>
<th align="right">a</th>
<th align="right">b</th>
<th align="right">CV(α)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Low</td>
<td align="right">5.0</td>
<td align="right">70</td>
<td align="right">1.584</td>
<td align="right">0.299</td>
<td align="right">0.794</td>
</tr>
<tr class="even">
<td align="left">Medium</td>
<td align="right">2.5</td>
<td align="right">35</td>
<td align="right">3.916</td>
<td align="right">0.797</td>
<td align="right">0.505</td>
</tr>
<tr class="odd">
<td align="left">High</td>
<td align="right">1.5</td>
<td align="right">21</td>
<td align="right">8.993</td>
<td align="right">1.885</td>
<td align="right">0.333</td>
</tr>
</tbody>
</table>
<p>Higher confidence leads to a smaller coefficient of variation (CV)
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>,
meaning the prior is more concentrated around its mean.</p>
</div>
<div class="section level3">
<h3 id="method-2-direct-variance-specification">Method 2: Direct Variance Specification<a class="anchor" aria-label="anchor" href="#method-2-direct-variance-specification"></a>
</h3>
<p>For users who want precise control, you can specify
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Var</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>K</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{Var}(K)</annotation></semantics></math>
directly:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Specify variance directly</span></span>
<span><span class="va">fit_direct</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_fit.html">DPprior_fit</a></span><span class="op">(</span>J <span class="op">=</span> <span class="fl">100</span>, mu_K <span class="op">=</span> <span class="fl">15</span>, var_K <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Direct specification: var_K = 50\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Direct specification: var_K = 50</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Gamma(a ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_direct</span><span class="op">$</span><span class="va">a</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">", b ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_direct</span><span class="op">$</span><span class="va">b</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">")\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Gamma(a = 2.418 , b = 0.476 )</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Achieved E[K] ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_direct</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">mu_K</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Achieved E[K] = 15</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Achieved Var(K) ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_direct</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">var_K</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Achieved Var(K) = 50</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="method-3-quantile-based-elicitation">Method 3: Quantile-Based Elicitation<a class="anchor" aria-label="anchor" href="#method-3-quantile-based-elicitation"></a>
</h3>
<p>A more intuitive approach for some researchers is to specify a
credible interval for the number of clusters. For example:</p>
<blockquote>
<p>“I believe there’s a 90% chance that the number of clusters falls
between 8 and 25.”</p>
</blockquote>
<p>Assuming a roughly symmetric distribution, this translates to a
variance:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Quantile-based elicitation</span></span>
<span><span class="co"># 90% interval: [8, 25] with implied mean ~16.5</span></span>
<span><span class="co"># Width = 17 = 2 × 1.645 × σ  →  σ ≈ 5.17  →  σ² ≈ 26.7</span></span>
<span></span>
<span><span class="va">lower</span> <span class="op">&lt;-</span> <span class="fl">8</span></span>
<span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span><span class="va">mu_K_quantile</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">lower</span> <span class="op">+</span> <span class="va">upper</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span><span class="va">sigma_K</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">upper</span> <span class="op">-</span> <span class="va">lower</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="fl">1.645</span><span class="op">)</span>  <span class="co"># 90% interval</span></span>
<span><span class="va">var_K_quantile</span> <span class="op">&lt;-</span> <span class="va">sigma_K</span><span class="op">^</span><span class="fl">2</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"From 90% interval ["</span>, <span class="va">lower</span>, <span class="st">", "</span>, <span class="va">upper</span>, <span class="st">"]:\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co">#&gt; From 90% interval [8, 25]:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Implied μ_K ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">mu_K_quantile</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Implied μ_K = 16.5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Implied σ_K ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">sigma_K</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Implied σ_K = 5.17</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Implied var_K ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">var_K_quantile</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Implied var_K = 26.7</span></span>
<span></span>
<span><span class="va">fit_quantile</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_fit.html">DPprior_fit</a></span><span class="op">(</span>J <span class="op">=</span> <span class="fl">100</span>, mu_K <span class="op">=</span> <span class="va">mu_K_quantile</span>, var_K <span class="op">=</span> <span class="va">var_K_quantile</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nElicited prior: Gamma("</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_quantile</span><span class="op">$</span><span class="va">a</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">", "</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_quantile</span><span class="op">$</span><span class="va">b</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">")\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Elicited prior: Gamma(7.335, 1.322)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="method-4-vif-based-specification">Method 4: VIF-Based Specification<a class="anchor" aria-label="anchor" href="#method-4-vif-based-specification"></a>
</h3>
<p>If you think naturally in terms of relative variance, you can use the
VIF directly:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># VIF-based specification</span></span>
<span><span class="co"># "My uncertainty is about 5 times the Poisson baseline" (low confidence)</span></span>
<span><span class="va">vif</span> <span class="op">&lt;-</span> <span class="fl">5.0</span></span>
<span><span class="va">var_K_vif</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vif_to_variance.html">vif_to_variance</a></span><span class="op">(</span>mu_K <span class="op">=</span> <span class="fl">15</span>, vif <span class="op">=</span> <span class="va">vif</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"VIF ="</span>, <span class="va">vif</span>, <span class="st">"→ var_K ="</span>, <span class="va">var_K_vif</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; VIF = 5 → var_K = 70</span></span>
<span></span>
<span><span class="va">fit_vif</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_fit.html">DPprior_fit</a></span><span class="op">(</span>J <span class="op">=</span> <span class="fl">100</span>, mu_K <span class="op">=</span> <span class="fl">15</span>, var_K <span class="op">=</span> <span class="va">var_K_vif</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit_vif</span><span class="op">)</span></span>
<span><span class="co">#&gt; DPprior Prior Elicitation Result</span></span>
<span><span class="co">#&gt; ============================================= </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Gamma Hyperprior: α ~ Gamma(a = 1.5843, b = 0.2992)</span></span>
<span><span class="co">#&gt;   E[α] = 5.296, SD[α] = 4.207</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Target (J = 100):</span></span>
<span><span class="co">#&gt;   E[K_J]   = 15.00</span></span>
<span><span class="co">#&gt;   Var(K_J) = 70.00</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Achieved:</span></span>
<span><span class="co">#&gt;   E[K_J] = 15.000000, Var(K_J) = 70.000000</span></span>
<span><span class="co">#&gt;   Residual = 5.86e-10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Method: A2-MN (6 iterations)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Dominance Risk: LOW ✓ (P(w₁&gt;0.5) = 15%)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="the-three-calibration-methods">4. The Three Calibration Methods<a class="anchor" aria-label="anchor" href="#the-three-calibration-methods"></a>
</h2>
<p>The DPprior package offers three methods for calibrating the Gamma
hyperparameters. Understanding when to use each method will help you
make informed choices.</p>
<div class="section level3">
<h3 id="method-a1-closed-form-approximation">Method A1: Closed-Form Approximation<a class="anchor" aria-label="anchor" href="#method-a1-closed-form-approximation"></a>
</h3>
<p>The A1 method provides an instantaneous, closed-form solution based
on a Negative Binomial approximation to the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>
distribution.</p>
<p><strong>Pros:</strong></p>
<ul>
<li><p>Extremely fast (no iteration required)</p></li>
<li><p>Provides good accuracy for most practical cases</p></li>
<li><p>Useful for rapid exploration and initial calibration</p></li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li><p>Slight approximation error, especially for small
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>J</mi><annotation encoding="application/x-tex">J</annotation></semantics></math>
or extreme
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>K</mi></msub><annotation encoding="application/x-tex">\mu_K</annotation></semantics></math></p></li>
<li><p>May project infeasible variance specifications to the
boundary</p></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_a1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_fit.html">DPprior_fit</a></span><span class="op">(</span>J <span class="op">=</span> <span class="fl">100</span>, mu_K <span class="op">=</span> <span class="fl">15</span>, var_K <span class="op">=</span> <span class="fl">70</span>, method <span class="op">=</span> <span class="st">"A1"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Method A1 (Closed-Form Approximation)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Method A1 (Closed-Form Approximation)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Gamma(a ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_a1</span><span class="op">$</span><span class="va">a</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">", b ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_a1</span><span class="op">$</span><span class="va">b</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">")\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Gamma(a = 3.5 , b = 1.1513 )</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Target:   E[K] ="</span>, <span class="va">fit_a1</span><span class="op">$</span><span class="va">target</span><span class="op">$</span><span class="va">mu_K</span>, <span class="st">", Var(K) ="</span>, <span class="va">fit_a1</span><span class="op">$</span><span class="va">target</span><span class="op">$</span><span class="va">var_K</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Target:   E[K] = 15 , Var(K) = 70</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Achieved: E[K] ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_a1</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">mu_K</span>, <span class="fl">4</span><span class="op">)</span>, </span>
<span>    <span class="st">", Var(K) ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_a1</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">var_K</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Achieved: E[K] = 10.8439 , Var(K) = 23.0324</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Residual:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">fit_a1</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">residual</span>, scientific <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Residual: 4.715115e+01</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="method-a2-mn-exact-moment-matching-recommended">Method A2-MN: Exact Moment Matching (Recommended)<a class="anchor" aria-label="anchor" href="#method-a2-mn-exact-moment-matching-recommended"></a>
</h3>
<p>The A2-MN method uses Newton iteration to find Gamma parameters that
<em>exactly</em> match the target moments. This is the default and
recommended method for most applications.</p>
<p><strong>Pros:</strong></p>
<ul>
<li><p>Machine-precision accuracy</p></li>
<li><p>Guaranteed exact moment matching</p></li>
<li><p>Fast convergence (typically 5-10 iterations)</p></li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li><p>Slightly slower than A1 (though still very fast)</p></li>
<li><p>Requires numerical iteration</p></li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_a2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_fit.html">DPprior_fit</a></span><span class="op">(</span>J <span class="op">=</span> <span class="fl">100</span>, mu_K <span class="op">=</span> <span class="fl">15</span>, var_K <span class="op">=</span> <span class="fl">70</span>, method <span class="op">=</span> <span class="st">"A2-MN"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Method A2-MN (Exact Moment Matching)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Method A2-MN (Exact Moment Matching)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Gamma(a ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_a2</span><span class="op">$</span><span class="va">a</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">", b ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_a2</span><span class="op">$</span><span class="va">b</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">")\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Gamma(a = 1.5843 , b = 0.2992 )</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Target:   E[K] ="</span>, <span class="va">fit_a2</span><span class="op">$</span><span class="va">target</span><span class="op">$</span><span class="va">mu_K</span>, <span class="st">", Var(K) ="</span>, <span class="va">fit_a2</span><span class="op">$</span><span class="va">target</span><span class="op">$</span><span class="va">var_K</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Target:   E[K] = 15 , Var(K) = 70</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Achieved: E[K] ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_a2</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">mu_K</span>, <span class="fl">6</span><span class="op">)</span>, </span>
<span>    <span class="st">", Var(K) ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_a2</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">var_K</span>, <span class="fl">6</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Achieved: E[K] = 15 , Var(K) = 70</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Residual:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">fit_a2</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">residual</span>, scientific <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Residual: 5.855439e-10</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Iterations:"</span>, <span class="va">fit_a2</span><span class="op">$</span><span class="va">iterations</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Iterations: 6</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="method-a2-kl-kl-divergence-minimization">Method A2-KL: KL Divergence Minimization<a class="anchor" aria-label="anchor" href="#method-a2-kl-kl-divergence-minimization"></a>
</h3>
<p>The A2-KL method minimizes the Kullback-Leibler divergence between a
target PMF and the induced distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>.
This is useful when you have a specific target distribution in mind, not
just moments.</p>
<p><strong>Pros:</strong></p>
<ul>
<li><p>Matches the entire distribution shape, not just moments</p></li>
<li><p>Useful for custom target distributions</p></li>
<li><p>Faithful to the DORO (Discrepancy Optimization) philosophy
(Dorazio, 2009)</p></li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li><p>Requires specifying a target PMF</p></li>
<li><p>Computationally more intensive than moment matching</p></li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_kl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_fit.html">DPprior_fit</a></span><span class="op">(</span>J <span class="op">=</span> <span class="fl">100</span>, mu_K <span class="op">=</span> <span class="fl">15</span>, var_K <span class="op">=</span> <span class="fl">70</span>, method <span class="op">=</span> <span class="st">"A2-KL"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Method A2-KL (KL Divergence Minimization)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Method A2-KL (KL Divergence Minimization)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Gamma(a ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_kl</span><span class="op">$</span><span class="va">a</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">", b ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_kl</span><span class="op">$</span><span class="va">b</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">")\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Gamma(a = 1.767 , b = 0.3346 )</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Target:   E[K] ="</span>, <span class="va">fit_kl</span><span class="op">$</span><span class="va">target</span><span class="op">$</span><span class="va">mu_K</span>, <span class="st">", Var(K) ="</span>, <span class="va">fit_kl</span><span class="op">$</span><span class="va">target</span><span class="op">$</span><span class="va">var_K</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Target:   E[K] = 15 , Var(K) = 70</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Achieved: E[K] ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_kl</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">mu_K</span>, <span class="fl">4</span><span class="op">)</span>, </span>
<span>    <span class="st">", Var(K) ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_kl</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">var_K</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Achieved: E[K] = 15.0957 , Var(K) = 64.7345</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Residual:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">fit_kl</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">residual</span>, scientific <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Residual: 1.896688e-02</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="comparing-methods">5. Comparing Methods<a class="anchor" aria-label="anchor" href="#comparing-methods"></a>
</h2>
<p>Let’s systematically compare the three methods across different
scenarios:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_methods</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">J</span>, <span class="va">mu_K</span>, <span class="va">var_K</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">a1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_fit.html">DPprior_fit</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">mu_K</span>, <span class="va">var_K</span>, method <span class="op">=</span> <span class="st">"A1"</span><span class="op">)</span></span>
<span>  <span class="va">a2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_fit.html">DPprior_fit</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">mu_K</span>, <span class="va">var_K</span>, method <span class="op">=</span> <span class="st">"A2-MN"</span><span class="op">)</span></span>
<span>  <span class="va">kl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_fit.html">DPprior_fit</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">mu_K</span>, <span class="va">var_K</span>, method <span class="op">=</span> <span class="st">"A2-KL"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    Method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A1"</span>, <span class="st">"A2-MN"</span>, <span class="st">"A2-KL"</span><span class="op">)</span>,</span>
<span>    a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">a1</span><span class="op">$</span><span class="va">a</span>, <span class="va">a2</span><span class="op">$</span><span class="va">a</span>, <span class="va">kl</span><span class="op">$</span><span class="va">a</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>    b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">a1</span><span class="op">$</span><span class="va">b</span>, <span class="va">a2</span><span class="op">$</span><span class="va">b</span>, <span class="va">kl</span><span class="op">$</span><span class="va">b</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>    `E[K]` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">a1</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">mu_K</span>, <span class="va">a2</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">mu_K</span>, <span class="va">kl</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">mu_K</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>    `Var(K)` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">a1</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">var_K</span>, <span class="va">a2</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">var_K</span>, <span class="va">kl</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">var_K</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>    Residual <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">a1</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">residual</span>, <span class="va">a2</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">residual</span>, <span class="va">kl</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">residual</span><span class="op">)</span>, </span>
<span>                      scientific <span class="op">=</span> <span class="cn">TRUE</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    check.names <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Standard case</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Scenario 1: J = 100, μ_K = 15, var_K = 70\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Scenario 1: J = 100, μ_K = 15, var_K = 70</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu">compare_methods</span><span class="op">(</span><span class="fl">100</span>, <span class="fl">15</span>, <span class="fl">70</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Method</th>
<th align="right">a</th>
<th align="right">b</th>
<th align="right">E[K]</th>
<th align="right">Var(K)</th>
<th align="left">Residual</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">A1</td>
<td align="right">3.5000</td>
<td align="right">1.1513</td>
<td align="right">10.8439</td>
<td align="right">23.0324</td>
<td align="left">4.7e+01</td>
</tr>
<tr class="even">
<td align="left">A2-MN</td>
<td align="right">1.5843</td>
<td align="right">0.2992</td>
<td align="right">15.0000</td>
<td align="right">70.0000</td>
<td align="left">5.9e-10</td>
</tr>
<tr class="odd">
<td align="left">A2-KL</td>
<td align="right">1.7670</td>
<td align="right">0.3346</td>
<td align="right">15.0957</td>
<td align="right">64.7345</td>
<td align="left">1.9e-02</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Large J</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nScenario 2: J = 200, μ_K = 20, var_K = 95\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Scenario 2: J = 200, μ_K = 20, var_K = 95</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu">compare_methods</span><span class="op">(</span><span class="fl">200</span>, <span class="fl">20</span>, <span class="fl">95</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Method</th>
<th align="right">a</th>
<th align="right">b</th>
<th align="right">E[K]</th>
<th align="right">Var(K)</th>
<th align="left">Residual</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">A1</td>
<td align="right">4.7500</td>
<td align="right">1.3246</td>
<td align="right">14.6529</td>
<td align="right">34.4044</td>
<td align="left">6.1e+01</td>
</tr>
<tr class="even">
<td align="left">A2-MN</td>
<td align="right">2.4541</td>
<td align="right">0.4283</td>
<td align="right">20.0000</td>
<td align="right">95.0000</td>
<td align="left">2.7e-12</td>
</tr>
<tr class="odd">
<td align="left">A2-KL</td>
<td align="right">2.6502</td>
<td align="right">0.4634</td>
<td align="right">20.0459</td>
<td align="right">89.5053</td>
<td align="left">9.2e-03</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Smaller J</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nScenario 3: J = 50, μ_K = 8, var_K = 35\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Scenario 3: J = 50, μ_K = 8, var_K = 35</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu">compare_methods</span><span class="op">(</span><span class="fl">50</span>, <span class="fl">8</span>, <span class="fl">35</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Method</th>
<th align="right">a</th>
<th align="right">b</th>
<th align="right">E[K]</th>
<th align="right">Var(K)</th>
<th align="left">Residual</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">A1</td>
<td align="right">1.7500</td>
<td align="right">0.9780</td>
<td align="right">6.1497</td>
<td align="right">12.4439</td>
<td align="left">2.3e+01</td>
</tr>
<tr class="even">
<td align="left">A2-MN</td>
<td align="right">0.7631</td>
<td align="right">0.2433</td>
<td align="right">8.0000</td>
<td align="right">35.0000</td>
<td align="left">7.1e-10</td>
</tr>
<tr class="odd">
<td align="left">A2-KL</td>
<td align="right">0.9298</td>
<td align="right">0.2956</td>
<td align="right">8.2100</td>
<td align="right">31.4879</td>
<td align="left">3.0e-02</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="practical-recommendations">Practical Recommendations<a class="anchor" aria-label="anchor" href="#practical-recommendations"></a>
</h3>
<p>Based on the comparison:</p>
<ul>
<li><p><strong>For general use</strong>: Use <strong>A2-MN</strong> (the
default). It provides exact moment matching with fast
convergence.</p></li>
<li><p><strong>For rapid exploration</strong>: Use <strong>A1</strong>
when you need instant results and can tolerate small approximation
errors.</p></li>
<li><p><strong>For distribution matching</strong>: Use
<strong>A2-KL</strong> when you have a specific target distribution
shape in mind.</p></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="feasibility-constraints">6. Feasibility Constraints<a class="anchor" aria-label="anchor" href="#feasibility-constraints"></a>
</h2>
<p>Not all combinations of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>μ</mi><mi>K</mi></msub><mo>,</mo><msubsup><mi>σ</mi><mi>K</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\mu_K, \sigma^2_K)</annotation></semantics></math>
are achievable with a Gamma hyperprior. Understanding these constraints
helps you specify feasible targets.</p>
<div class="section level3">
<h3 id="why-some-specifications-are-infeasible">Why Some Specifications Are Infeasible<a class="anchor" aria-label="anchor" href="#why-some-specifications-are-infeasible"></a>
</h3>
<p>The variance of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>
under a Gamma hyperprior is bounded:</p>
<ul>
<li><p><strong>Lower bound</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Var</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>K</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><msub><mi>μ</mi><mi>K</mi></msub><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\text{Var}(K) &gt; \mu_K - 1</annotation></semantics></math>
(approximately). This is because the Negative Binomial proxy requires
overdispersion relative to Poisson.</p></li>
<li><p><strong>Upper bound</strong>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Var</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>K</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&lt;</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>J</mi><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mi>/</mi><mn>4</mn></mrow><annotation encoding="application/x-tex">\text{Var}(K) &lt; (J-1)^2/4</annotation></semantics></math>
(approximately). This is a mathematical constraint on the variance of a
bounded random variable.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="how-the-package-handles-infeasibility">How the Package Handles Infeasibility<a class="anchor" aria-label="anchor" href="#how-the-package-handles-infeasibility"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example: Infeasible variance (too small)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Attempting var_K = 10 (below feasible threshold for μ_K = 15):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Attempting var_K = 10 (below feasible threshold for μ_K = 15):</span></span>
<span><span class="va">fit_infeasible</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_fit.html">DPprior_fit</a></span><span class="op">(</span>J <span class="op">=</span> <span class="fl">100</span>, mu_K <span class="op">=</span> <span class="fl">15</span>, var_K <span class="op">=</span> <span class="fl">10</span>, method <span class="op">=</span> <span class="st">"A1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: A1 method: var_K=10.0000 &lt; mu_K-1=14.0000 (infeasible for NegBin proxy).</span></span>
<span><span class="co">#&gt;   Projecting to feasible boundary: 14.000001</span></span>
<span><span class="co">#&gt; Warning: var_K &lt;= mu_K - 1: projected to feasible boundary</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Original var_K:"</span>, <span class="va">fit_infeasible</span><span class="op">$</span><span class="va">target</span><span class="op">$</span><span class="va">var_K</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Original var_K: 10</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Used var_K:"</span>, <span class="va">fit_infeasible</span><span class="op">$</span><span class="va">target</span><span class="op">$</span><span class="va">var_K_used</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Used var_K: 14</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  (Projected to feasible boundary)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   (Projected to feasible boundary)</span></span></code></pre></div>
<p>The A1 method automatically projects infeasible specifications to the
boundary of the feasible region. The A2-MN method attempts exact
matching without projection, which may result in slower convergence or
failure for truly infeasible targets.</p>
</div>
</div>
<div class="section level2">
<h2 id="a-complete-elicitation-workflow">7. A Complete Elicitation Workflow<a class="anchor" aria-label="anchor" href="#a-complete-elicitation-workflow"></a>
</h2>
<p>Let’s walk through a complete, realistic example of prior
elicitation.</p>
<div class="section level3">
<h3 id="context">Context<a class="anchor" aria-label="anchor" href="#context"></a>
</h3>
<p>You are analyzing a multisite educational intervention study with 100
sites. Previous research on similar interventions has identified 8-20
distinct response patterns. Given the interpretation of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>K</mi><mi>J</mi></msub><annotation encoding="application/x-tex">K_J</annotation></semantics></math>
as an upper bound on the number of distinguishable clusters (<a href="https://doi.org/10.3102/10769986241254286" class="external-link">Lee et al., 2025</a>),
you decide to set your expectation generously at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>μ</mi><mi>K</mi></msub><mo>=</mo><mn>15</mn></mrow><annotation encoding="application/x-tex">\mu_K = 15</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># =============================================================================</span></span>
<span><span class="co"># Step 1: Define the research context</span></span>
<span><span class="co"># =============================================================================</span></span>
<span><span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">100</span>  <span class="co"># 100 sites</span></span>
<span><span class="va">application_context</span> <span class="op">&lt;-</span> <span class="st">"Multisite educational intervention study"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Research Context:"</span>, <span class="va">application_context</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Research Context: Multisite educational intervention study</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Number of sites: J ="</span>, <span class="va">J</span>, <span class="st">"\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Number of sites: J = 100</span></span>
<span></span>
<span><span class="co"># =============================================================================</span></span>
<span><span class="co"># Step 2: Determine μ_K based on domain knowledge</span></span>
<span><span class="co"># =============================================================================</span></span>
<span><span class="co"># Prior research suggests 8-20 response patterns</span></span>
<span><span class="co"># Given K_J is an upper bound, we set μ_K generously at 15</span></span>
<span><span class="va">mu_K</span> <span class="op">&lt;-</span> <span class="fl">15</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Prior Knowledge:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Prior Knowledge:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Previous studies found 8-20 response patterns\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Previous studies found 8-20 response patterns</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  K_J serves as upper bound on distinguishable clusters\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   K_J serves as upper bound on distinguishable clusters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Selected μ_K ="</span>, <span class="va">mu_K</span>, <span class="st">"(generous allowance for heterogeneity)\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Selected μ_K = 15 (generous allowance for heterogeneity)</span></span>
<span></span>
<span><span class="co"># =============================================================================</span></span>
<span><span class="co"># Step 3: Determine uncertainty level</span></span>
<span><span class="co"># =============================================================================</span></span>
<span><span class="co"># For a weakly informative prior, we use low confidence</span></span>
<span><span class="va">confidence</span> <span class="op">&lt;-</span> <span class="st">"low"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Uncertainty Assessment:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Uncertainty Assessment:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Seeking weakly informative prior\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Seeking weakly informative prior</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Selected confidence:"</span>, <span class="va">confidence</span>, <span class="st">"(recommended default)\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Selected confidence: low (recommended default)</span></span>
<span></span>
<span><span class="co"># =============================================================================</span></span>
<span><span class="co"># Step 4: Fit the prior</span></span>
<span><span class="co"># =============================================================================</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_fit.html">DPprior_fit</a></span><span class="op">(</span></span>
<span>  J <span class="op">=</span> <span class="va">J</span>, </span>
<span>  mu_K <span class="op">=</span> <span class="va">mu_K</span>, </span>
<span>  confidence <span class="op">=</span> <span class="va">confidence</span>, </span>
<span>  method <span class="op">=</span> <span class="st">"A2-MN"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Elicited Prior:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Elicited Prior:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; DPprior Prior Elicitation Result</span></span>
<span><span class="co">#&gt; ============================================= </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Gamma Hyperprior: α ~ Gamma(a = 1.5843, b = 0.2992)</span></span>
<span><span class="co">#&gt;   E[α] = 5.296, SD[α] = 4.207</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Target (J = 100):</span></span>
<span><span class="co">#&gt;   E[K_J]   = 15.00</span></span>
<span><span class="co">#&gt;   Var(K_J) = 70.00</span></span>
<span><span class="co">#&gt;   (from confidence = 'low')</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Achieved:</span></span>
<span><span class="co">#&gt;   E[K_J] = 15.000000, Var(K_J) = 70.000000</span></span>
<span><span class="co">#&gt;   Residual = 5.86e-10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Method: A2-MN (6 iterations)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Dominance Risk: LOW ✓ (P(w₁&gt;0.5) = 15%)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualizing-the-result">Visualizing the Result<a class="anchor" aria-label="anchor" href="#visualizing-the-result"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="applied-guide_files/figure-html/complete-workflow-viz-1.png" class="r-plt" alt="Complete visualization of the elicited prior for the educational intervention study." width="85%"><p class="caption">
Complete visualization of the elicited prior for the educational
intervention study.
</p>
</div>
<pre><code><span><span class="co">#&gt; TableGrob (2 x 2) "dpprior_dashboard": 4 grobs</span></span>
<span><span class="co">#&gt;   z     cells              name           grob</span></span>
<span><span class="co">#&gt; 1 1 (1-1,1-1) dpprior_dashboard gtable[layout]</span></span>
<span><span class="co">#&gt; 2 2 (2-2,1-1) dpprior_dashboard gtable[layout]</span></span>
<span><span class="co">#&gt; 3 3 (1-1,2-2) dpprior_dashboard gtable[layout]</span></span>
<span><span class="co">#&gt; 4 4 (2-2,2-2) dpprior_dashboard gtable[layout]</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="extracting-results-for-use-in-bayesian-software">Extracting Results for Use in Bayesian Software<a class="anchor" aria-label="anchor" href="#extracting-results-for-use-in-bayesian-software"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract Gamma parameters for use in Stan, JAGS, etc.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"For Stan/JAGS:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; For Stan/JAGS:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  alpha ~ gamma("</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">a</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">", "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">b</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">");\n\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co">#&gt;   alpha ~ gamma(1.5843, 0.2992);</span></span>
<span></span>
<span><span class="co"># Sample from the prior</span></span>
<span><span class="va">n_samples</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="va">alpha_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="va">n_samples</span>, shape <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">a</span>, rate <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">b</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Prior Summary (from"</span>, <span class="va">n_samples</span>, <span class="st">"samples):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Prior Summary (from 10000 samples):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  E[α] ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">alpha_samples</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   E[α] = 5.34</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  SD(α) ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">alpha_samples</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   SD(α) = 4.294</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  95% CI: ["</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">alpha_samples</span>, <span class="fl">0.025</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">", "</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">alpha_samples</span>, <span class="fl">0.975</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"]\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co">#&gt;   95% CI: [0.42, 16.565]</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="sensitivity-analysis">8. Sensitivity Analysis<a class="anchor" aria-label="anchor" href="#sensitivity-analysis"></a>
</h2>
<p>A crucial part of responsible Bayesian analysis is understanding how
your conclusions depend on your prior specifications. The DPprior
package facilitates sensitivity analysis.</p>
<div class="section level3">
<h3 id="sensitivity-to-μ_k">Sensitivity to μ_K<a class="anchor" aria-label="anchor" href="#sensitivity-to-%CE%BC_k"></a>
</h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># How sensitive are the results to our choice of μ_K?</span></span>
<span><span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">mu_K_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">12</span>, <span class="fl">15</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">sensitivity_mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">mu_K_grid</span>, <span class="kw">function</span><span class="op">(</span><span class="va">mu</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/DPprior_fit.html">DPprior_fit</a></span><span class="op">(</span>J <span class="op">=</span> <span class="va">J</span>, mu_K <span class="op">=</span> <span class="va">mu</span>, confidence <span class="op">=</span> <span class="st">"low"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: HIGH DOMINANCE RISK: P(w1 &gt; 0.5) = 40.4% exceeds 40%.</span></span>
<span><span class="co">#&gt;   This may indicate unintended prior behavior (RN-07).</span></span>
<span><span class="co">#&gt;   Consider using DPprior_dual() for weight-constrained elicitation.</span></span>
<span><span class="co">#&gt;   See ?DPprior_diagnostics for interpretation.</span></span>
<span></span>
<span><span class="co"># Create comparison table</span></span>
<span><span class="va">sensitivity_mu_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  `μ_K` <span class="op">=</span> <span class="va">mu_K_grid</span>,</span>
<span>  a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">sensitivity_mu</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">a</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">sensitivity_mu</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">b</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  `E[α]` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">sensitivity_mu</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">a</span> <span class="op">/</span> <span class="va">x</span><span class="op">$</span><span class="va">b</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  `P(w₁ &gt; 0.5)` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">sensitivity_mu</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/prob_w1_exceeds.html">prob_w1_exceeds</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">x</span><span class="op">$</span><span class="va">a</span>, <span class="va">x</span><span class="op">$</span><span class="va">b</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span>,</span>
<span>  check.names <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>  <span class="va">sensitivity_mu_df</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Sensitivity to μ_K (J = 100, low confidence)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Sensitivity to μ_K (J = 100, low confidence)</caption>
<thead><tr class="header">
<th align="right">μ_K</th>
<th align="right">a</th>
<th align="right">b</th>
<th align="right">E[α]</th>
<th align="right">P(w₁ &gt; 0.5)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">8</td>
<td align="right">0.978</td>
<td align="right">0.455</td>
<td align="right">2.150</td>
<td align="right">0.404</td>
</tr>
<tr class="even">
<td align="right">12</td>
<td align="right">1.356</td>
<td align="right">0.355</td>
<td align="right">3.819</td>
<td align="right">0.230</td>
</tr>
<tr class="odd">
<td align="right">15</td>
<td align="right">1.584</td>
<td align="right">0.299</td>
<td align="right">5.296</td>
<td align="right">0.150</td>
</tr>
<tr class="even">
<td align="right">20</td>
<td align="right">1.878</td>
<td align="right">0.228</td>
<td align="right">8.233</td>
<td align="right">0.073</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Visualize with ggplot</span></span>
<span><span class="va">alpha_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">25</span>, length.out <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span><span class="va">sens_mu_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">sensitivity_mu</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="va">sensitivity_mu</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    alpha <span class="op">=</span> <span class="va">alpha_grid</span>,</span>
<span>    density <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">dgamma</a></span><span class="op">(</span><span class="va">alpha_grid</span>, shape <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">a</span>, rate <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">b</span><span class="op">)</span>,</span>
<span>    mu_K <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"μ_K = "</span>, <span class="va">mu_K_grid</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sens_mu_df</span><span class="op">$</span><span class="va">mu_K</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">sens_mu_df</span><span class="op">$</span><span class="va">mu_K</span>, </span>
<span>                          levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"μ_K = "</span>, <span class="va">mu_K_grid</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">sens_mu_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">alpha</span>, y <span class="op">=</span> <span class="va">density</span>, color <span class="op">=</span> <span class="va">mu_K</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">palette_4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>, y <span class="op">=</span> <span class="st">"Density"</span>,</span>
<span>       title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Prior Sensitivity to "</span> <span class="op">*</span> <span class="va">mu</span><span class="op">[</span><span class="va">K</span><span class="op">]</span><span class="op">)</span>,</span>
<span>       color <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="applied-guide_files/figure-html/sensitivity-mu-K-1.png" class="r-plt" alt="Sensitivity of the elicited prior to different expectations about the number of clusters." width="85%"><p class="caption">
Sensitivity of the elicited prior to different expectations about the
number of clusters.
</p>
</div>
</div>
<div class="section level3">
<h3 id="sensitivity-to-confidence-level">Sensitivity to Confidence Level<a class="anchor" aria-label="anchor" href="#sensitivity-to-confidence-level"></a>
</h3>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># How sensitive are the results to our confidence level?</span></span>
<span><span class="va">confidence_levels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"medium"</span>, <span class="st">"high"</span><span class="op">)</span></span>
<span><span class="va">sensitivity_conf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">confidence_levels</span>, <span class="kw">function</span><span class="op">(</span><span class="va">conf</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/DPprior_fit.html">DPprior_fit</a></span><span class="op">(</span>J <span class="op">=</span> <span class="fl">100</span>, mu_K <span class="op">=</span> <span class="fl">15</span>, confidence <span class="op">=</span> <span class="va">conf</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create comparison table</span></span>
<span><span class="va">sensitivity_conf_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Confidence <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span><span class="op">)</span>,</span>
<span>  var_K <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">sensitivity_conf</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">target</span><span class="op">$</span><span class="va">var_K</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">sensitivity_conf</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">a</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">sensitivity_conf</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">b</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  `CV(α)` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">sensitivity_conf</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">a</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  `Median w₁` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">sensitivity_conf</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/quantile_w1.html">quantile_w1</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">x</span><span class="op">$</span><span class="va">a</span>, <span class="va">x</span><span class="op">$</span><span class="va">b</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span>,</span>
<span>  check.names <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>  <span class="va">sensitivity_conf_df</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Sensitivity to confidence level (J = 100, μ_K = 15)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Sensitivity to confidence level (J = 100, μ_K = 15)</caption>
<thead><tr class="header">
<th align="left">Confidence</th>
<th align="right">var_K</th>
<th align="right">a</th>
<th align="right">b</th>
<th align="right">CV(α)</th>
<th align="right">Median w₁</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Low</td>
<td align="right">70</td>
<td align="right">1.584</td>
<td align="right">0.299</td>
<td align="right">0.794</td>
<td align="right">0.151</td>
</tr>
<tr class="even">
<td align="left">Medium</td>
<td align="right">35</td>
<td align="right">3.916</td>
<td align="right">0.797</td>
<td align="right">0.505</td>
<td align="right">0.143</td>
</tr>
<tr class="odd">
<td align="left">High</td>
<td align="right">21</td>
<td align="right">8.993</td>
<td align="right">1.885</td>
<td align="right">0.333</td>
<td align="right">0.140</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Visualize with ggplot</span></span>
<span><span class="va">sens_conf_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">sensitivity_conf</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="va">sensitivity_conf</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    alpha <span class="op">=</span> <span class="va">alpha_grid</span>,</span>
<span>    density <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">dgamma</a></span><span class="op">(</span><span class="va">alpha_grid</span>, shape <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">a</span>, rate <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">b</span><span class="op">)</span>,</span>
<span>    Confidence <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sens_conf_df</span><span class="op">$</span><span class="va">Confidence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">sens_conf_df</span><span class="op">$</span><span class="va">Confidence</span>, </span>
<span>                                  levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">sens_conf_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">alpha</span>, y <span class="op">=</span> <span class="va">density</span>, color <span class="op">=</span> <span class="va">Confidence</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">palette_3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>, y <span class="op">=</span> <span class="st">"Density"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Prior Sensitivity to Confidence Level"</span>,</span>
<span>       color <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="applied-guide_files/figure-html/sensitivity-confidence-1.png" class="r-plt" alt="Sensitivity of the elicited prior to different confidence levels." width="85%"><p class="caption">
Sensitivity of the elicited prior to different confidence levels.
</p>
</div>
</div>
<div class="section level3">
<h3 id="comprehensive-sensitivity-analysis">Comprehensive Sensitivity Analysis<a class="anchor" aria-label="anchor" href="#comprehensive-sensitivity-analysis"></a>
</h3>
<p>For a thorough sensitivity analysis, you might want to explore a grid
of specifications:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Grid-based sensitivity analysis</span></span>
<span><span class="va">mu_K_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">conf_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"low"</span>, <span class="st">"medium"</span>, <span class="st">"high"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">grid_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>mu_K <span class="op">=</span> <span class="va">mu_K_vals</span>, confidence <span class="op">=</span> <span class="va">conf_vals</span>,</span>
<span>                            stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">grid_results</span><span class="op">$</span><span class="va">a</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">grid_results</span><span class="op">$</span><span class="va">b</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">grid_results</span><span class="op">$</span><span class="va">E_alpha</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">grid_results</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_fit.html">DPprior_fit</a></span><span class="op">(</span>J <span class="op">=</span> <span class="fl">100</span>, </span>
<span>                     mu_K <span class="op">=</span> <span class="va">grid_results</span><span class="op">$</span><span class="va">mu_K</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, </span>
<span>                     confidence <span class="op">=</span> <span class="va">grid_results</span><span class="op">$</span><span class="va">confidence</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">grid_results</span><span class="op">$</span><span class="va">a</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">a</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="va">grid_results</span><span class="op">$</span><span class="va">b</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">b</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="va">grid_results</span><span class="op">$</span><span class="va">E_alpha</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">a</span> <span class="op">/</span> <span class="va">fit</span><span class="op">$</span><span class="va">b</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>  <span class="va">grid_results</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"μ_K"</span>, <span class="st">"Confidence"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"E[α]"</span><span class="op">)</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Comprehensive sensitivity analysis (J = 100)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Comprehensive sensitivity analysis (J = 100)</caption>
<thead><tr class="header">
<th align="right">μ_K</th>
<th align="left">Confidence</th>
<th align="right">a</th>
<th align="right">b</th>
<th align="right">E[α]</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">10</td>
<td align="left">low</td>
<td align="right">1.179</td>
<td align="right">0.400</td>
<td align="right">2.943</td>
</tr>
<tr class="even">
<td align="right">15</td>
<td align="left">low</td>
<td align="right">1.584</td>
<td align="right">0.299</td>
<td align="right">5.296</td>
</tr>
<tr class="odd">
<td align="right">20</td>
<td align="left">low</td>
<td align="right">1.878</td>
<td align="right">0.228</td>
<td align="right">8.233</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="left">medium</td>
<td align="right">2.992</td>
<td align="right">1.100</td>
<td align="right">2.720</td>
</tr>
<tr class="odd">
<td align="right">15</td>
<td align="left">medium</td>
<td align="right">3.916</td>
<td align="right">0.797</td>
<td align="right">4.916</td>
</tr>
<tr class="even">
<td align="right">20</td>
<td align="left">medium</td>
<td align="right">4.556</td>
<td align="right">0.596</td>
<td align="right">7.643</td>
</tr>
<tr class="odd">
<td align="right">10</td>
<td align="left">high</td>
<td align="right">7.185</td>
<td align="right">2.728</td>
<td align="right">2.634</td>
</tr>
<tr class="even">
<td align="right">15</td>
<td align="left">high</td>
<td align="right">8.993</td>
<td align="right">1.885</td>
<td align="right">4.772</td>
</tr>
<tr class="odd">
<td align="right">20</td>
<td align="left">high</td>
<td align="right">10.129</td>
<td align="right">1.365</td>
<td align="right">7.422</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="reporting-sensitivity-results">Reporting Sensitivity Results<a class="anchor" aria-label="anchor" href="#reporting-sensitivity-results"></a>
</h3>
<p>When reporting your analysis, we recommend:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Report your primary specification</strong> with clear
justification</p></li>
<li><p><strong>Show sensitivity results</strong> for at least ±3-5 units
of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>K</mi></msub><annotation encoding="application/x-tex">\mu_K</annotation></semantics></math></p></li>
<li><p><strong>Compare confidence levels</strong> to show how
uncertainty affects inference</p></li>
<li><p><strong>Discuss implications</strong> of any substantial
differences in posterior conclusions</p></li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="whats-next">What’s Next?<a class="anchor" aria-label="anchor" href="#whats-next"></a>
</h2>
<p>This guide covered the fundamentals of cluster-count elicitation. For
more advanced topics:</p>
<ul>
<li><p><strong><a href="dual-anchor.html">Dual-Anchor
Framework</a></strong>: Learn to control both cluster count AND weight
concentration simultaneously</p></li>
<li><p><strong><a href="diagnostics.html">Diagnostics</a></strong>:
Verify your prior meets specifications and check for unintended
consequences</p></li>
<li><p><strong><a href="case-studies.html">Case Studies</a></strong>:
See worked examples from education, medicine, and policy
research</p></li>
<li><p><strong><a href="theory-overview.html">Mathematical
Foundations</a></strong>: Understand the mathematical theory underlying
the DPprior package</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<table class="table">
<colgroup>
<col width="21%">
<col width="28%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th>Step</th>
<th>Action</th>
<th>Key Function</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Define context</td>
<td><code>J &lt;- ...</code></td>
</tr>
<tr class="even">
<td>2</td>
<td>Elicit expected clusters</td>
<td>
<code>mu_K &lt;- ...</code> (consider generous setting)</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Express uncertainty</td>
<td>
<code>confidence = "low"</code> (recommended default)</td>
</tr>
<tr class="even">
<td>4</td>
<td>Choose method</td>
<td>
<code>method = "A2-MN"</code> (default)</td>
</tr>
<tr class="odd">
<td>5</td>
<td>Fit prior</td>
<td><code>fit &lt;- DPprior_fit(J, mu_K, ...)</code></td>
</tr>
<tr class="even">
<td>6</td>
<td>Visualize</td>
<td><code>plot(fit)</code></td>
</tr>
<tr class="odd">
<td>7</td>
<td>Sensitivity analysis</td>
<td>Repeat with different specifications</td>
</tr>
<tr class="even">
<td>8</td>
<td>Use in model</td>
<td><code>alpha ~ gamma(fit$a, fit$b)</code></td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Dorazio, R. M. (2009). On selecting a prior for the precision
parameter of Dirichlet process mixture models. <em>Journal of
Statistical Planning and Inference, 139</em>(9), 3384-3390. <a href="https://doi.org/10.1016/j.jspi.2009.03.009" class="external-link uri">https://doi.org/10.1016/j.jspi.2009.03.009</a></p>
<p>Lee, J., Che, J., Rabe-Hesketh, S., Feller, A., &amp; Miratrix, L.
(2025). Improving the estimation of site-specific effects and their
distribution in multisite trials. <em>Journal of Educational and
Behavioral Statistics</em>, 50(5), 731–764. <a href="https://doi.org/10.3102/10769986241254286" class="external-link uri">https://doi.org/10.3102/10769986241254286</a></p>
<hr>
<p><em>For questions or feedback, please visit the <a href="https://github.com/joonho112/DPprior" class="external-link">GitHub
repository</a>.</em></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/joonho112" class="external-link">JoonHo Lee</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
