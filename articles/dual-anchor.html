<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Beyond Cluster Counts: Dual-Anchor Elicitation for Weight Control ‚Ä¢ DPprior</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="‚Äùimage/svg+xml‚Äù" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Beyond Cluster Counts: Dual-Anchor Elicitation for Weight Control">
<meta name="description" content="Learn to control both expected cluster count AND weight concentration  using the dual-anchor framework for Dirichlet Process prior elicitation.
">
<meta property="og:description" content="Learn to control both expected cluster count AND weight concentration  using the dual-anchor framework for Dirichlet Process prior elicitation.
">
<meta property="og:image" content="https://joonho112.github.io/DPprior/logo.svg">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DPprior</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><h6 class="dropdown-header" data-toc-skip>--- Applied Track ---</h6></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/quick-start.html">Quick Start</a></li>
    <li><a class="dropdown-item" href="../articles/applied-guide.html">Applied Guide</a></li>
    <li><a class="dropdown-item" href="../articles/dual-anchor.html">Dual-Anchor Framework</a></li>
    <li><a class="dropdown-item" href="../articles/diagnostics.html">Diagnostics</a></li>
    <li><a class="dropdown-item" href="../articles/case-studies.html">Case Studies</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>--- Methodological Track ---</h6></li>
    <li><a class="dropdown-item" href="../articles/theory-overview.html">Theory Overview</a></li>
    <li><a class="dropdown-item" href="../articles/theory-stirling.html">Stirling Numbers</a></li>
    <li><a class="dropdown-item" href="../articles/theory-approximations.html">Approximations (A1)</a></li>
    <li><a class="dropdown-item" href="../articles/theory-newton.html">Newton Algorithm (A2)</a></li>
    <li><a class="dropdown-item" href="../articles/theory-weights.html">Weight Distributions</a></li>
    <li><a class="dropdown-item" href="../articles/api-reference.html">API Reference</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/joonho112/DPprior/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Beyond Cluster Counts: Dual-Anchor Elicitation for Weight Control</h1>
                        <h4 data-toc-skip class="author">JoonHo Lee</h4>
            
            <h4 data-toc-skip class="date">2026-02-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/joonho112/DPprior/blob/main/vignettes/dual-anchor.Rmd" class="external-link"><code>vignettes/dual-anchor.Rmd</code></a></small>
      <div class="d-none name"><code>dual-anchor.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The previous vignettes focused on calibrating a Gamma hyperprior for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ±</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
based on your expectations about the <strong>number of clusters</strong>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>K</mi><mi>J</mi></msub><annotation encoding="application/x-tex">K_J</annotation></semantics></math>.
This approach is intuitive: you specify how many groups you expect, and
the DPprior package finds the corresponding prior on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ±</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>.</p>
<p>However, as <a href="https://doi.org/10.48550/arXiv.2502.00864" class="external-link">Vicentini &amp; Jermyn
(2025)</a> have pointed out, matching
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>K</mi><mi>J</mi></msub><annotation encoding="application/x-tex">K_J</annotation></semantics></math>
alone can lead to <strong>unintended prior behavior</strong> on the
cluster weights. Specifically, a prior that produces the ‚Äúright‚Äù
expected number of clusters may simultaneously imply a high probability
that a single cluster dominates the entire mixture.</p>
<p>This vignette introduces the <strong>dual-anchor framework</strong>,
which allows you to control both:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Anchor 1</strong>: The number of occupied clusters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>K</mi><mi>J</mi></msub><annotation encoding="application/x-tex">K_J</annotation></semantics></math>
(as before)</li>
<li>
<strong>Anchor 2</strong>: A weight-related quantity (e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mn>1</mn></msub><annotation encoding="application/x-tex">w_1</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÅ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>)
that captures how mass is distributed across clusters</li>
</ol>
<p>By the end of this vignette, you will understand:</p>
<ul>
<li>Why K-only calibration can produce surprising weight behavior</li>
<li>Two key weight anchors:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mn>1</mn></msub><annotation encoding="application/x-tex">w_1</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÅ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>
(co-clustering probability)</li>
<li>How to use <code><a href="../reference/DPprior_dual.html">DPprior_dual()</a></code> for dual-anchor
elicitation</li>
<li>When and how to choose between different anchors and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
values</li>
</ul>
</div>
<div class="section level2">
<h2 id="the-hidden-problem-unintended-weight-priors">1. The Hidden Problem: Unintended Weight Priors<a class="anchor" aria-label="anchor" href="#the-hidden-problem-unintended-weight-priors"></a>
</h2>
<div class="section level3">
<h3 id="what-k-only-calibration-misses">1.1 What K-Only Calibration Misses<a class="anchor" aria-label="anchor" href="#what-k-only-calibration-misses"></a>
</h3>
<p>Consider a researcher analyzing a multisite educational trial with 50
sites, expecting that treatment effects will cluster into approximately
5 distinct patterns. Using the K-only calibration approach from the <a href="applied-guide.html">Applied Guide</a>, they obtain:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">mu_K</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="va">fit_K</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_fit.html">DPprior_fit</a></span><span class="op">(</span>J <span class="op">=</span> <span class="va">J</span>, mu_K <span class="op">=</span> <span class="va">mu_K</span>, confidence <span class="op">=</span> <span class="st">"low"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: HIGH DOMINANCE RISK: P(w1 &gt; 0.5) = 56.3% exceeds 40%.</span></span>
<span><span class="co">#&gt;   This may indicate unintended prior behavior (Lee, 2026).</span></span>
<span><span class="co">#&gt;   Consider using DPprior_dual() for weight-constrained elicitation.</span></span>
<span><span class="co">#&gt;   See ?DPprior_diagnostics for interpretation.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit_K</span><span class="op">)</span></span>
<span><span class="co">#&gt; DPprior Prior Elicitation Result</span></span>
<span><span class="co">#&gt; ============================================= </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Gamma Hyperprior: Œ± ~ Gamma(a = 0.5178, b = 0.3410)</span></span>
<span><span class="co">#&gt;   E[Œ±] = 1.519, SD[Œ±] = 2.110</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Target (J = 50):</span></span>
<span><span class="co">#&gt;   E[K_J]   = 5.00</span></span>
<span><span class="co">#&gt;   Var(K_J) = 20.00</span></span>
<span><span class="co">#&gt;   (from confidence = 'low')</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Achieved:</span></span>
<span><span class="co">#&gt;   E[K_J] = 5.000000, Var(K_J) = 20.000000</span></span>
<span><span class="co">#&gt;   Residual = 9.51e-09</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Method: A2-MN (10 iterations)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Dominance Risk: HIGH ‚úò (P(w‚ÇÅ&gt;0.5) = 56%)</span></span></code></pre></div>
<p>The fit looks reasonable: the prior expects about 5 clusters with
appropriate uncertainty. But what does this prior imply about how
<em>mass is distributed</em> across those clusters?</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Examine the implied weight behavior</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Weight diagnostics for K-only prior:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Weight diagnostics for K-only prior:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  E[w‚ÇÅ] ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/mean_w1.html">mean_w1</a></span><span class="op">(</span><span class="va">fit_K</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_K</span><span class="op">$</span><span class="va">b</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   E[w‚ÇÅ] = 0.585</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  P(w‚ÇÅ &gt; 0.3) ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/prob_w1_exceeds.html">prob_w1_exceeds</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="va">fit_K</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_K</span><span class="op">$</span><span class="va">b</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   P(w‚ÇÅ &gt; 0.3) = 0.69</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  P(w‚ÇÅ &gt; 0.5) ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/prob_w1_exceeds.html">prob_w1_exceeds</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">fit_K</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_K</span><span class="op">$</span><span class="va">b</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   P(w‚ÇÅ &gt; 0.5) = 0.563</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  P(w‚ÇÅ &gt; 0.9) ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/prob_w1_exceeds.html">prob_w1_exceeds</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="va">fit_K</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_K</span><span class="op">$</span><span class="va">b</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   P(w‚ÇÅ &gt; 0.9) = 0.346</span></span></code></pre></div>
<p>Here is the key insight: even though we expect only 5 clusters on
average, there is a <strong>substantial probability</strong> (nearly
50%!) that a randomly selected unit belongs to a cluster containing more
than half of all units. This is much more concentrated than many
researchers would intuitively expect from ‚Äú5 clusters.‚Äù</p>
</div>
<div class="section level3">
<h3 id="why-does-this-happen">1.2 Why Does This Happen?<a class="anchor" aria-label="anchor" href="#why-does-this-happen"></a>
</h3>
<p>The relationship between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>K</mi><mi>J</mi></msub><annotation encoding="application/x-tex">K_J</annotation></semantics></math>
and the cluster weights is not as tight as one might expect. The
expected number of clusters follows approximately:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>K</mi><mi>J</mi></msub><mo>‚à£</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>‚âà</mo><mn>1</mn><mo>+</mo><mi>Œ±</mi><mo>log</mo><mi>J</mi></mrow><annotation encoding="application/x-tex">
\mathbb{E}[K_J \mid \alpha] \approx 1 + \alpha \log J
</annotation></semantics></math></p>
<p>while the expected first stick-breaking weight is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>w</mi><mn>1</mn></msub><mo>‚à£</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><mi>Œ±</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">
\mathbb{E}[w_1 \mid \alpha] = \frac{1}{1 + \alpha}
</annotation></semantics></math></p>
<p>For
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo>=</mo><mn>50</mn></mrow><annotation encoding="application/x-tex">J = 50</annotation></semantics></math>
and an expected cluster count around 5, we need
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ±</mi><mo>‚âà</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\alpha \approx 1</annotation></semantics></math>,
which implies
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>w</mi><mn>1</mn></msub><mo>‚à£</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>‚âà</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">\mathbb{E}[w_1 \mid \alpha] \approx 0.5</annotation></semantics></math>.
But because
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ±</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
is <em>random</em> under our Gamma hyperprior, the tails of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ±</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
distribution can induce extreme weight behavior: small
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ±</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
values lead to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mn>1</mn></msub><annotation encoding="application/x-tex">w_1</annotation></semantics></math>
close to 1, while large
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ±</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
values fragment the weights.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Illustrate the conditional relationship</span></span>
<span><span class="va">alpha_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">w_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.99</span>, length.out <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cond_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">alpha_grid</span>, <span class="kw">function</span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    w <span class="op">=</span> <span class="va">w_grid</span>,</span>
<span>    density <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">dbeta</a></span><span class="op">(</span><span class="va">w_grid</span>, <span class="fl">1</span>, <span class="va">a</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Œ± = "</span>, <span class="va">a</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cond_df</span><span class="op">$</span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">cond_df</span><span class="op">$</span><span class="va">alpha</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Œ± = "</span>, <span class="va">alpha_grid</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">cond_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">w</span>, y <span class="op">=</span> <span class="va">density</span>, color <span class="op">=</span> <span class="va">alpha</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_viridis_d</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"plasma"</span>, end <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">w</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Conditional Density"</span>,</span>
<span>    title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Conditional Distribution of "</span> <span class="op">*</span> <span class="va">w</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="st">" | "</span> <span class="op">*</span> <span class="va">alpha</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="dual-anchor_files/figure-html/mechanism-illustration-1.png" class="r-plt" alt="When Œ± is small, w‚ÇÅ concentrates near 1; when Œ± is large, w‚ÇÅ concentrates near 0. A diffuse prior on Œ± spans both extremes." width="85%"><p class="caption">
When Œ± is small, w‚ÇÅ concentrates near 1; when Œ± is large, w‚ÇÅ
concentrates near 0. A diffuse prior on Œ± spans both extremes.
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="understanding-weight-distributions">2. Understanding Weight Distributions<a class="anchor" aria-label="anchor" href="#understanding-weight-distributions"></a>
</h2>
<p>Before diving into dual-anchor calibration, let us examine the two
weight anchors available in the DPprior package.</p>
<div class="section level3">
<h3 id="stick-breaking-weights-refresher">2.1 Stick-Breaking Weights Refresher<a class="anchor" aria-label="anchor" href="#stick-breaking-weights-refresher"></a>
</h3>
<p>Under Sethuraman‚Äôs stick-breaking representation of the Dirichlet
Process, the random mixing measure
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>G</mi><annotation encoding="application/x-tex">G</annotation></semantics></math>
is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mo>=</mo><munderover><mo>‚àë</mo><mrow><mi>h</mi><mo>=</mo><mn>1</mn></mrow><mo accent="false">‚àû</mo></munderover><msub><mi>w</mi><mi>h</mi></msub><mspace width="0.167em"></mspace><msub><mi>Œ¥</mi><msub><mi>Œ∏</mi><mi>h</mi></msub></msub></mrow><annotation encoding="application/x-tex">
G = \sum_{h=1}^{\infty} w_h \, \delta_{\theta_h}
</annotation></semantics></math></p>
<p>where the weights are constructed via:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>h</mi></msub><mover><mo>‚àº</mo><mrow><mi>i</mi><mi>i</mi><mi>d</mi></mrow></mover><mtext mathvariant="normal">Beta</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>,</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><msub><mi>w</mi><mn>1</mn></msub><mo>=</mo><msub><mi>v</mi><mn>1</mn></msub><mo>,</mo><mspace width="1.0em"></mspace><msub><mi>w</mi><mi>h</mi></msub><mo>=</mo><msub><mi>v</mi><mi>h</mi></msub><munder><mo>‚àè</mo><mrow><mo>‚Ñì</mo><mo>&lt;</mo><mi>h</mi></mrow></munder><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><msub><mi>v</mi><mo>‚Ñì</mo></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="1.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mo>‚â•</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
v_h \overset{iid}{\sim} \text{Beta}(1, \alpha), \quad 
w_1 = v_1, \quad 
w_h = v_h \prod_{\ell &lt; h} (1 - v_\ell) \quad (h \geq 2)
</annotation></semantics></math></p>
<p>The sequence
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>w</mi><mn>1</mn></msub><mo>,</mo><msub><mi>w</mi><mn>2</mn></msub><mo>,</mo><mi>‚Ä¶</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(w_1, w_2, \ldots)</annotation></semantics></math>
follows the
<strong>GEM(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ±</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>)
distribution</strong> and is in <em>size-biased</em> order, not ranked
by magnitude.</p>
</div>
<div class="section level3">
<h3 id="anchor-2a-the-first-stick-breaking-weight-w_1">2.2 Anchor 2a: The First Stick-Breaking Weight
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mn>1</mn></msub><annotation encoding="application/x-tex">w_1</annotation></semantics></math>)<a class="anchor" aria-label="anchor" href="#anchor-2a-the-first-stick-breaking-weight-w_1"></a>
</h3>
<p>The first weight
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mn>1</mn></msub><annotation encoding="application/x-tex">w_1</annotation></semantics></math>
has a particularly tractable distribution. Conditionally,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mn>1</mn></msub><mo>‚à£</mo><mi>Œ±</mi><mo>‚àº</mo><mtext mathvariant="normal">Beta</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>,</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">w_1 \mid \alpha \sim \text{Beta}(1, \alpha)</annotation></semantics></math>.</p>
<p>Under the hyperprior
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ±</mi><mo>‚àº</mo><mtext mathvariant="normal">Gamma</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\alpha \sim \text{Gamma}(a, b)</annotation></semantics></math>,
the marginal distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mn>1</mn></msub><annotation encoding="application/x-tex">w_1</annotation></semantics></math>
has <strong>fully closed-form</strong> expressions:</p>
<p><strong>CDF:</strong>
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><msub><mi>w</mi><mn>1</mn></msub></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>‚à£</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn><mo>‚àí</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mi>b</mi><mrow><mi>b</mi><mo>‚àí</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mi>a</mi></msup></mrow><annotation encoding="application/x-tex">
F_{w_1}(x \mid a, b) = 1 - \left( \frac{b}{b - \log(1-x)} \right)^a
</annotation></semantics></math></p>
<p><strong>Quantile function:</strong>
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><msub><mi>w</mi><mn>1</mn></msub></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>u</mi><mo>‚à£</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn><mo>‚àí</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>b</mi><mrow><mo stretchy="true" form="prefix">[</mo><mn>1</mn><mo>‚àí</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>‚àí</mo><mn>1</mn><mi>/</mi><mi>a</mi></mrow></msup><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
Q_{w_1}(u \mid a, b) = 1 - \exp\left( b \left[ 1 - (1-u)^{-1/a} \right] \right)
</annotation></semantics></math></p>
<p><strong>Survival function (dominance risk):</strong>
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>w</mi><mn>1</mn></msub><mo>&gt;</mo><mi>t</mi><mo>‚à£</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mi>b</mi><mrow><mi>b</mi><mo>‚àí</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mi>a</mi></msup></mrow><annotation encoding="application/x-tex">
P(w_1 &gt; t \mid a, b) = \left( \frac{b}{b - \log(1-t)} \right)^a
</annotation></semantics></math></p>
<p><strong>Important interpretability caveat:</strong>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mn>1</mn></msub><annotation encoding="application/x-tex">w_1</annotation></semantics></math>
is in GEM (size-biased) order, <em>not</em> the largest cluster weight.
A faithful interpretation is:</p>
<blockquote>
<p>‚Äú<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mn>1</mn></msub><annotation encoding="application/x-tex">w_1</annotation></semantics></math>
is the asymptotic proportion of the cluster containing a randomly
selected unit.‚Äù</p>
</blockquote>
<p>This is still a meaningful dominance diagnostic‚Äîif
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>w</mi><mn>1</mn></msub><mo>&gt;</mo><mn>0.5</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P(w_1 &gt; 0.5)</annotation></semantics></math>
is high, then a randomly selected unit is likely to belong to a cluster
that contains more than half the population.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Using the closed-form w1 functions</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">fit_K</span><span class="op">$</span><span class="va">a</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va">fit_K</span><span class="op">$</span><span class="va">b</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"w‚ÇÅ distribution under K-only prior:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; w‚ÇÅ distribution under K-only prior:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Mean:     "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/mean_w1.html">mean_w1</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Mean:      0.5854</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Variance: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/var_w1.html">var_w1</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Variance:  0.1331</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Median:   "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/quantile_w1.html">quantile_w1</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Median:    0.6169</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  90th %ile:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/quantile_w1.html">quantile_w1</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   90th %ile: 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nDominance risk:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Dominance risk:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  P(w‚ÇÅ &gt; 0.3):"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/prob_w1_exceeds.html">prob_w1_exceeds</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   P(w‚ÇÅ &gt; 0.3): 0.6903</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  P(w‚ÇÅ &gt; 0.5):"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/prob_w1_exceeds.html">prob_w1_exceeds</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   P(w‚ÇÅ &gt; 0.5): 0.563</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  P(w‚ÇÅ &gt; 0.9):"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/prob_w1_exceeds.html">prob_w1_exceeds</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   P(w‚ÇÅ &gt; 0.9): 0.3463</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="anchor-2b-co-clustering-probability-rho">2.3 Anchor 2b: Co-Clustering Probability
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÅ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>)<a class="anchor" aria-label="anchor" href="#anchor-2b-co-clustering-probability-rho"></a>
</h3>
<p>The co-clustering probability is defined as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>œÅ</mi><mo>=</mo><munderover><mo>‚àë</mo><mrow><mi>h</mi><mo>=</mo><mn>1</mn></mrow><mo accent="false">‚àû</mo></munderover><msubsup><mi>w</mi><mi>h</mi><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">
\rho = \sum_{h=1}^{\infty} w_h^2
</annotation></semantics></math></p>
<p>This has a natural interpretation:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÅ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>
equals the probability that two randomly selected units belong to the
<em>same</em> cluster. This may be more intuitive for applied
researchers to elicit.</p>
<p>The conditional moments are simple:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>œÅ</mi><mo>‚à£</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><mi>Œ±</mi></mrow></mfrac><mo>,</mo><mspace width="1.0em"></mspace><mtext mathvariant="normal">Var</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>œÅ</mi><mo>‚à£</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mn>2</mn><mi>Œ±</mi></mrow><mrow><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo>+</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>3</mn><mo>+</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">
\mathbb{E}[\rho \mid \alpha] = \frac{1}{1 + \alpha}, \quad
\text{Var}(\rho \mid \alpha) = \frac{2\alpha}{(1+\alpha)^2(2+\alpha)(3+\alpha)}
</annotation></semantics></math></p>
<p>Note that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>œÅ</mi><mo>‚à£</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>w</mi><mn>1</mn></msub><mo>‚à£</mo><mi>Œ±</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{E}[\rho \mid \alpha] = \mathbb{E}[w_1 \mid \alpha]</annotation></semantics></math>,
so their <em>means</em> are equal, but their full distributions
differ.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Using the rho (co-clustering) functions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Co-clustering probability œÅ under K-only prior:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Co-clustering probability œÅ under K-only prior:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  E[œÅ]:     "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/mean_rho.html">mean_rho</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   E[œÅ]:      0.5854</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Var(œÅ):   "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/var_rho.html">var_rho</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span>, <span class="fl">6</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Var(œÅ):    0.107831</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  SD(œÅ):    "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="../reference/var_rho.html">var_rho</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   SD(œÅ):     0.3284</span></span>
<span></span>
<span><span class="co"># Compare with w1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nNote: E[w‚ÇÅ] = E[œÅ] ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/mean_w1.html">mean_w1</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Note: E[w‚ÇÅ] = E[œÅ] = 0.5854</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"But: Var(w‚ÇÅ) ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/var_w1.html">var_w1</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"‚â† Var(œÅ) ="</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/var_rho.html">var_rho</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span>, <span class="fl">6</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; But: Var(w‚ÇÅ) = 0.1331 ‚â† Var(œÅ) = 0.107831</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="the-dual-anchor-framework">3. The Dual-Anchor Framework<a class="anchor" aria-label="anchor" href="#the-dual-anchor-framework"></a>
</h2>
<div class="section level3">
<h3 id="the-core-idea">3.1 The Core Idea<a class="anchor" aria-label="anchor" href="#the-core-idea"></a>
</h3>
<p>The dual-anchor framework finds Gamma hyperparameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(a, b)</annotation></semantics></math>
that satisfy <em>two</em> types of constraints simultaneously:</p>
<ul>
<li>
<strong>Anchor 1:</strong> Match your beliefs about
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>K</mi><mi>J</mi></msub><annotation encoding="application/x-tex">K_J</annotation></semantics></math>
(number of clusters)</li>
<li>
<strong>Anchor 2:</strong> Match your beliefs about a weight
quantity
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>‚àà</mo><mo stretchy="false" form="prefix">{</mo><msub><mi>w</mi><mn>1</mn></msub><mo>,</mo><mi>œÅ</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">T \in \{w_1, \rho\}</annotation></semantics></math>
</li>
</ul>
<p>This is formalized as an optimization problem:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>a</mi><mo>*</mo></msup><mo>,</mo><msup><mi>b</mi><mo>*</mo></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>arg</mo><munder><mo>min</mo><mrow><mi>a</mi><mo>&gt;</mo><mn>0</mn><mo>,</mo><mi>b</mi><mo>&gt;</mo><mn>0</mn></mrow></munder><mrow><mo stretchy="true" form="prefix">[</mo><mi>Œª</mi><mo>‚ãÖ</mo><msub><mi>L</mi><mi>K</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><mi>Œª</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚ãÖ</mo><msub><mi>L</mi><mi>w</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>a</mi><mo>,</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">
(a^*, b^*) = \arg\min_{a &gt; 0, b &gt; 0} \left[ 
  \lambda \cdot L_K(a, b) + 
  (1 - \lambda) \cdot L_w(a, b) 
\right]
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>L</mi><mi>K</mi></msub><annotation encoding="application/x-tex">L_K</annotation></semantics></math>
measures the discrepancy from the K target and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>L</mi><mi>w</mi></msub><annotation encoding="application/x-tex">L_w</annotation></semantics></math>
measures the discrepancy from the weight target.</p>
</div>
<div class="section level3">
<h3 id="the-role-of-lambda">3.2 The Role of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math><a class="anchor" aria-label="anchor" href="#the-role-of-lambda"></a>
</h3>
<p>The parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œª</mi><mo>‚àà</mo><mrow><mo stretchy="true" form="prefix">[</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\lambda \in [0, 1]</annotation></semantics></math>
controls the trade-off between the two anchors:</p>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<thead><tr class="header">
<th>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
Value</th>
<th>Interpretation</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œª</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\lambda = 1</annotation></semantics></math></td>
<td>K-only calibration (ignores weight anchor)</td>
</tr>
<tr class="even">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œª</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\lambda = 0</annotation></semantics></math></td>
<td>Weight-only calibration (ignores K anchor)</td>
</tr>
<tr class="odd">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.5</mn><mo>‚â§</mo><mi>Œª</mi><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">0.5 \leq \lambda &lt; 1</annotation></semantics></math></td>
<td>K remains primary, weight provides secondary control</td>
</tr>
<tr class="even">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>&lt;</mo><mi>Œª</mi><mo>&lt;</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">0 &lt; \lambda &lt; 0.5</annotation></semantics></math></td>
<td>Weight becomes primary (rare in practice)</td>
</tr>
</tbody>
</table>
<p>In most applications, we recommend
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œª</mi><mo>‚àà</mo><mrow><mo stretchy="true" form="prefix">[</mo><mn>0.5</mn><mo>,</mo><mn>0.9</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\lambda \in [0.5, 0.9]</annotation></semantics></math>,
keeping the cluster count as the primary anchor while using the weight
constraint to avoid unintended dominance behavior.</p>
</div>
<div class="section level3">
<h3 id="loss-types-balancing-the-two-anchors">3.3 Loss Types: Balancing the Two Anchors<a class="anchor" aria-label="anchor" href="#loss-types-balancing-the-two-anchors"></a>
</h3>
<p>A critical implementation detail is how to <em>scale</em> the two
loss components. The <code><a href="../reference/DPprior_dual.html">DPprior_dual()</a></code> function offers three
<code>loss_type</code> options:</p>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th><code>loss_type</code></th>
<th>Description</th>
<th>When to Use</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>"relative"</code></td>
<td>Normalizes losses by their baseline values</td>
<td>Default; good balance</td>
</tr>
<tr class="even">
<td><code>"adaptive"</code></td>
<td>Estimates scale factors from anchor extremes</td>
<td>More aggressive weight control</td>
</tr>
<tr class="odd">
<td><code>"absolute"</code></td>
<td>Raw squared errors (not recommended)</td>
<td>Legacy; scale mismatch issues</td>
</tr>
</tbody>
</table>
<p><strong>Why does this matter?</strong> The K-anchor loss and
weight-anchor loss are measured in different units. Without proper
scaling, the optimizer may effectively ignore one of the anchors. The
<code>"adaptive"</code> option is particularly useful when you want
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œª</mi><mo>=</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">\lambda = 0.5</annotation></semantics></math>
to produce a meaningful compromise between the two anchors.</p>
</div>
</div>
<div class="section level2">
<h2 id="using-dpprior_dual-for-dual-anchor-elicitation">4. Using <code>DPprior_dual()</code> for Dual-Anchor
Elicitation<a class="anchor" aria-label="anchor" href="#using-dpprior_dual-for-dual-anchor-elicitation"></a>
</h2>
<p>The <code><a href="../reference/DPprior_dual.html">DPprior_dual()</a></code> function refines a K-calibrated prior
to also satisfy weight constraints.</p>
<div class="section level3">
<h3 id="basic-usage-probability-constraint">4.1 Basic Usage: Probability Constraint<a class="anchor" aria-label="anchor" href="#basic-usage-probability-constraint"></a>
</h3>
<p>Suppose you want to ensure that the probability of extreme dominance
is limited. Specifically, you want
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>w</mi><mn>1</mn></msub><mo>&gt;</mo><mn>0.5</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚â§</mo><mn>0.25</mn></mrow><annotation encoding="application/x-tex">P(w_1 &gt; 0.5) \leq 0.25</annotation></semantics></math>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Step 1: Start with K-only calibration</span></span>
<span><span class="va">fit_K</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_fit.html">DPprior_fit</a></span><span class="op">(</span>J <span class="op">=</span> <span class="fl">50</span>, mu_K <span class="op">=</span> <span class="fl">5</span>, confidence <span class="op">=</span> <span class="st">"low"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: HIGH DOMINANCE RISK: P(w1 &gt; 0.5) = 56.3% exceeds 40%.</span></span>
<span><span class="co">#&gt;   This may indicate unintended prior behavior (Lee, 2026).</span></span>
<span><span class="co">#&gt;   Consider using DPprior_dual() for weight-constrained elicitation.</span></span>
<span><span class="co">#&gt;   See ?DPprior_diagnostics for interpretation.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"K-only prior:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; K-only prior:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Gamma("</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_K</span><span class="op">$</span><span class="va">a</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">","</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_K</span><span class="op">$</span><span class="va">b</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">")\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Gamma( 0.518 , 0.341 )</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  P(w‚ÇÅ &gt; 0.5) ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/prob_w1_exceeds.html">prob_w1_exceeds</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">fit_K</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_K</span><span class="op">$</span><span class="va">b</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   P(w‚ÇÅ &gt; 0.5) = 0.563</span></span>
<span></span>
<span><span class="co"># Step 2: Apply dual-anchor constraint with adaptive loss</span></span>
<span><span class="va">fit_dual</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_dual.html">DPprior_dual</a></span><span class="op">(</span></span>
<span>  fit <span class="op">=</span> <span class="va">fit_K</span>,</span>
<span>  w1_target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>threshold <span class="op">=</span> <span class="fl">0.5</span>, value <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  lambda <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  loss_type <span class="op">=</span> <span class="st">"adaptive"</span>,  <span class="co"># More aggressive weight control</span></span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Dual-anchor prior (adaptive):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Dual-anchor prior (adaptive):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Gamma("</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_dual</span><span class="op">$</span><span class="va">a</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">","</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_dual</span><span class="op">$</span><span class="va">b</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">")\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Gamma( 1.403 , 0.626 )</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  P(w‚ÇÅ &gt; 0.5) ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/prob_w1_exceeds.html">prob_w1_exceeds</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">fit_dual</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_dual</span><span class="op">$</span><span class="va">b</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   P(w‚ÇÅ &gt; 0.5) = 0.351</span></span></code></pre></div>
<p>Let us visualize the effect on both the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>K</mi><mi>J</mi></msub><annotation encoding="application/x-tex">K_J</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mn>1</mn></msub><annotation encoding="application/x-tex">w_1</annotation></semantics></math>
distributions:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prepare data for visualization</span></span>
<span><span class="va">logS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_log_stirling.html">compute_log_stirling</a></span><span class="op">(</span><span class="va">J</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># K distributions</span></span>
<span><span class="va">k_grid</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span></span>
<span><span class="va">k_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  K <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">k_grid</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  probability <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/pmf_K_marginal.html">pmf_K_marginal</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">fit_K</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_K</span><span class="op">$</span><span class="va">b</span>, logS <span class="op">=</span> <span class="va">logS</span><span class="op">)</span><span class="op">[</span><span class="va">k_grid</span><span class="op">]</span>,</span>
<span>    <span class="fu"><a href="../reference/pmf_K_marginal.html">pmf_K_marginal</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">fit_dual</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_dual</span><span class="op">$</span><span class="va">b</span>, logS <span class="op">=</span> <span class="va">logS</span><span class="op">)</span><span class="op">[</span><span class="va">k_grid</span><span class="op">]</span></span>
<span>  <span class="op">)</span>,</span>
<span>  Prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"K-only"</span>, <span class="st">"Dual-anchor"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">k_grid</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># w1 distributions</span></span>
<span><span class="va">w_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.95</span>, length.out <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="va">w_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  w1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">w_grid</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  density <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/density_w1.html">density_w1</a></span><span class="op">(</span><span class="va">w_grid</span>, <span class="va">fit_K</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_K</span><span class="op">$</span><span class="va">b</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/density_w1.html">density_w1</a></span><span class="op">(</span><span class="va">w_grid</span>, <span class="va">fit_dual</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_dual</span><span class="op">$</span><span class="va">b</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  Prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"K-only"</span>, <span class="st">"Dual-anchor"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">w_grid</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create plots</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">k_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">K</span>, y <span class="op">=</span> <span class="va">probability</span>, color <span class="op">=</span> <span class="va">Prior</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">palette_2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Number of Clusters (K)"</span>, y <span class="op">=</span> <span class="st">"Probability"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Marginal PMF of K"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">w_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">w1</span>, y <span class="op">=</span> <span class="va">density</span>, color <span class="op">=</span> <span class="va">Prior</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0.5</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"gray50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="va">palette_2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">w</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, y <span class="op">=</span> <span class="st">"Density"</span>,</span>
<span>       title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Marginal Density of "</span> <span class="op">*</span> <span class="va">w</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="dual-anchor_files/figure-html/dual-comparison-viz-1.png" class="r-plt" alt="Comparison of K-only vs dual-anchor priors: the dual-anchor approach shifts mass away from extreme w‚ÇÅ values while maintaining similar K expectations." width="85%"><p class="caption">
Comparison of K-only vs dual-anchor priors: the dual-anchor approach
shifts mass away from extreme w‚ÇÅ values while maintaining similar K
expectations.
</p>
</div>
</div>
<div class="section level3">
<h3 id="comparing-loss-types">4.2 Comparing Loss Types<a class="anchor" aria-label="anchor" href="#comparing-loss-types"></a>
</h3>
<p>The choice of <code>loss_type</code> can significantly affect the
results. Let us compare the three options:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare loss types at lambda = 0.5</span></span>
<span><span class="va">w1_target</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>threshold <span class="op">=</span> <span class="fl">0.5</span>, value <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_relative</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_dual.html">DPprior_dual</a></span><span class="op">(</span></span>
<span>  <span class="va">fit_K</span>, <span class="va">w1_target</span>, lambda <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>  loss_type <span class="op">=</span> <span class="st">"relative"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_adaptive</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_dual.html">DPprior_dual</a></span><span class="op">(</span></span>
<span>  <span class="va">fit_K</span>, <span class="va">w1_target</span>, lambda <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>  loss_type <span class="op">=</span> <span class="st">"adaptive"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create comparison table</span></span>
<span><span class="va">loss_compare</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"K-only"</span>, <span class="st">"Relative"</span>, <span class="st">"Adaptive"</span><span class="op">)</span>,</span>
<span>  a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit_K</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_relative</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_adaptive</span><span class="op">$</span><span class="va">a</span><span class="op">)</span>,</span>
<span>  b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit_K</span><span class="op">$</span><span class="va">b</span>, <span class="va">fit_relative</span><span class="op">$</span><span class="va">b</span>, <span class="va">fit_adaptive</span><span class="op">$</span><span class="va">b</span><span class="op">)</span>,</span>
<span>  E_K <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/exact_K_moments.html">exact_K_moments</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">fit_K</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_K</span><span class="op">$</span><span class="va">b</span><span class="op">)</span><span class="op">$</span><span class="va">mean</span>,</span>
<span>    <span class="fu"><a href="../reference/exact_K_moments.html">exact_K_moments</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">fit_relative</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_relative</span><span class="op">$</span><span class="va">b</span><span class="op">)</span><span class="op">$</span><span class="va">mean</span>,</span>
<span>    <span class="fu"><a href="../reference/exact_K_moments.html">exact_K_moments</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">fit_adaptive</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_adaptive</span><span class="op">$</span><span class="va">b</span><span class="op">)</span><span class="op">$</span><span class="va">mean</span></span>
<span>  <span class="op">)</span>,</span>
<span>  P_w1_gt_50 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/prob_w1_exceeds.html">prob_w1_exceeds</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">fit_K</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_K</span><span class="op">$</span><span class="va">b</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/prob_w1_exceeds.html">prob_w1_exceeds</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">fit_relative</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_relative</span><span class="op">$</span><span class="va">b</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/prob_w1_exceeds.html">prob_w1_exceeds</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">fit_adaptive</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_adaptive</span><span class="op">$</span><span class="va">b</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">loss_compare</span><span class="op">$</span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">loss_compare</span><span class="op">$</span><span class="va">a</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">loss_compare</span><span class="op">$</span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">loss_compare</span><span class="op">$</span><span class="va">b</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">loss_compare</span><span class="op">$</span><span class="va">E_K</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">loss_compare</span><span class="op">$</span><span class="va">E_K</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">loss_compare</span><span class="op">$</span><span class="va">P_w1_gt_50</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">loss_compare</span><span class="op">$</span><span class="va">P_w1_gt_50</span>, <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>  <span class="va">loss_compare</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Method"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"E[K]"</span>, <span class="st">"P(w‚ÇÅ&gt;0.5)"</span><span class="op">)</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Comparison of loss types at Œª = 0.5 (target: P(w‚ÇÅ&gt;0.5) = 0.25)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Comparison of loss types at Œª = 0.5 (target: P(w‚ÇÅ&gt;0.5) =
0.25)</caption>
<thead><tr class="header">
<th align="left">Method</th>
<th align="right">a</th>
<th align="right">b</th>
<th align="right">E[K]</th>
<th align="right">P(w‚ÇÅ&gt;0.5)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">K-only</td>
<td align="right">0.518</td>
<td align="right">0.341</td>
<td align="right">5.00</td>
<td align="right">0.563</td>
</tr>
<tr class="even">
<td align="left">Relative</td>
<td align="right">0.736</td>
<td align="right">0.424</td>
<td align="right">5.63</td>
<td align="right">0.490</td>
</tr>
<tr class="odd">
<td align="left">Adaptive</td>
<td align="right">1.737</td>
<td align="right">0.715</td>
<td align="right">7.43</td>
<td align="right">0.308</td>
</tr>
</tbody>
</table>
<p>The <code>"adaptive"</code> loss type typically produces more
noticeable weight reduction because it normalizes each loss component by
its scale at the opposite anchor‚Äôs optimum.</p>
</div>
<div class="section level3">
<h3 id="alternative-quantile-constraint">4.3 Alternative: Quantile Constraint<a class="anchor" aria-label="anchor" href="#alternative-quantile-constraint"></a>
</h3>
<p>You can also specify a quantile constraint. For example, to ensure
that the 90th percentile of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mn>1</mn></msub><annotation encoding="application/x-tex">w_1</annotation></semantics></math>
does not exceed 0.6:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_dual_q</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_dual.html">DPprior_dual</a></span><span class="op">(</span></span>
<span>  fit <span class="op">=</span> <span class="va">fit_K</span>,</span>
<span>  w1_target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>quantile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="fl">0.9</span>, value <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  lambda <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  loss_type <span class="op">=</span> <span class="st">"adaptive"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Dual-anchor (quantile constraint):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Dual-anchor (quantile constraint):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Gamma("</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_dual_q</span><span class="op">$</span><span class="va">a</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">","</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_dual_q</span><span class="op">$</span><span class="va">b</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">")\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Gamma( 0.518 , 0.341 )</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  90th percentile of w‚ÇÅ:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/quantile_w1.html">quantile_w1</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="va">fit_dual_q</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_dual_q</span><span class="op">$</span><span class="va">b</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   90th percentile of w‚ÇÅ: 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  (Target was 0.6)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   (Target was 0.6)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="alternative-mean-constraint">4.4 Alternative: Mean Constraint<a class="anchor" aria-label="anchor" href="#alternative-mean-constraint"></a>
</h3>
<p>For constraints based on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>w</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{E}[w_1]</annotation></semantics></math>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_dual_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_dual.html">DPprior_dual</a></span><span class="op">(</span></span>
<span>  fit <span class="op">=</span> <span class="va">fit_K</span>,</span>
<span>  w1_target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">0.35</span><span class="op">)</span>,</span>
<span>  lambda <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>  loss_type <span class="op">=</span> <span class="st">"adaptive"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Dual-anchor (mean constraint):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Dual-anchor (mean constraint):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Gamma("</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_dual_m</span><span class="op">$</span><span class="va">a</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">","</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">fit_dual_m</span><span class="op">$</span><span class="va">b</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">")\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Gamma( 1.377 , 0.621 )</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  E[w‚ÇÅ]:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/mean_w1.html">mean_w1</a></span><span class="op">(</span><span class="va">fit_dual_m</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_dual_m</span><span class="op">$</span><span class="va">b</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   E[w‚ÇÅ]: 0.411</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  (Target was 0.35)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   (Target was 0.35)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="elicitation-questions-for-weight-anchors">5. Elicitation Questions for Weight Anchors<a class="anchor" aria-label="anchor" href="#elicitation-questions-for-weight-anchors"></a>
</h2>
<p>Translating substantive knowledge into weight constraints requires
careful framing. Here are suggested elicitation questions:</p>
<div class="section level3">
<h3 id="for-w_1-size-biased-weight">For
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mn>1</mn></msub><annotation encoding="application/x-tex">w_1</annotation></semantics></math>
(Size-Biased Weight)<a class="anchor" aria-label="anchor" href="#for-w_1-size-biased-weight"></a>
</h3>
<p>These questions focus on what happens when you randomly sample a
unit:</p>
<blockquote>
<p>‚ÄúIf you randomly select a site from your study, what proportion of
all sites would you expect to share its effect pattern? What‚Äôs a
reasonable median estimate?‚Äù</p>
</blockquote>
<blockquote>
<p>‚ÄúIs there a significant chance (say, &gt; 30%) that a randomly
selected site belongs to an effect group that contains more than half of
all sites?‚Äù</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="for-rho-co-clustering-probability">For
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÅ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>
(Co-Clustering Probability)<a class="anchor" aria-label="anchor" href="#for-rho-co-clustering-probability"></a>
</h3>
<p>These questions may be more intuitive for many researchers:</p>
<blockquote>
<p>‚ÄúIf you pick two sites at random, what‚Äôs the probability that they
belong to the same effect group?‚Äù</p>
</blockquote>
<blockquote>
<p>‚ÄúHow likely is it that any two randomly chosen sites would show
substantively similar treatment effects?‚Äù</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="translation-examples">Translation Examples<a class="anchor" aria-label="anchor" href="#translation-examples"></a>
</h3>
<table class="table">
<colgroup>
<col width="47%">
<col width="52%">
</colgroup>
<thead><tr class="header">
<th>Elicited Belief</th>
<th>Formal Constraint</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>‚ÄúRandomly selected site‚Äôs group is ~25% of total (median)‚Äù</td>
<td><code>quantile = list(prob = 0.5, value = 0.25)</code></td>
</tr>
<tr class="even">
<td>‚ÄúUnlikely (‚â§20%) that random site is in a dominant (&gt;50%)
group‚Äù</td>
<td><code>prob = list(threshold = 0.5, value = 0.2)</code></td>
</tr>
<tr class="odd">
<td>‚ÄúTwo random sites have ~20% chance of same group‚Äù</td>
<td>Use
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÅ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>
anchor with target mean 0.2</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="exploring-the-trade-off-lambda-sensitivity">6. Exploring the Trade-off:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
Sensitivity<a class="anchor" aria-label="anchor" href="#exploring-the-trade-off-lambda-sensitivity"></a>
</h2>
<p>Different values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
produce different trade-offs between matching the K anchor and the
weight anchor. Let us explore this systematically:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lambda_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">0.9</span>, <span class="fl">0.7</span>, <span class="fl">0.5</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">w1_target</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>threshold <span class="op">=</span> <span class="fl">0.5</span>, value <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lambda_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">lambda_grid</span>, <span class="kw">function</span><span class="op">(</span><span class="va">lam</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">lam</span> <span class="op">==</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># lambda = 1 just returns K-only</span></span>
<span>    <span class="va">fit</span> <span class="op">&lt;-</span> <span class="va">fit_K</span></span>
<span>    <span class="va">fit</span><span class="op">$</span><span class="va">dual_anchor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lambda <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_dual.html">DPprior_dual</a></span><span class="op">(</span><span class="va">fit_K</span>, <span class="va">w1_target</span>, lambda <span class="op">=</span> <span class="va">lam</span>, </span>
<span>                        loss_type <span class="op">=</span> <span class="st">"adaptive"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    lambda <span class="op">=</span> <span class="va">lam</span>,</span>
<span>    a <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">a</span>,</span>
<span>    b <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">b</span>,</span>
<span>    E_K <span class="op">=</span> <span class="fu"><a href="../reference/exact_K_moments.html">exact_K_moments</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">fit</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit</span><span class="op">$</span><span class="va">b</span><span class="op">)</span><span class="op">$</span><span class="va">mean</span>,</span>
<span>    P_w1_gt_50 <span class="op">=</span> <span class="fu"><a href="../reference/prob_w1_exceeds.html">prob_w1_exceeds</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">fit</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit</span><span class="op">$</span><span class="va">b</span><span class="op">)</span>,</span>
<span>    E_w1 <span class="op">=</span> <span class="fu"><a href="../reference/mean_w1.html">mean_w1</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit</span><span class="op">$</span><span class="va">b</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create comparison table</span></span>
<span><span class="va">lambda_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">lambda_results</span>, <span class="kw">function</span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    lambda <span class="op">=</span> <span class="va">r</span><span class="op">$</span><span class="va">lambda</span>,</span>
<span>    a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">r</span><span class="op">$</span><span class="va">a</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>    b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">r</span><span class="op">$</span><span class="va">b</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>    E_K <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">r</span><span class="op">$</span><span class="va">E_K</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    P_w1_gt_50 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">r</span><span class="op">$</span><span class="va">P_w1_gt_50</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>    E_w1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">r</span><span class="op">$</span><span class="va">E_w1</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>  <span class="va">lambda_df</span>,</span>
<span>  col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Œª"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"E[K]"</span>, <span class="st">"P(w‚ÇÅ&gt;0.5)"</span>, <span class="st">"E[w‚ÇÅ]"</span><span class="op">)</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Effect of Œª on dual-anchor calibration (target: P(w‚ÇÅ&gt;0.5) = 0.2, adaptive loss)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Effect of Œª on dual-anchor calibration (target: P(w‚ÇÅ&gt;0.5) =
0.2, adaptive loss)</caption>
<thead><tr class="header">
<th align="right">Œª</th>
<th align="right">a</th>
<th align="right">b</th>
<th align="right">E[K]</th>
<th align="right">P(w‚ÇÅ&gt;0.5)</th>
<th align="right">E[w‚ÇÅ]</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1.0</td>
<td align="right">0.518</td>
<td align="right">0.341</td>
<td align="right">5.00</td>
<td align="right">0.563</td>
<td align="right">0.585</td>
</tr>
<tr class="even">
<td align="right">0.9</td>
<td align="right">1.032</td>
<td align="right">0.520</td>
<td align="right">6.31</td>
<td align="right">0.417</td>
<td align="right">0.460</td>
</tr>
<tr class="odd">
<td align="right">0.7</td>
<td align="right">1.658</td>
<td align="right">0.694</td>
<td align="right">7.33</td>
<td align="right">0.317</td>
<td align="right">0.381</td>
</tr>
<tr class="even">
<td align="right">0.5</td>
<td align="right">2.143</td>
<td align="right">0.819</td>
<td align="right">7.87</td>
<td align="right">0.269</td>
<td align="right">0.344</td>
</tr>
<tr class="odd">
<td align="right">0.3</td>
<td align="right">2.597</td>
<td align="right">0.933</td>
<td align="right">8.26</td>
<td align="right">0.236</td>
<td align="right">0.320</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualize the trade-off</span></span>
<span><span class="va">tradeoff_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">lambda_results</span>, <span class="va">`[[`</span>, <span class="st">"lambda"</span><span class="op">)</span>,</span>
<span>  E_K <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">lambda_results</span>, <span class="va">`[[`</span>, <span class="st">"E_K"</span><span class="op">)</span>,</span>
<span>  P_w1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">lambda_results</span>, <span class="va">`[[`</span>, <span class="st">"P_w1_gt_50"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">tradeoff_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">E_K</span>, y <span class="op">=</span> <span class="va">P_w1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_path</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray50"</span>, linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.2</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"#E41A1C"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">5</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"#377EB8"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">4.7</span>, y <span class="op">=</span> <span class="fl">0.22</span>, label <span class="op">=</span> <span class="st">"w‚ÇÅ target"</span>, hjust <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"#E41A1C"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">5.1</span>, y <span class="op">=</span> <span class="fl">0.45</span>, label <span class="op">=</span> <span class="st">"K target"</span>, hjust <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"#377EB8"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_viridis_d</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"viridis"</span>, begin <span class="op">=</span> <span class="fl">0.2</span>, end <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"E[K] (Cluster Count)"</span>,</span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">P</span><span class="op">(</span><span class="va">w</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Trade-off Between K and Weight Anchors"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Œª"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="dual-anchor_files/figure-html/lambda-tradeoff-viz-1.png" class="r-plt" alt="Trade-off curve: reducing Œª brings P(w‚ÇÅ &gt; 0.5) closer to target at the cost of K deviation." width="85%"><p class="caption">
Trade-off curve: reducing Œª brings P(w‚ÇÅ &gt; 0.5) closer to target at
the cost of K deviation.
</p>
</div>
</div>
<div class="section level2">
<h2 id="practical-recommendations">7. Practical Recommendations<a class="anchor" aria-label="anchor" href="#practical-recommendations"></a>
</h2>
<div class="section level3">
<h3 id="when-to-use-dual-anchor-calibration">7.1 When to Use Dual-Anchor Calibration<a class="anchor" aria-label="anchor" href="#when-to-use-dual-anchor-calibration"></a>
</h3>
<p>Consider dual-anchor calibration when:</p>
<ul>
<li><p><strong>High dominance risk in K-only fit:</strong> If
<code>print(fit)</code> shows ‚ÄúDominance Risk: HIGH‚Äù or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>w</mi><mn>1</mn></msub><mo>&gt;</mo><mn>0.5</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><mn>0.4</mn></mrow><annotation encoding="application/x-tex">P(w_1 &gt; 0.5) &gt; 0.4</annotation></semantics></math></p></li>
<li><p><strong>Strong prior belief against concentration:</strong> You
believe effects should be reasonably spread across groups, not
concentrated</p></li>
<li><p><strong>Low-information settings:</strong> When the data may not
strongly update the prior, unintended weight behavior can persist to the
posterior</p></li>
</ul>
<p>Do <strong>not</strong> use dual-anchor when:</p>
<ul>
<li>You are comfortable with the weight implications of your K-only
prior</li>
<li>You have strong data that will overwhelm any prior
specification</li>
<li>The additional complexity is not justified for your application</li>
</ul>
</div>
<div class="section level3">
<h3 id="choosing-loss_type">7.2 Choosing <code>loss_type</code><a class="anchor" aria-label="anchor" href="#choosing-loss_type"></a>
</h3>
<table class="table">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th><code>loss_type</code></th>
<th>When to Use</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>"relative"</code></td>
<td>Default choice; balanced trade-off</td>
</tr>
<tr class="even">
<td><code>"adaptive"</code></td>
<td>When you want
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œª</mi><mo>=</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">\lambda = 0.5</annotation></semantics></math>
to give meaningful weight reduction</td>
</tr>
<tr class="odd">
<td><code>"absolute"</code></td>
<td>Not recommended (legacy)</td>
</tr>
</tbody>
</table>
<p>We generally recommend <code>"adaptive"</code> for most dual-anchor
applications, as it ensures that both anchors contribute meaningfully to
the optimization.</p>
</div>
<div class="section level3">
<h3 id="choosing-lambda">7.3 Choosing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math><a class="anchor" aria-label="anchor" href="#choosing-lambda"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="66%">
</colgroup>
<thead><tr class="header">
<th>Situation</th>
<th>Recommended
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>K anchor is well-justified, weight is secondary constraint</td>
<td>0.8 ‚Äì 0.9</td>
</tr>
<tr class="even">
<td>Both anchors are equally important</td>
<td>0.5 ‚Äì 0.7</td>
</tr>
<tr class="odd">
<td>Weight behavior is primary concern</td>
<td>0.3 ‚Äì 0.5</td>
</tr>
</tbody>
</table>
<p>In practice, we recommend starting with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œª</mi><mo>=</mo><mn>0.7</mn></mrow><annotation encoding="application/x-tex">\lambda = 0.7</annotation></semantics></math>
and adjusting based on how closely each target is achieved.</p>
</div>
<div class="section level3">
<h3 id="choosing-between-w_1-and-rho">7.4 Choosing Between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mn>1</mn></msub><annotation encoding="application/x-tex">w_1</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÅ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math><a class="anchor" aria-label="anchor" href="#choosing-between-w_1-and-rho"></a>
</h3>
<table class="table">
<colgroup>
<col width="26%">
<col width="40%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th>Anchor</th>
<th>Advantages</th>
<th>Best For</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mn>1</mn></msub><annotation encoding="application/x-tex">w_1</annotation></semantics></math></td>
<td>Closed-form CDF/quantiles; dominance-focused</td>
<td>Constraining tail behavior</td>
</tr>
<tr class="even">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÅ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math></td>
<td>More intuitive interpretation; moment-closed</td>
<td>Mean-based elicitation</td>
</tr>
</tbody>
</table>
<p>Since
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>w</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mi>ùîº</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>œÅ</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{E}[w_1] = \mathbb{E}[\rho]</annotation></semantics></math>,
mean-based constraints are equivalent between the two anchors.</p>
</div>
</div>
<div class="section level2">
<h2 id="when-dual-anchor-constraints-are-infeasible">8. When Dual-Anchor Constraints Are Infeasible<a class="anchor" aria-label="anchor" href="#when-dual-anchor-constraints-are-infeasible"></a>
</h2>
<p>Not all combinations of K and weight targets are achievable. If you
specify conflicting constraints, the optimization may not fully satisfy
both:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># An aggressive weight target that conflicts with K target</span></span>
<span><span class="va">fit_aggressive</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DPprior_dual.html">DPprior_dual</a></span><span class="op">(</span></span>
<span>  fit <span class="op">=</span> <span class="va">fit_K</span>,</span>
<span>  w1_target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>threshold <span class="op">=</span> <span class="fl">0.5</span>, value <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span>,  <span class="co"># Very tight</span></span>
<span>  lambda <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  loss_type <span class="op">=</span> <span class="st">"adaptive"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Aggressive dual-anchor attempt:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Aggressive dual-anchor attempt:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Target: P(w‚ÇÅ &gt; 0.5) = 0.05\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Target: P(w‚ÇÅ &gt; 0.5) = 0.05</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Achieved: P(w‚ÇÅ &gt; 0.5) ="</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/prob_w1_exceeds.html">prob_w1_exceeds</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">fit_aggressive</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_aggressive</span><span class="op">$</span><span class="va">b</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Achieved: P(w‚ÇÅ &gt; 0.5) = 0.149</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n  Target: E[K] = 5\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Target: E[K] = 5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Achieved: E[K] ="</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/exact_K_moments.html">exact_K_moments</a></span><span class="op">(</span><span class="va">J</span>, <span class="va">fit_aggressive</span><span class="op">$</span><span class="va">a</span>, <span class="va">fit_aggressive</span><span class="op">$</span><span class="va">b</span><span class="op">)</span><span class="op">$</span><span class="va">mean</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Achieved: E[K] = 9.41</span></span></code></pre></div>
<p>When constraints are too strict, consider:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Relaxing one of the targets:</strong> Accept somewhat
higher dominance risk or a different K expectation</p></li>
<li><p><strong>Adjusting
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>:</strong>
If one target is more important, weight it more heavily</p></li>
<li><p><strong>Using a single anchor:</strong> Sometimes K-only or
weight-only calibration is more appropriate</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<table class="table">
<colgroup>
<col width="45%">
<col width="55%">
</colgroup>
<thead><tr class="header">
<th>Concept</th>
<th>Key Point</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>K-only calibration</td>
<td>May induce unintended weight behavior</td>
</tr>
<tr class="even">
<td>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mn>1</mn></msub><annotation encoding="application/x-tex">w_1</annotation></semantics></math>
(first weight)</td>
<td>Size-biased cluster mass; closed-form distribution</td>
</tr>
<tr class="odd">
<td>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÅ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>
(co-clustering)</td>
<td>P(two random units share a cluster); intuitive</td>
</tr>
<tr class="even">
<td><code>loss_type</code></td>
<td>Use <code>"adaptive"</code> for meaningful trade-offs</td>
</tr>
<tr class="odd">
<td>Dual-anchor objective</td>
<td>Trade-off between K fit and weight fit via
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
</td>
</tr>
<tr class="even">
<td>Recommended workflow</td>
<td>1. K-only fit ‚Üí 2. Check diagnostics ‚Üí 3. Dual-anchor if needed</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="whats-next">What‚Äôs Next?<a class="anchor" aria-label="anchor" href="#whats-next"></a>
</h2>
<ul>
<li><p><strong><a href="diagnostics.html">Diagnostics</a></strong>: Deep
dive into verifying your prior meets specifications</p></li>
<li><p><strong><a href="case-studies.html">Case Studies</a></strong>:
Real-world examples applying dual-anchor calibration</p></li>
<li><p><strong><a href="theory-overview.html">Mathematical
Foundations</a></strong>: Theoretical details of the DPprior
framework</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Vicentini, S., &amp; Jermyn, I. H. (2025). Prior selection for the
precision parameter of Dirichlet process mixture models.
<em>arXiv:2502.00864</em>. <a href="https://doi.org/10.48550/arXiv.2502.00864" class="external-link uri">https://doi.org/10.48550/arXiv.2502.00864</a></p>
<p>Sethuraman, J. (1994). A constructive definition of Dirichlet priors.
<em>Statistica Sinica</em>, 4(2), 639‚Äì650.</p>
<hr>
<p><em>For questions or feedback, please visit the <a href="https://github.com/joonho112/DPprior" class="external-link">GitHub
repository</a>.</em></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/joonho112" class="external-link">JoonHo Lee</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
